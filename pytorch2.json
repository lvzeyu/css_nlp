{"version":3,"kind":"Notebook","sha256":"299f66455e1694ceac037e5c35115ca447e2512f06a80f95ab2f082a7c80977c","slug":"pytorch2","location":"/notebook/pytorch2.ipynb","dependencies":[],"frontmatter":{"title":"Pytorch","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"jupyterbook","language":"python"},"github":"https://github.com/lvzeyu/css_nlp","numbering":{"heading_1":{"enabled":true,"template":"enabled"},"heading_2":{"enabled":true,"template":"enabled"},"heading_3":{"enabled":true,"template":"enabled"},"heading_4":{"enabled":true,"template":"enabled"},"heading_5":{"enabled":true,"template":"enabled"},"heading_6":{"enabled":true,"template":"enabled"},"title":{"offset":1}},"source_url":"https://github.com/lvzeyu/css_nlp/blob/master/notebook/pytorch2.ipynb","edit_url":"https://github.com/lvzeyu/css_nlp/edit/master/notebook/pytorch2.ipynb","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","exports":[{"format":"ipynb","filename":"pytorch2.ipynb","url":"/build/pytorch2-dce5b8072c1d6c0c8cefc75b97b22154.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"link","url":"https://colab.research.google.com/github/lvzeyu/css_nlp/blob/master/notebook/pytorch2.ipynb","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"image","url":"/build/7e2db436150c38a00650f96925aa5581.svg","alt":"Open In Colab","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ZzPs6CPuzD","urlSource":"https://colab.research.google.com/assets/colab-badge.svg"}],"urlSource":"https://colab.research.google.com/github/lvzeyu/css_nlp/blob/master/notebook/pytorch2.ipynb","key":"s1c4ovJnsv"}],"key":"ZS5xWXWjVr"}],"key":"ujvbY9DHEi"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"link","url":"https://pytorch.org/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"PyTorch","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EsmgtX43ew"}],"urlSource":"https://pytorch.org/","key":"ldVlyIbIR0"},{"type":"text","value":"はPythonのオープンソースの機械学習・深層学習ライブラリです。","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KTZIP1D2qK"}],"key":"WdGxI9X97w"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"柔軟性を重視した設計であり、さらに、機械学習・深層学習モデルをPythonの慣用的なクラスや関数の取り扱い方で実装できるようになっています。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ht0WfebhJB"}],"key":"TwTsVhzSi4"}],"key":"HHlepZmRuN"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"GPUを使用した計算をサポートしますので、CPU上で同じ計算を行う場合に比べて、数十倍の高速化を実現します。","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"DMZ2u5CpQH"}],"key":"Ad9xuWV8Wi"}],"key":"F4kJbdmYHR"}],"key":"yunHe3V6aL"}],"key":"rntE6qaxBB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#pip install torch torchvision torchaudio\nimport torch\nimport numpy as np","key":"FRbs23Vqk6"},{"type":"outputs","id":"xXaxkOKXQQLhf5NrPkjH_","children":[],"key":"kkR9yx580H"}],"key":"kAj4YiXtVZ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"テンソル","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DlHGsNwUWD"}],"identifier":"id","label":"テンソル","html_id":"id","implicit":true,"enumerator":"1","key":"OBrTvO03Qj"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"深層学習モデルは通常、入力から出力にどのようにマッピングされるのかを対応つけるデータ構造を表します。一般的に、このようなある形式のデータから別の形式への変換は膨大な浮動小数点数の計算を通じて実現されています。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wueCM84B3K"}],"key":"Eyx8Jmr2fu"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"データを浮動小数点数を扱うためには、Pytorchは基本的なデータ構造として「テンソル」を導入しています。","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"TJXsJ0aEiH"}],"key":"UwGbAvp1tI"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"深層学習の文脈でのテンソルとは、ベクトルや行列を任意の次元数に一般化したものを指します。つまり、多次元配列を扱います。","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"mXTgFK8QBU"}],"key":"YbGu7SKybW"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"QDtMGh1IFE"}],"key":"ieJJ512VZ4"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Tensorとの同じように、NumPyも多次元配列を扱えます。ただ、PyTorchにおいてテンソルはGPU上でも使用できるため、処理速度の向上させることも可能です。","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"YTmGgyyuVC"}],"key":"YyQWP2It91"}],"key":"OQF7dfscU5"},{"type":"image","url":"/build/tensor-39d5abfe83a0b6081901e497730ef873.png","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"wq3kihbGPI","urlSource":"./Figure/tensor.png"}],"key":"vXjnUKDJhe"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"テンソルの操作","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GaZWo7LBg1"}],"identifier":"id","label":"テンソルの操作","html_id":"id-1","implicit":true,"enumerator":"1.1","key":"Ssl5jTurW4"},{"type":"heading","depth":4,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"テンソルの作成","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"XHLq3FCLfl"}],"identifier":"id","label":"テンソルの作成","html_id":"id-2","implicit":true,"enumerator":"1.1.1","key":"bTShDEPz45"}],"key":"iKzQHCMJEa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"x = torch.ones(5, 3)\nprint(x)","key":"oZJfcAOunl"},{"type":"outputs","id":"6wj49sX-5kEbYP7mb48wr","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"tensor([[1., 1., 1.],\n        [1., 1., 1.],\n        [1., 1., 1.],\n        [1., 1., 1.],\n        [1., 1., 1.]])\n"},"children":[],"key":"BkUJEvXgHz"}],"key":"CZ4lr6QW6n"}],"key":"L5p0xxrD5h"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"x = torch.rand(5, 3)\nprint(x)","key":"bYoQxRIUgV"},{"type":"outputs","id":"tRLS869pwOS-TCuFBeLRo","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"tensor([[0.4255, 0.4716, 0.5521],\n        [0.3552, 0.6625, 0.4613],\n        [0.1074, 0.1958, 0.9927],\n        [0.3990, 0.8811, 0.9015],\n        [0.1934, 0.7353, 0.5517]])\n"},"children":[],"key":"H2V4hm5Hgj"}],"key":"BnzV1eDeVB"}],"key":"TYBUpaHYbz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"x = torch.tensor([5.5, 3])\nprint(x)","key":"GJoZVXDnXM"},{"type":"outputs","id":"hN_45RT_Kdqgvb2v0A08R","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"tensor([5.5000, 3.0000])\n"},"children":[],"key":"OoyIQlmHew"}],"key":"KJvygNt69G"}],"key":"AS4axULfzf"},{"type":"block","kind":"notebook-content","children":[{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"oY0IFIw1Yv"}],"key":"BhuOYA2OqQ"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"PyTorchのテンソルは、クラス torch.Tensor のインスタンスであり、\nValue（値・データ部分） と Method（メソッド・操作部分） を持つ**オブジェクト（object）**として実装されています。","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"v86cPG7518"}],"key":"FDJLCLvO0W"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Value には、実際の数値データ（多次元配列）が格納されています","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"xO6spabDRP"}],"key":"v2xTJWbb5L"}],"key":"wTeRlFU9HM"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Method には多くの演算関数が定義されており、これらを呼び出すことで、行列演算・転置・要素ごとの計算などの操作ができます","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"AHX1nezI9y"}],"key":"zSjxXvvave"}],"key":"IHbZLeZClZ"}],"key":"jTtLMnCJHc"}],"key":"jtevuBXtWk"}],"key":"rgvDhsPzHE"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"テンソル要素の型","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"olYYtmdien"}],"identifier":"id","label":"テンソル要素の型","html_id":"id-3","implicit":true,"enumerator":"1.1.2","key":"kUkBJaSToi"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"テンソル要素の型は、引数に適切な","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vajvjmvbaw"},{"type":"inlineCode","value":"dtype","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pRBgXtFcZs"},{"type":"text","value":"を渡すことで指定します。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bLZr67SSNj"}],"key":"wBIBHwxt1d"}],"key":"W89jNJDUKh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"double_points = torch.ones(10, 2, dtype=torch.double)\nshort_points = torch.tensor([[1, 2], [3, 4]], dtype=torch.short)","key":"kXRFtiHTOV"},{"type":"outputs","id":"WsuYagi4rJNFAerV7z_Uk","children":[],"key":"z3i2gAjzHq"}],"key":"aMRQr2E9Kh"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"テンソルの操作（変形・変換等）","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kGDCnioVft"}],"identifier":"id","label":"テンソルの操作（変形・変換等）","html_id":"id-4","implicit":true,"enumerator":"1.1.3","key":"YdF4HvR2PX"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"PyTorchにはテンソルに対する","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xTZe6iBNu3"},{"type":"link","url":"https://torch7.readthedocs.io/en/rtd/maths/index.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"操作（変形・演算など）","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"A8k6iYjwLM"}],"urlSource":"https://torch7.readthedocs.io/en/rtd/maths/index.html","key":"r3SovufFKd"},{"type":"text","value":"が多く用意されています。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RDi8oFCThT"}],"key":"H2kKuy7Mkb"}],"key":"hnNUYYDzI6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"x = torch.rand(5, 3)\ny = torch.rand(5, 3)\nprint(x + y)","key":"AqYApXAVXS"},{"type":"outputs","id":"k5Y4bsMj-1AbrABob9StE","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"tensor([[0.8623, 0.7859, 1.2484],\n        [1.4111, 1.1073, 0.7135],\n        [1.1091, 0.6681, 1.7415],\n        [0.6487, 1.0433, 1.1790],\n        [1.1507, 0.5620, 1.5918]])\n"},"children":[],"key":"QfvNiKaVW4"}],"key":"yPYFIj8UFr"}],"key":"QmrZB8UhPn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(torch.add(x, y))","key":"tLU68BfPW7"},{"type":"outputs","id":"3S3S2NVYB0AQPFWUSHRjq","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"tensor([[0.8623, 0.7859, 1.2484],\n        [1.4111, 1.1073, 0.7135],\n        [1.1091, 0.6681, 1.7415],\n        [0.6487, 1.0433, 1.1790],\n        [1.1507, 0.5620, 1.5918]])\n"},"children":[],"key":"zKBJrVADS9"}],"key":"W803RhGQ6l"}],"key":"g6jQAWH7s9"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"テンソルの一部指定や取り出し(Indexing)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"y5eLW8jqXl"}],"identifier":"id-indexing","label":"テンソルの一部指定や取り出し(Indexing)","html_id":"id-indexing","implicit":true,"enumerator":"1.1.4","key":"Td4nbNce6F"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Pytorchテンソルは、Numpyや他のPythonの科学計算ライブラリーと同じく、テンソルの次元ごとのレンジインデックス記法で一部指定や取り出しを行えます。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"a5A2qgCg99"}],"key":"TgfZvCnlYJ"}],"key":"FPWK0GmWS6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"x[3:,:]","key":"Qdu8QjB5kj"},{"type":"outputs","id":"_2Jr_6OzaCR8FbR3dMCUy","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/plain":{"content":"tensor([[0.0979, 0.9661, 0.7045],\n        [0.8860, 0.1049, 0.5975]])","content_type":"text/plain"}}},"children":[],"key":"oGvzD3L7Ic"}],"key":"gbbWfAjpu7"}],"key":"UUU9H7vp2w"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"x[1:,0]","key":"LcmyMiMB3v"},{"type":"outputs","id":"ai7w8Ewj-rFmcqlxa8CkS","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"tensor([0.9718, 0.8437, 0.0979, 0.8860])","content_type":"text/plain"}}},"children":[],"key":"D0cUWWzUeq"}],"key":"aJlNm5gz1O"}],"key":"Ro9OmBYPC0"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"テンソルの微分機能","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nwNjEDTZLH"}],"identifier":"id","label":"テンソルの微分機能","html_id":"id-5","implicit":true,"enumerator":"1.1.5","key":"XrFtQlAMIA"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"PyTorchテンソルは、テンソルに対して実行された計算を追跡し、計算結果の出力テンソルの微分を、各テンソルの要素に対して解析的に計算することができます。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bG7eo7ePy6"}],"key":"HvfyESGSwY"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"具体的には、","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"x68zLTuLID"},{"type":"inlineCode","value":"requires_grad=True","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"k27j47kWnn"},{"type":"text","value":" を設定したテンソルに対して行われたすべての演算が計算グラフとして記録され、","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"C9qxgc9Zv8"},{"type":"inlineCode","value":".backward()","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"e4j7aM0hGV"},{"type":"text","value":"メソッドを呼び出すことで、損失関数などの出力に対する各パラメータの勾配が自動的に計算されます。","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"lIZrsRnbJI"}],"key":"HCT2wdwNwi"}],"key":"OJgfKIrqIu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# 微分を計算するためのテンソルを作成\nx = torch.tensor(2.0, requires_grad=True)\n# 関数の定義\ny = x ** 2\n# 勾配を計算\ny.backward()\n\n# 勾配の値を表示\nprint(x.grad)  # 4.0 (これは2*xの値、x=2のとき)","key":"PS5rR6wn9V"},{"type":"outputs","id":"fZXsY6aQ68ANdNaAMIbca","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"tensor(4.)\n"},"children":[],"key":"oa3buKjpXU"}],"key":"rJNY9dXAiE"}],"key":"BAHdQ4Srec"},{"type":"block","kind":"notebook-content","children":[{"type":"tabSet","children":[{"type":"tabItem","title":"実習問題","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"次の関数について、各変数に対する勾配を求めなさい","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ijqywflwnx"}],"key":"EX96rHYsQN"},{"type":"math","value":"z = (x_1^2 + x_2^2) \\times y","position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>z</mi><mo>=</mo><mo stretchy=\"false\">(</mo><msubsup><mi>x</mi><mn>1</mn><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>x</mi><mn>2</mn><mn>2</mn></msubsup><mo stretchy=\"false\">)</mo><mo>×</mo><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">z = (x_1^2 + x_2^2) \\times y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1141em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641em;\"><span style=\"top:-2.453em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1141em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641em;\"><span style=\"top:-2.453em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span>","enumerator":"1","key":"WO7uWTg1Qh"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"ただし、","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"H3c0nfgDQg"},{"type":"inlineMath","value":"x_1=1.0","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub><mo>=</mo><mn>1.0</mn></mrow><annotation encoding=\"application/x-tex\">x_1=1.0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1.0</span></span></span></span>","key":"cEoMbe3W8c"},{"type":"text","value":", ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"VsGdLaKWLr"},{"type":"inlineMath","value":"x_2=2.0","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mn>2</mn></msub><mo>=</mo><mn>2.0</mn></mrow><annotation encoding=\"application/x-tex\">x_2=2.0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2.0</span></span></span></span>","key":"Ziui891Hmh"},{"type":"text","value":", ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"crw5u1Hmpz"},{"type":"inlineMath","value":"y=3.0","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi><mo>=</mo><mn>3.0</mn></mrow><annotation encoding=\"application/x-tex\">y=3.0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3.0</span></span></span></span>","key":"bPlSmQAC8v"},{"type":"text","value":" とする。","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"qrbKVqLZyQ"}],"key":"xuNk55tLhn"}],"key":"NY8eNUeuwZ"}],"key":"vjSVQuKHtf"}],"key":"lj11hx1Gjq"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"CUDA Tensors（CUDA テンソル）","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bApMz191Iv"}],"identifier":"cuda-tensors-cuda","label":"CUDA Tensors（CUDA テンソル）","html_id":"cuda-tensors-cuda","implicit":true,"enumerator":"1.1.6","key":"UCI8PqAOQs"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"tensorは ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ANaeAq3GrI"},{"type":"inlineCode","value":".to","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"z1fMStsZ5N"},{"type":"text","value":" メソッドを使用することであらゆるデバイス上のメモリへと移動させることができます。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TTYKZqrX4x"}],"key":"lMscpnRQuB"}],"key":"lnx3mCkvlr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"if torch.cuda.is_available():\n    device = torch.device(\"cuda\")          # a CUDA device object\n    y = torch.ones_like(x, device=device)  # directly create a tensor on GPU\n    x = x.to(device)                       # or just use strings ``.to(\"cuda\")``\n    z = x + y\n    print(z)\n    print(z.to(\"cpu\", torch.double))       # ``.to`` can also change dtype together!","key":"p0rTjbrNp3"},{"type":"outputs","id":"PKNpER_fRLFmO7UOfi2Ky","children":[],"key":"A3IPWfWIDp"}],"key":"Ml8ExuYsrs"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"学習データセットの作成","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"V4FrV7incV"}],"identifier":"id","label":"学習データセットの作成","html_id":"id-6","implicit":true,"enumerator":"2","key":"vR0DMFb4WM"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"深層学習を実装する際には、大量のデータを扱う必要があります。しかし、その際には次のような課題が生じます：","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tgQ1yxbwCk"}],"key":"suLTIrKwHn"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"データの読み込みや前処理のコードが複雑になる(","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"SgRrchVG9V"},{"type":"inlineCode","value":"for","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"iqbNR7SC5B"},{"type":"text","value":"文で個別処理する必要がある)","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"qwkSat7FGy"}],"key":"F9vY36uRLX"}],"key":"BKHPbnNyQb"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"学習時にデータをランダムにシャッフルしたり、ミニバッチに分割したりする必要がある","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"VjKBKH2zwd"}],"key":"JyfSu87qJC"}],"key":"MV82GYq4sH"}],"key":"vw2uSmdf1R"},{"type":"heading","depth":3,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"inlineCode","value":"Dataset","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"W1jOGc1ESK"},{"type":"text","value":"クラス","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"zFx5Mzw93P"}],"identifier":"dataset","label":"Datasetクラス","html_id":"dataset","implicit":true,"enumerator":"2.1","key":"F92wn7YHh8"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"PyTorchの","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"jA9AXbiIko"},{"type":"inlineCode","value":"torch.utils.data.Dataset","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"c8R8kqHwjL"},{"type":"text","value":"は、これらの課題を解決するために用意されたデータ管理の基本インターフェースです","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"cEsJlz2YkQ"}],"key":"aIPlYwASg9"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Pytorchで深層学習を実装する際には、特徴量行列とラベルを","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"sZWtLl4ZBz"},{"type":"inlineCode","value":"Dataset","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"n9lKx7zi4K"},{"type":"text","value":"というクラスに渡して、特徴量行列とラベルを一つのデータベース的なものにまとめる働きをします。","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"i3noF5Wma5"}],"key":"zU7chhLFv1"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"一般的には、PyTorchの","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"te1ZYPC69z"},{"type":"inlineCode","value":"torch.utils.data.Dataset","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"xBRFeBwiIq"},{"type":"text","value":"クラスを継承して定義します。以下に示すメソッドを定義するように指定されています。","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"MYFyega2L5"}],"key":"O3xwm041Qz"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":15,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"__init__(self)","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"m7APcvXFfW"},{"type":"text","value":": 初期実行関数です。Datasetを定義する際に必要な情報を受け取ります。","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"QfDH3gCQsh"}],"key":"nmTUEf9o3y"}],"key":"hz1lJMDJ1H"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"__len__(self)","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"sIzfnhGxie"},{"type":"text","value":": データ全体の数を返す関数です。","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"EHU7Urqrz3"}],"key":"dsJldvJjqe"}],"key":"aZDQUntgWx"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"__getitem__(self, index)","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"S7vfxOfTSc"},{"type":"text","value":": 指定されたindexに対応するデータと正解ラベル(ターゲット)を返します。これにより、データの取得方法を統一化します。","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"Phm6MdDTUM"}],"key":"fxaaA6bDBB"}],"key":"CvjQsTM2vG"}],"key":"hzUsQodcF3"}],"key":"hkXUsyBK1l"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from torch.utils.data import Dataset\n\n\nclass CustomDataset(Dataset):\n    def __init__(self, data, labels):\n        self.data = data\n        self.labels = labels\n\n    def __len__(self):\n        # データセットのサイズを返す\n        return len(self.data)\n\n    def __getitem__(self, index):\n        # 指定されたインデックスのデータとラベルを返す\n        return self.data[index], self.labels[index]","key":"TrDHI5ZUob"},{"type":"outputs","id":"1b0t0I9NJAw6uXskH6Jv9","children":[],"key":"QqSqKhwDdV"}],"key":"TONvWATGPV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# サンプルデータ\ndata = torch.tensor([[1.0, 2.0], [3.0, 4.0], [5.0, 6.0]])\nlabels = torch.tensor([0, 1, 0])\n\n# カスタムデータセットのインスタンスを作成\ndataset = CustomDataset(data, labels)","key":"M2hvef6zI0"},{"type":"outputs","id":"7E_x6H9MW9rW8C14TyjVB","children":[],"key":"LfAZVcTK8U"}],"key":"g1G4vuMdzr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"dataset[0]","key":"JgMGgtWqgF"},{"type":"outputs","id":"v9zD1J3b7DYowWKhZsNt6","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":65,"metadata":{},"data":{"text/plain":{"content":"(tensor([1., 2.]), tensor(0))","content_type":"text/plain"}}},"children":[],"key":"lQNnoYgD2h"}],"key":"ZxHELqkT5O"}],"key":"aPYcy7UYYp"},{"type":"block","kind":"notebook-content","children":[{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"TBL3g6Tix0"}],"key":"oikBOl9qqu"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"データをPyTorchテンソルに変換する前に、なんらかの加工を加えたい場合もあります。特に画像データに足して、","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"uvHgFwmlei"},{"type":"inlineCode","value":"transforms","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"YVGwfbUzUB"},{"type":"text","value":"は色々な前処理をサポートします。","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"VUn51xsE6g"}],"key":"ZmhPqZDRCu"}],"key":"odHsIrYZqD"}],"key":"wslmXG0PT8"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"inlineCode","value":"DataLoader","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xosFdffAsR"},{"type":"text","value":"クラス","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gIMIA0U4Wh"}],"identifier":"dataloader","label":"DataLoaderクラス","html_id":"dataloader","implicit":true,"enumerator":"2.2","key":"vkTDQ0sKwC"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"機械学習のトレーニングには、データセットのサンプリング、シャッフル、バッチ分割などの操作が必要されます。これらの操作を効率化にするために","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Tq9wAPH3uP"},{"type":"inlineCode","value":"DataLoader","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UkWyN1FugT"},{"type":"text","value":"クラスが用意されます。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dcD11eDffN"}],"key":"g2a8YbT3pX"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"バッチ処理: 指定したバッチサイズでデータを分割します","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"S7Ehbk8GwY"}],"key":"aJs6ZqD4DN"}],"key":"FePbEzM9kL"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"シャッフル: データの順序をランダムに並べ替えられます","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"JUgnHC4EOL"}],"key":"ixSiZmaKNE"}],"key":"NRzDpmsPxA"}],"key":"z1Rb4kFgW9"}],"key":"eoYDd2NUe0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# サンプルデータ\ndata = torch.randn(100, 3)  # 100個のデータ、3つの特徴\nlabels = torch.randint(0, 2, (100,))  # 100個のラベル (0または1)\ndataset = CustomDataset(data, labels)","key":"DqmK59caWY"},{"type":"outputs","id":"uxVf3j0qwz2d8tqBulGbG","children":[],"key":"y9DH2wDB6E"}],"key":"Uc8PxI5OQa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from torch.utils.data import DataLoader\n\ndataloader = DataLoader(dataset, batch_size=10, shuffle=True)","key":"beH2ZB8qUI"},{"type":"outputs","id":"ydkUupD92-6mypmNjauM4","children":[],"key":"tjVNG7tlxF"}],"key":"BmgPFW11oT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"dataloader","key":"y8VnF3NOsg"},{"type":"outputs","id":"fgLMyYkLpIfGoJ0rIl_Pl","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":68,"metadata":{},"data":{"text/plain":{"content":"<torch.utils.data.dataloader.DataLoader at 0x33d9997f0>","content_type":"text/plain"}}},"children":[],"key":"HUs9dmtYS2"}],"key":"WCVutiGLvU"}],"key":"RqNaR1Tavv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"for batch_data, batch_labels in dataloader:\n    print(\"Batch data shape:\", batch_data.shape)\n    print(\"Batch labels shape:\", batch_labels.shape)","key":"wz1Lzfb4a8"},{"type":"outputs","id":"bA1yt-d64tARjLqWVv2Nh","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Batch data shape: torch.Size([10, 3])\nBatch labels shape: torch.Size([10])\nBatch data shape: torch.Size([10, 3])\nBatch labels shape: torch.Size([10])\nBatch data shape: torch.Size([10, 3])\nBatch labels shape: torch.Size([10])\nBatch data shape: torch.Size([10, 3])\nBatch labels shape: torch.Size([10])\nBatch data shape: torch.Size([10, 3])\nBatch labels shape: torch.Size([10])\nBatch data shape: torch.Size([10, 3])\nBatch labels shape: torch.Size([10])\nBatch data shape: torch.Size([10, 3])\nBatch labels shape: torch.Size([10])\nBatch data shape: torch.Size([10, 3])\nBatch labels shape: torch.Size([10])\nBatch data shape: torch.Size([10, 3])\nBatch labels shape: torch.Size([10])\nBatch data shape: torch.Size([10, 3])\nBatch labels shape: torch.Size([10])\n"},"children":[],"key":"to1B5hpUUJ"}],"key":"cSpObOz877"}],"key":"M3TpNk7LcB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# 最初のバッチを取得\ndata_iter = iter(dataloader)\nsample_data, sample_label = next(data_iter)\n\n# 1つ目のサンプルのデータとラベルを確認\nprint(\"Sample data:\", sample_data[0])\nprint(\"Sample label:\", sample_label[0])","key":"tPL2pM1dZ4"},{"type":"outputs","id":"fCcxUbCdY9eoBvo1AIYtX","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Sample data: tensor([ 1.6532,  1.1142, -1.5178])\nSample label: tensor(1)\n"},"children":[],"key":"I7Lc59x5VA"}],"key":"WF2mPhOACe"}],"key":"okzzDcmEFM"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"inlineCode","value":"DataLoader","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bZ6W28K9NJ"},{"type":"text","value":"は反復処理が可能なので、トレーニング中のループで直接に使用することができます。","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZwNQU6HuC2"}],"key":"Rx8fY2bpjF"}],"key":"BvqdwhfKfs"},{"type":"block","kind":"notebook-content","children":[{"type":"admonition","kind":"custom","class":"dropdown tohokupurple","icon":"question","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"イテレーターとは","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"e0DvkmhpMY"}],"key":"XG6DzXqE0e"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"inlineCode","value":"iter(dataloader)","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"e2X8y64UZk"},{"type":"text","value":"は、","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"TLrzN3D5I4"},{"type":"inlineCode","value":"DataLoader","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"I3f7Z9OnpD"},{"type":"text","value":"オブジェクトからイテレーターを作成します。 イテレーターは順次データを取り出すためのオブジェクトで、","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"UegJU4g8TN"},{"type":"inlineCode","value":"for","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"QX7ubaGTGA"},{"type":"text","value":"ループや","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"hqeKgVVXwD"},{"type":"inlineCode","value":"next()","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"zZP6ax5rhu"},{"type":"text","value":"を使用して1つずつデータを取得できます。","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Vw4nb7tmd6"}],"key":"AuRpO1bA9C"}],"key":"TOA5J391qM"}],"key":"fK2G3Gf8dB"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"深層学習モデルの構築","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"J4FsXZuv6U"}],"identifier":"id","label":"深層学習モデルの構築","html_id":"id-7","implicit":true,"enumerator":"3","key":"qJS7sLWyW5"}],"key":"Eg4V3X7pzm"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"link","url":"https://pytorch.org/docs/stable/nn.html","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"inlineCode","value":"torch.nn","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aSokKVWab4"}],"urlSource":"https://pytorch.org/docs/stable/nn.html","key":"Wo0vCXJc4L"},{"type":"text","value":"で用意されているクラス、関数は、独自のニューラルネットワークを構築するために必要な要素を網羅しています。","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"egTyXqSZ4r"}],"key":"idEKpfyvHH"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"PyTorchの全てのモジュールは、","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ujD7cYeOH5"},{"type":"link","url":"https://pytorch.org/docs/stable/generated/torch.nn.Module.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"nn.Module","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wn2cZQ2Ka7"}],"urlSource":"https://pytorch.org/docs/stable/generated/torch.nn.Module.html","key":"ET0dGhyiKC"},{"type":"text","value":"を継承しています。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"E19PiDVs0b"}],"key":"LnKWbv3R03"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"そしてニューラルネットワークは、モジュール自体が他のモジュール（レイヤー）から構成されています。","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"I1AeKbKVJI"}],"key":"EsftzEO2oK"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"この入れ子構造により、複雑なアーキテクチャを容易に構築・管理することができます。","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"IcejosWIjI"}],"key":"o2YxltDPBf"}],"key":"TPdHf8QsVE"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"クラスの定義","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"H7D1huFXEl"}],"identifier":"id","label":"クラスの定義","html_id":"id-8","implicit":true,"enumerator":"3.1","key":"Wq09cZmQDW"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"nn.Module","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"D0dSV69C6x"},{"type":"text","value":"を継承し、独自のネットワークモデルを定義し、その後ネットワークのレイヤーを ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Pn8dwIbDAC"},{"type":"inlineCode","value":"__init__","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VpOZ5vGaCc"},{"type":"text","value":"で初期化します。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GFPxCT1jF5"}],"key":"omfq7wb0mw"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"inlineCode","value":"nn.Module","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"JR8uF2Yat1"},{"type":"text","value":" を継承した全モジュールは、入力データの順伝搬関数である","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"iknfmaXiz3"},{"type":"inlineCode","value":"forward","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"aiKyrpvWES"},{"type":"text","value":"関数を持ちます。","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"r1QJRH1Fjg"}],"key":"p97dvXOmRg"}],"key":"h8DoJZ1B6l"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from torch import nn","key":"uhYeV7p6KO"},{"type":"outputs","id":"KzZZvblRCu00nBtfylApb","children":[],"key":"zXTUNCDD4y"}],"key":"H4X6McuIf8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"class NeuralNetwork(nn.Module):\n    def __init__(self):\n        super(NeuralNetwork, self).__init__()\n        self.linear_relu_stack = nn.Sequential(\n            nn.Linear(512, 128),\n            nn.ReLU(),\n            nn.Linear(128, 128),\n            nn.ReLU(),\n            nn.Linear(128, 3),\n            nn.ReLU()\n        )\n\n    def forward(self, x):\n        logits = self.linear_relu_stack(x)\n        return logits","key":"Hn6pjcUiFv"},{"type":"outputs","id":"gq1K6o5_WIc9VctPwlq_4","children":[],"key":"kXVjiI92DN"}],"key":"jgjMKHvC7N"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"このクラスは、PyTorchの","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ta9ELNsgFR"},{"type":"inlineCode","value":"nn.Module","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"scvv7dN2jf"},{"type":"text","value":"を継承した単純なニューラルネットワークの実装を示しています。入力は固定長の","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fAgk8vLWLe"},{"type":"text","value":"512","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VHa44XunM8"},{"type":"text","value":"とされており、出力は","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cK36TquSEl"},{"type":"text","value":"3","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CP7v0UulzZ"},{"type":"text","value":"の次元を持つベクトルです。","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VK2Y85pUrM"}],"key":"tz1sI9z6j3"},{"type":"aside","children":[{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"最大長512であるテキストに対して、センチメント(ポジティブ、中立、ネガティブ)を予測するタスクをイメージしてください。","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"FfwnK0mO6n"}],"key":"bOkHb7uHkz"}],"key":"vPLcJz3r37"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"self.linear_relu_stack","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"BHrz2iwdef"},{"type":"text","value":": このシーケンシャルな層は、3つの線形層とそれぞれの後に続くReLU活性化関数から構成されています。","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"XpWTamuYKd"}],"key":"mQ1O5HAHHJ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":8,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"link","url":"https://pytorch.org/docs/stable/generated/torch.nn.Sequential.html","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"inlineCode","value":"nn.Sequential","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"xrCnK0zQUU"}],"urlSource":"https://pytorch.org/docs/stable/generated/torch.nn.Sequential.html","key":"HN8SzQBMUR"},{"type":"text","value":"にレイヤーを順に渡すだけで、数のレイヤーを順に積み重ねたモデルを簡単に定義できます。","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"RqehqvKSPO"}],"key":"AlXmN1DEbx"}],"key":"EUGR4bTqHo"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"link","url":"https://pytorch.org/docs/stable/generated/torch.nn.Linear.html","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"inlineCode","value":"linear layer","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"X6wS66Pmca"}],"urlSource":"https://pytorch.org/docs/stable/generated/torch.nn.Linear.html","key":"zFaoPpkd6V"},{"type":"text","value":"は、線形変換を施します。","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"VllJeU0tbJ"},{"type":"inlineCode","value":"linear layer","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"FWoz2tk91s"},{"type":"text","value":"は重みとバイアスのパラメータを保持しています。","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"IVbAlvZkTs"}],"key":"fVtDiB8Lo0"}],"key":"RrqKb8T5Mt"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"link","url":"https://pytorch.org/docs/stable/generated/torch.nn.ReLU.html","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"inlineCode","value":"nn.ReLU","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"gyWLPMMsuR"}],"urlSource":"https://pytorch.org/docs/stable/generated/torch.nn.ReLU.html","key":"ysfYz9iRxZ"},{"type":"text","value":"という活性化関数を設置することで、ニューラルネットワークの表現力を向上させます。","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"yZqj5ScIcD"}],"key":"AUlyiUT7HV"}],"key":"pKYUg6kJyd"}],"key":"JUmmBEs6k5"}],"key":"AAKBXKnjMw"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"順伝播メソッド (","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"QYIR8ysnfq"},{"type":"inlineCode","value":"forward","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Th5xMd4Arc"},{"type":"text","value":"): 入力テンソル","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"b0pDDSMilP"},{"type":"inlineCode","value":"x","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ERAhLP3JBi"},{"type":"text","value":"を受け取り、ネットワークを通して出力を生成する機能を持ちます。","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"WMQBdCT2gm"}],"key":"zrhzC2c23r"}],"key":"d6LDfZlNQf"}],"key":"W8OdSg7ixt"}],"key":"QkEpbE3RUw"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"GPUの利用","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UDtg5mBvfu"}],"identifier":"gpu","label":"GPUの利用","html_id":"gpu","implicit":true,"enumerator":"3.2","key":"eF3duNWHag"}],"key":"RFBM3Xq59U"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"inlineCode","value":"NeuralNetwork","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"voHbjfLywJ"},{"type":"text","value":"クラスのインスタンスを作成し、変数","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JtmPkEZzSs"},{"type":"inlineCode","value":"device","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vxABjUgIcl"},{"type":"text","value":"上に移動させます。","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rCbL9xqlGP"}],"key":"PFAEuyeTl3"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"以下でネットワークの構造を出力し確認します。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nQjNiVzcf6"}],"key":"EPK3DpSSL5"}],"key":"HMXkbJGzgV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"device = 'cuda' if torch.cuda.is_available() else 'cpu'\nprint('Using {} device'.format(device))","key":"U6gbvYb0th"},{"type":"outputs","id":"apKN5hdfvXPwdlbHbqfms","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Using cpu device\n"},"children":[],"key":"vwzdYHfv0v"}],"key":"jwa7EAeWzN"}],"key":"n49J3jdGSL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"model = NeuralNetwork().to(device)\nprint(model)","key":"ZxA2WAmUs5"},{"type":"outputs","id":"Jx5O1g773DLX66UoJ81Cr","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"NeuralNetwork(\n  (linear_relu_stack): Sequential(\n    (0): Linear(in_features=512, out_features=128, bias=True)\n    (1): ReLU()\n    (2): Linear(in_features=128, out_features=128, bias=True)\n    (3): ReLU()\n    (4): Linear(in_features=128, out_features=3, bias=True)\n    (5): ReLU()\n  )\n)\n"},"children":[],"key":"lcISBykw7o"}],"key":"lfqZZf1mDL"}],"key":"PZT9rLgHAv"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"モデルによる計算","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"J6Omb5uaAX"}],"identifier":"id","label":"モデルによる計算","html_id":"id-9","implicit":true,"enumerator":"3.3","key":"fRlaJfUtri"}],"key":"VylbSqSURA"},{"type":"block","kind":"notebook-content","children":[{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"ニューラルネットワークの最後のlinear layerは","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zKIY76nliV"},{"type":"inlineCode","value":"logits","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vn8y1fm2QT"},{"type":"text","value":"を出力します。この","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VBteqSatZz"},{"type":"inlineCode","value":"logits","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kSSeMRU89a"},{"type":"text","value":"は","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eIlQXMcGYQ"},{"type":"link","url":"https://pytorch.org/docs/stable/generated/torch.nn.Softmax.html","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"inlineCode","value":"nn.Softmax","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yrjVZjkQxZ"}],"urlSource":"https://pytorch.org/docs/stable/generated/torch.nn.Softmax.html","key":"j8uxw6otqk"},{"type":"text","value":"モジュールへと渡されます。出力ベクトルの要素の値は","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lFQ91CH8bV"},{"type":"inlineMath","value":"[0, 1]","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[0, 1]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span></span></span></span>","key":"eSba8YuhnI"},{"type":"text","value":"の範囲となり、これは各クラスである確率を示します。","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KHkl0yrUKq"}],"key":"IWvsBBBxMU"}],"key":"w4bBofX3Hf"}],"key":"oW5JYRjY8d"}],"key":"uqUUgdcotO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"X = torch.rand(3, 512, device=device)\nlogits = model(X) \nprint(logits)","key":"rjx1aiekjJ"},{"type":"outputs","id":"Fv10lF4AK2juGRzmvT6em","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"tensor([[0.0000, 0.0000, 0.0957],\n        [0.0003, 0.0000, 0.0991],\n        [0.0163, 0.0000, 0.0933]], grad_fn=<ReluBackward0>)\n"},"children":[],"key":"LuMCBTHowD"}],"key":"j9XP2g9Yju"}],"key":"NMubSRrsWY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"pred_probab = nn.Softmax(dim=1)(logits)\ny_pred = pred_probab.argmax(1)\nprint(f\"Predicted class: {y_pred}\")","key":"SEusatP5FN"},{"type":"outputs","id":"yr46lgp4lxrQUgLFIH9Mn","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Predicted class: tensor([2, 2, 2])\n"},"children":[],"key":"tHS7NOCEJg"}],"key":"P7ffckhXXn"}],"key":"ISdNLHRxl7"},{"type":"block","kind":"notebook-content","children":[{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"おまけ：tensorboard","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"C7hvYmwzEV"}],"key":"hrTi5UzLPw"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"tensorboardでニューラルネットワークの構造を確認する。","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"YxLh7bqVWo"}],"key":"DSzPKxp9ja"},{"type":"code","lang":"python","value":"from torch.utils.tensorboard import SummaryWriter\nX = torch.rand(3, 28, 28)\nwriter = SummaryWriter(\"torchlogs/\")\nwriter.add_graph(model, X)\nwriter.close()","position":{"start":{"line":6,"column":1},"end":{"line":11,"column":1}},"key":"UfkcI3gEqi"}],"class":"tip, dropdown","key":"YY8T90I5QT"},{"type":"code","lang":"","value":"","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"dWOSeXCG4q"}],"key":"xnkzj0MIKb"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"自動微分","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dSRPydm93Q"}],"identifier":"id","label":"自動微分","html_id":"id-10","implicit":true,"enumerator":"4","key":"rHn3Y9Fb6a"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"ニューラルネットワークを訓練する際、その学習アルゴリズムとして、","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"FosC663e6R"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"バックプロパゲーション（back propagation）","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jfFENgzSoT"}],"key":"DRwjsAarNe"},{"type":"text","value":" がよく使用されます。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ilrradvOaA"}],"key":"S3bGe4kFFt"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"バックプロパゲーションでは、モデルの重みなどの各パラメータは、損失関数に対するその変数の微分値（勾配）に応じて調整されます。","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"YQsZYUtE9R"}],"key":"fNbAmv3vTn"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"これらの勾配の値を計算するために、PyTorchには","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"aw5HlQ5VYP"},{"type":"inlineCode","value":"torch.autograd","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"FqqmFvQHKJ"},{"type":"text","value":" という微分エンジンが組み込まれています。","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"c2DqtA7vxD"}],"key":"Fg4UNRXU1m"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"autogradはPyTorchの計算グラフに対する勾配の自動計算を支援します。","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"RMlT9EzcV6"}],"key":"KGoe0jN2CE"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"シンプルな1レイヤーのネットワークを想定しましょう。","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"mF8AUJEqUE"}],"key":"hDeEwDKrmn"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"入力を","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"sBBDMQdTBr"},{"type":"inlineCode","value":"x","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"LynkY04UBJ"},{"type":"text","value":"、パラメータを","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"yOgUkYh4qU"},{"type":"inlineCode","value":"w","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"d8hraA1HCc"},{"type":"text","value":" と ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"xCGwdSBDPv"},{"type":"inlineCode","value":"b","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"vuc4O056zI"},{"type":"text","value":"、そして適切な損失関数を決めます。","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"iNljMlRY26"}],"key":"m4q4MNvIWY"},{"type":"break","key":"GZDDJ4EuYr"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"PyTorchでは例えば以下のように実装します。","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"kACBqdCnIT"}],"key":"aZwE37VF33"}],"key":"l6ROHrlHTa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import torch\n\nx = torch.rand(5)  # input tensor\ny = torch.zeros(3)  # expected output\nw = torch.randn(5, 3, requires_grad=True)\nb = torch.randn(3, requires_grad=True)\nz = torch.matmul(x, w)+b\nloss = torch.nn.functional.binary_cross_entropy_with_logits(z, y)","key":"JasJH5O9cZ"},{"type":"outputs","id":"dJMZUmYqQ4yY1i7nC-xF5","children":[],"key":"WryTC4B91d"}],"key":"VxiYRYxe6u"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"勾配情報の保存","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DR8K0B5XOz"}],"identifier":"id","label":"勾配情報の保存","html_id":"id-11","implicit":true,"enumerator":"4.1","key":"v6G4MpYzkt"}],"key":"zHIILmNrqB"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"こののニューラルネットワークでは、","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HLaAFpzt0D"},{"type":"inlineCode","value":"w","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"h4uJTLZLLt"},{"type":"text","value":"と","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"o1amLJGXCZ"},{"type":"inlineCode","value":"b","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yQeRAocHwY"},{"type":"text","value":"が最適したいパラメータです。","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QaqPq3aKw0"}],"key":"luZYghAhhR"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"そのため、これらの変数に対する損失関数の微分値を計算する必要があります。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lUJyamwuN5"}],"key":"vItazo8AS2"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"これらのパラメータで微分を可能にするために、","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Kxh04Pf7Gm"},{"type":"inlineCode","value":"requires_grad","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"teAFMh8jOx"},{"type":"text","value":"属性をこれらのテンソルに追記します。","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"RnZRL623hJ"}],"key":"WjRQm32FeX"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"そうすると、勾配は、テンソルの ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"oT8Jrb6BHQ"},{"type":"inlineCode","value":"grad_fn","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"gKkRBQjPS8"},{"type":"text","value":" プロパティに格納されます。","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"UgvmhiEZ4A"}],"key":"L7TViPbWqr"}],"key":"HbbBUChlIw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print('Gradient function for z =',z.grad_fn)\nprint('Gradient function for loss =', loss.grad_fn)","key":"Cm6TwlSKOM"},{"type":"outputs","id":"RoNHihtNPDoAGVRvhIvmW","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Gradient function for z = <AddBackward0 object at 0x17f4ef190>\nGradient function for loss = <BinaryCrossEntropyWithLogitsBackward0 object at 0x17f4ef190>\n"},"children":[],"key":"MT9GCQoKm6"}],"key":"Y6tv7MX6pR"}],"key":"Fh9TkP2Q1Y"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"勾配計算","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"J9rMVB5cbn"}],"identifier":"id","label":"勾配計算","html_id":"id-12","implicit":true,"enumerator":"4.2","key":"g9XTQY0AMv"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"ニューラルネットワークの各パラメータを最適化するために、入力","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Y2hCleZ5bx"},{"type":"inlineCode","value":"x","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zlBlX6CncN"},{"type":"text","value":"と出力","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Q5lFpxWP0p"},{"type":"inlineCode","value":"y","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PEweibun36"},{"type":"text","value":"が与えられたもとで、損失関数の各変数の偏微分値、","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Z7hnmPHVb9"}],"key":"th1EH7LcDA"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"すなわち","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"IVGn6Cvyd5"}],"key":"Qt2hnlqCbq"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"inlineMath","value":"\\frac{\\partial loss}{\\partial w}","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mi mathvariant=\"normal\">∂</mi><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi></mrow><mrow><mi mathvariant=\"normal\">∂</mi><mi>w</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{\\partial loss}{\\partial w}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2251em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8801em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\" style=\"margin-right:0.05556em;\">∂</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02691em;\">w</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\" style=\"margin-right:0.05556em;\">∂</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal mtight\">oss</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>","key":"IzkSr6YN8i"},{"type":"text","value":" 、","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"FojEFEgffJ"},{"type":"inlineMath","value":"\\frac{\\partial loss}{\\partial b}","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mi mathvariant=\"normal\">∂</mi><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi></mrow><mrow><mi mathvariant=\"normal\">∂</mi><mi>b</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{\\partial loss}{\\partial b}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2251em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8801em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\" style=\"margin-right:0.05556em;\">∂</span><span class=\"mord mathnormal mtight\">b</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\" style=\"margin-right:0.05556em;\">∂</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal mtight\">oss</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>","key":"rmuAODAYRk"}],"key":"m7X9FvcFYq"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"を求める必要があります。","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"u4qGB78QIy"}],"key":"Q6nf8YdC6p"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"これらの偏微分値を求めるために","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"NqpjZmLtmi"},{"type":"inlineCode","value":"loss.backward()","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"hiBE24trEL"},{"type":"text","value":"を実行し、","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"nx6RpxK8ON"},{"type":"inlineCode","value":"w.grad","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"CYieYDCAu8"},{"type":"text","value":"と","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"HVPUIUton6"},{"type":"inlineCode","value":"b.grad","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"q4MOd5IBk5"},{"type":"text","value":"の値を導出します。","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"NS5wib4Va7"}],"key":"FN4E1EN9vY"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"逆伝搬では、","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"N5HyXQp9oO"},{"type":"inlineCode","value":".backward()","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"byzI04IkEl"},{"type":"text","value":"がテンソルに対して実行されると、autogradは、","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"jPkpr6s1Ie"}],"key":"olYTNQ0EV5"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":15,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"各変数の ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"BasJQXY03H"},{"type":"inlineCode","value":".grad_fn","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"Jth4lFMdWP"},{"type":"text","value":"を計算する","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"eaQzKywUjN"}],"key":"CFEeWYf4Jj"}],"key":"O2NwXDskAm"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"各変数の","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"YcLnrtLsLE"},{"type":"inlineCode","value":".grad","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"BrtoT6lfn8"},{"type":"text","value":"属性に微分値を代入する","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"kL8xoP8f61"}],"key":"zYiHACCUS3"}],"key":"MYI7wPJS3L"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"微分の連鎖律を使用して、各leafのテンソルの微分値を求める","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"jTWzSSFCSL"}],"key":"EQQehEQlcQ"}],"key":"rljNesd4Ym"}],"key":"vj9XJhjMp9"},{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"を行います。","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"JOsOcTvQkA"}],"key":"Quw4Q8rC6X"}],"key":"VQ6KZbcf5R"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"loss.backward()\nprint(w.grad)\nprint(b.grad)","key":"UShKUqLjrt"},{"type":"outputs","id":"n2iBHLJTU1dv0-RsXaXOL","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"tensor([[0.0223, 0.0256, 0.0265],\n        [0.1082, 0.1243, 0.1287],\n        [0.0092, 0.0106, 0.0109],\n        [0.1678, 0.1928, 0.1995],\n        [0.2269, 0.2606, 0.2698]])\ntensor([0.2299, 0.2640, 0.2734])\n"},"children":[],"key":"v0uxXCAELw"}],"key":"ksNXBMzGV0"}],"key":"RZlSzZbv5W"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"最適化ループを構築し、Pytorchより自動的に逆伝播","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PYO239kcMI"}],"key":"JzXXMToOtI"}],"key":"SONtK4WJXi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import torch.nn.functional as F\n\ndef training_loop(n_epochs, learning_rate, model, input, target):\n    for epoch in range(1, n_epochs + 1):\n        # Forward pass\n        outputs = model(input)\n        \n        # Compute the loss using Binary Cross Entropy with Logits\n        loss = F.binary_cross_entropy_with_logits(outputs, target)\n        \n        # Backward pass\n        loss.backward()\n        \n        # Update the parameters\n        with torch.no_grad():\n            for param in model.parameters():\n                param -= learning_rate * param.grad\n        model.zero_grad()\n        # Zero the parameter gradients after updating \n        if epoch % 100 == 0:\n            print(f\"Epoch {epoch}, Loss: {loss.item()}\")\n\n    return model","key":"ID9Y6iHdqE"},{"type":"outputs","id":"tihkRx5Kv4o8N6m8FWLVX","children":[],"key":"FAcjZKMLUe"}],"key":"uL4Py7B0nM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Example usage (with dummy data)\ninput = torch.rand(10, 512)  # 10 samples with 512 features each\ntarget = torch.rand(10, 3)  # 10 samples with 3 target values each\n\nn_epochs = 500\nlearning_rate = 0.01\nmodel = NeuralNetwork()\n\ntrained_model = training_loop(n_epochs, learning_rate, model, input, target)\n","key":"MApw7MVeVx"},{"type":"outputs","id":"GwAnVWEqG6lgAXQXjvL3H","children":[{"type":"output","jupyter_data":{"ename":"NameError","evalue":"name 'NeuralNetwork' is not defined","output_type":"error","traceback":"\u001b[0;31m---------------------------------------------------------------------------\u001b[0m\n\u001b[0;31mNameError\u001b[0m                                 Traceback (most recent call last)\nCell \u001b[0;32mIn[21], line 7\u001b[0m\n\u001b[1;32m      5\u001b[0m n_epochs \u001b[38;5;241m=\u001b[39m \u001b[38;5;241m500\u001b[39m\n\u001b[1;32m      6\u001b[0m learning_rate \u001b[38;5;241m=\u001b[39m \u001b[38;5;241m0.01\u001b[39m\n\u001b[0;32m----> 7\u001b[0m model \u001b[38;5;241m=\u001b[39m \u001b[43mNeuralNetwork\u001b[49m()\n\u001b[1;32m      9\u001b[0m trained_model \u001b[38;5;241m=\u001b[39m training_loop(n_epochs, learning_rate, model, \u001b[38;5;28minput\u001b[39m, target)\n\n\u001b[0;31mNameError\u001b[0m: name 'NeuralNetwork' is not defined"},"children":[],"key":"WGqcHC0oSP"}],"key":"epyzWxrJmq"}],"key":"EqOgzMmLMy"},{"type":"block","kind":"notebook-content","children":[{"type":"admonition","kind":"custom","class":"dropdown tohokupurple","icon":"question","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"PyTorchにおける勾配計算の初期化","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"gjVhqzS2PZ"}],"key":"zP2R9cC5hz"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"PyTorchの勾配計算メカニズムでは、","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ihMg48yqIs"},{"type":"inlineCode","value":".backward","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"rJfpng0vUW"},{"type":"text","value":"を呼び出すと、リーフノードで導関数の計算結果が累積されます。つまり、もし","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"eQPGEzK5m8"},{"type":"inlineCode","value":".backward","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Jo6n7dFATq"},{"type":"text","value":"が以前にも呼び出されていた場合、損失関数が再び計算され、","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"cnZTeJUxrJ"},{"type":"inlineCode","value":".backward","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"KTb5Ng2UVY"},{"type":"text","value":"も再び呼び出され、各リーフの勾配が前の反復で計算された結果の上に累積されます。その結果、勾配の値は誤ったものになります。","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"aFOeP1AY31"}],"key":"KHpbnZ4M9w"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"このようなことが起こらないようにするためには、反復のルーブのたびに","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"NH1zsEGokY"},{"type":"inlineCode","value":"model.zero_grad()","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"UaDFCkikOD"},{"type":"text","value":"を用いて明示的に勾配をゼロに設定する必要があります。","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"LJfz6MTu6R"}],"key":"rO1QIiXtpg"}],"key":"kKmnVeiCmt"}],"key":"Jmm6nHSSNQ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"最適化関数","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"feckjTzWii"}],"identifier":"id","label":"最適化関数","html_id":"id-13","implicit":true,"enumerator":"4.3","key":"FFFA7xy8Qc"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"最適化は各訓練ステップにおいてモデルの誤差を小さくなるように、モデルパラメータを調整するプロセスです。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gFGT6UuIWj"}],"key":"Gx4MzHzEZu"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"ここまでの説明は、単純な勾配下降法を最適化に使用しました。これは、シンプルなケースでは問題なく機能しますが、モデルが複雑になったときのために、パラメータ学習の収束を助ける最適化の工夫が必要されます。","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"rrny2rks2b"}],"key":"XnujS9DpL4"},{"type":"heading","depth":4,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Optimizer","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"lnV5lTz5zy"}],"identifier":"optimizer","label":"Optimizer","html_id":"optimizer","implicit":true,"enumerator":"4.3.1","key":"eTSD5ELy2z"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"inlineCode","value":"optim","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"YaoZYAWeaC"},{"type":"text","value":"というモジュールには、様々な最適化アルゴリズムが実装されています。","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"rfJF3c1pRK"}],"key":"ZUi4Aj7vPC"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"ここでは、確率的勾配降下法（Stochastic Gradient Descent）を例として使い方を説明します。","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"JR2i8A3LFz"}],"key":"l0LqrWumnL"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"確率的勾配降下法は、ランダムに選んだ１つのデータのみで勾配を計算してパラメータを更新し、データの数だけ繰り返す方法です。","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"NsHV77j1Cg"}],"key":"EAnLIpl3Aq"}],"key":"l369jihhkh"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"訓練したいモデルパラメータをoptimizerに登録し、合わせて学習率をハイパーパラメータとして渡すことで初期化を行います。訓練ループ内で、最適化（optimization）は3つのステップから構成されます。","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PP9t8lEh5N"}],"key":"dXMUW2SleH"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"optimizer.zero_grad()","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Eib4DXDwKu"},{"type":"text","value":"を実行し、モデルパラメータの勾配をリセットします。勾配の計算は蓄積されていくので、毎イテレーション、明示的にリセットします。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mHuLwe2LeK"}],"key":"pkYmJ7Z0WS"}],"key":"hNfiZBO4iP"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"続いて、","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"mGXzYh7a31"},{"type":"inlineCode","value":"loss.backwards()","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"LJUgC9WDX7"},{"type":"text","value":"を実行し、バックプロパゲーションを実行します。PyTorchは損失に対する各パラメータの偏微分の値（勾配）を求めます。","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"X0We1WNVeN"}],"key":"JLK5kBnVw8"}],"key":"zY2CLmYPEi"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"最後に、","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"pRvxT27St3"},{"type":"inlineCode","value":"optimizer.step()","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"VCJONVWMmZ"},{"type":"text","value":"を実行し、各パラメータの勾配を使用してパラメータの値を調整します。","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"xMVCi1R7Sv"}],"key":"ET2zgB1sU8"}],"key":"Joi08tSWhT"}],"key":"k5vnHghfPf"}],"key":"C6H2LgxZd3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"optimizer = torch.optim.SGD(model.parameters(), lr=learning_rate)","key":"D97I96kjg0"},{"type":"outputs","id":"qKQzc2tQXsUrCSaJyZmXr","children":[{"type":"output","jupyter_data":{"ename":"NameError","evalue":"name 'model' is not defined","output_type":"error","traceback":"\u001b[0;31m---------------------------------------------------------------------------\u001b[0m\n\u001b[0;31mNameError\u001b[0m                                 Traceback (most recent call last)\nCell \u001b[0;32mIn[22], line 1\u001b[0m\n\u001b[0;32m----> 1\u001b[0m optimizer \u001b[38;5;241m=\u001b[39m torch\u001b[38;5;241m.\u001b[39moptim\u001b[38;5;241m.\u001b[39mSGD(\u001b[43mmodel\u001b[49m\u001b[38;5;241m.\u001b[39mparameters(), lr\u001b[38;5;241m=\u001b[39mlearning_rate)\n\n\u001b[0;31mNameError\u001b[0m: name 'model' is not defined"},"children":[],"key":"iwiO3ujTBv"}],"key":"YC2kHnXTE6"}],"key":"OMrXPaYuCV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def training_loop(n_epochs, learning_rate, model, input, target):\n    # Use Binary Cross Entropy with Logits as the loss function\n    \n    # Use Adam as the optimizer\n    optimizer = torch.optim.SGD(model.parameters(), lr=learning_rate)\n    \n    for epoch in range(1, n_epochs + 1):\n        # Zero the parameter gradients\n        optimizer.zero_grad()\n        \n        # Forward pass\n        outputs = model(input)\n        loss = F.binary_cross_entropy_with_logits(outputs, target)\n        \n        # Backward pass and optimize\n        loss.backward()\n        optimizer.step()\n\n        # Print loss every 100 epochs\n        if epoch % 100 == 0:\n            print(f\"Epoch {epoch}, Loss: {loss.item()}\")\n\n    return model","key":"b12hh6BtGL"},{"type":"outputs","id":"Rl3t4fnWOp0LWBOCx0HDq","children":[],"key":"aFDyDEngCi"}],"key":"vxXkLMMpyO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"input = torch.rand(10, 512)  # 10 samples with 512 features each\ntarget = torch.rand(10, 3)  # 10 samples with 3 target values each\n\nn_epochs = 1000\nlearning_rate = 0.001\nmodel = NeuralNetwork()\n\ntrained_model = training_loop(n_epochs, learning_rate, model, input, target)","key":"YFNrq8DQSN"},{"type":"outputs","id":"nn31gB4PLj4xuDWjkh2QP","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Epoch 100, Loss: 0.6899903416633606\nEpoch 200, Loss: 0.6868999600410461\nEpoch 300, Loss: 0.6844761967658997\nEpoch 400, Loss: 0.6822413802146912\nEpoch 500, Loss: 0.6804969310760498\nEpoch 600, Loss: 0.6790134310722351\nEpoch 700, Loss: 0.677758514881134\nEpoch 800, Loss: 0.676545262336731\nEpoch 900, Loss: 0.675352931022644\nEpoch 1000, Loss: 0.6741839051246643\n"},"children":[],"key":"p5C10THquA"}],"key":"gemF2qTOb8"}],"key":"DtZAcTrjNO"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Pytorchによる深層学習の実装例","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"U8JtAMvWJq"}],"identifier":"pytorch","label":"Pytorchによる深層学習の実装例","html_id":"pytorch","implicit":true,"enumerator":"5","key":"PWpShPNNje"},{"type":"heading","depth":3,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"データの読み込み","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"urAcQjLnUT"}],"identifier":"id","label":"データの読み込み","html_id":"id-14","implicit":true,"enumerator":"5.1","key":"E9lcv1MzWX"}],"key":"OihcfKWKmb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\ntrain_df = pd.read_csv('./Data/Titanic/train.csv')\ntrain_df.head()","key":"mqdPLY7bbY"},{"type":"outputs","id":"QnZkZwQldRaivUYJw_myW","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":85,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>PassengerId</th>\n      <th>Survived</th>\n      <th>Pclass</th>\n      <th>Name</th>\n      <th>Sex</th>\n      <th>Age</th>\n      <th>SibSp</th>\n      <th>Parch</th>\n      <th>Ticket</th>\n      <th>Fare</th>\n      <th>Cabin</th>\n      <th>Embarked</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1</td>\n      <td>0</td>\n      <td>3</td>\n      <td>Braund, Mr. Owen Harris</td>\n      <td>male</td>\n      <td>22.0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>A/5 21171</td>\n      <td>7.2500</td>\n      <td>NaN</td>\n      <td>S</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2</td>\n      <td>1</td>\n      <td>1</td>\n      <td>Cumings, Mrs. John Bradley (Florence Briggs Th...</td>\n      <td>female</td>\n      <td>38.0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>PC 17599</td>\n      <td>71.2833</td>\n      <td>C85</td>\n      <td>C</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>3</td>\n      <td>1</td>\n      <td>3</td>\n      <td>Heikkinen, Miss. Laina</td>\n      <td>female</td>\n      <td>26.0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>STON/O2. 3101282</td>\n      <td>7.9250</td>\n      <td>NaN</td>\n      <td>S</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>4</td>\n      <td>1</td>\n      <td>1</td>\n      <td>Futrelle, Mrs. Jacques Heath (Lily May Peel)</td>\n      <td>female</td>\n      <td>35.0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>113803</td>\n      <td>53.1000</td>\n      <td>C123</td>\n      <td>S</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>5</td>\n      <td>0</td>\n      <td>3</td>\n      <td>Allen, Mr. William Henry</td>\n      <td>male</td>\n      <td>35.0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>373450</td>\n      <td>8.0500</td>\n      <td>NaN</td>\n      <td>S</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"   PassengerId  Survived  Pclass  \\\n0            1         0       3   \n1            2         1       1   \n2            3         1       3   \n3            4         1       1   \n4            5         0       3   \n\n                                                Name     Sex   Age  SibSp  \\\n0                            Braund, Mr. Owen Harris    male  22.0      1   \n1  Cumings, Mrs. John Bradley (Florence Briggs Th...  female  38.0      1   \n2                             Heikkinen, Miss. Laina  female  26.0      0   \n3       Futrelle, Mrs. Jacques Heath (Lily May Peel)  female  35.0      1   \n4                           Allen, Mr. William Henry    male  35.0      0   \n\n   Parch            Ticket     Fare Cabin Embarked  \n0      0         A/5 21171   7.2500   NaN        S  \n1      0          PC 17599  71.2833   C85        C  \n2      0  STON/O2. 3101282   7.9250   NaN        S  \n3      0            113803  53.1000  C123        S  \n4      0            373450   8.0500   NaN        S  ","content_type":"text/plain"}}},"children":[],"key":"RNS9KsasOP"}],"key":"lkhKwbN1X3"}],"key":"UlRMC1e1bH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"test_df = pd.read_csv('./Data/Titanic/test.csv')\ntest_df.head()","key":"yy1zBkwwb0"},{"type":"outputs","id":"ftOQsj09KUzrGdwQEvIqr","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":86,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>PassengerId</th>\n      <th>Pclass</th>\n      <th>Name</th>\n      <th>Sex</th>\n      <th>Age</th>\n      <th>SibSp</th>\n      <th>Parch</th>\n      <th>Ticket</th>\n      <th>Fare</th>\n      <th>Cabin</th>\n      <th>Embarked</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>892</td>\n      <td>3</td>\n      <td>Kelly, Mr. James</td>\n      <td>male</td>\n      <td>34.5</td>\n      <td>0</td>\n      <td>0</td>\n      <td>330911</td>\n      <td>7.8292</td>\n      <td>NaN</td>\n      <td>Q</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>893</td>\n      <td>3</td>\n      <td>Wilkes, Mrs. James (Ellen Needs)</td>\n      <td>female</td>\n      <td>47.0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>363272</td>\n      <td>7.0000</td>\n      <td>NaN</td>\n      <td>S</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>894</td>\n      <td>2</td>\n      <td>Myles, Mr. Thomas Francis</td>\n      <td>male</td>\n      <td>62.0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>240276</td>\n      <td>9.6875</td>\n      <td>NaN</td>\n      <td>Q</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>895</td>\n      <td>3</td>\n      <td>Wirz, Mr. Albert</td>\n      <td>male</td>\n      <td>27.0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>315154</td>\n      <td>8.6625</td>\n      <td>NaN</td>\n      <td>S</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>896</td>\n      <td>3</td>\n      <td>Hirvonen, Mrs. Alexander (Helga E Lindqvist)</td>\n      <td>female</td>\n      <td>22.0</td>\n      <td>1</td>\n      <td>1</td>\n      <td>3101298</td>\n      <td>12.2875</td>\n      <td>NaN</td>\n      <td>S</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"   PassengerId  Pclass                                          Name     Sex  \\\n0          892       3                              Kelly, Mr. James    male   \n1          893       3              Wilkes, Mrs. James (Ellen Needs)  female   \n2          894       2                     Myles, Mr. Thomas Francis    male   \n3          895       3                              Wirz, Mr. Albert    male   \n4          896       3  Hirvonen, Mrs. Alexander (Helga E Lindqvist)  female   \n\n    Age  SibSp  Parch   Ticket     Fare Cabin Embarked  \n0  34.5      0      0   330911   7.8292   NaN        Q  \n1  47.0      1      0   363272   7.0000   NaN        S  \n2  62.0      0      0   240276   9.6875   NaN        Q  \n3  27.0      0      0   315154   8.6625   NaN        S  \n4  22.0      1      1  3101298  12.2875   NaN        S  ","content_type":"text/plain"}}},"children":[],"key":"yoINo2HrbD"}],"key":"F4aH899w5e"}],"key":"uYHKEEf79F"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(train_df.dtypes)\n","key":"ALXi3u6zQ0"},{"type":"outputs","id":"SJfa9365MhS1s_FeStqpt","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"PassengerId      int64\nSurvived         int64\nPclass           int64\nName            object\nSex             object\nAge            float64\nSibSp            int64\nParch            int64\nTicket          object\nFare           float64\nCabin           object\nEmbarked        object\ndtype: object\n"},"children":[],"key":"wvEPJbEppF"}],"key":"yvhApq4gFc"}],"key":"cNX12JlBTD"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"データの前処理","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sTXKi8jVrI"}],"identifier":"id","label":"データの前処理","html_id":"id-15","implicit":true,"enumerator":"5.2","key":"x75fu0hv5U"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"列の削除: 要らない列を消していきます．乗客IDや名前，チケット，港(Embarked)や部屋番号(Cabin)はは生死にあまり関係がなさそうので、削除します。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lquEnsrqjx"}],"key":"QDGWiEqfzQ"}],"key":"iKCETntgRX"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"欠損の補完: 平均値で欠損しているデータを補完します。","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"EZb2Omoptd"}],"key":"HjA38Hx21G"}],"key":"GEwyTIyfvi"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"文字列を数字に置換","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"zmwrkQBeuY"}],"key":"H7rGeiNpFv"}],"key":"KObWFnAgmT"}],"key":"FnfcuMm8om"}],"key":"tQk4bbc6b5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def process_df(df):\n    df = df.drop([\"PassengerId\", \"Name\", \"Ticket\", \"Cabin\", \"Embarked\"], axis=1)\n    df[\"Age\"] = df[\"Age\"].fillna(df[\"Age\"].mean())\n    df = df.replace(\"male\", 0)\n    df = df.replace(\"female\", 1)\n    return df\n\ntrain_df = process_df(train_df)\ntest_df = process_df(test_df)\ntrain_df.head()","key":"stOjjbBvQk"},{"type":"outputs","id":"fdIOAfb0zWcCL60jRs4v3","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":88,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Survived</th>\n      <th>Pclass</th>\n      <th>Sex</th>\n      <th>Age</th>\n      <th>SibSp</th>\n      <th>Parch</th>\n      <th>Fare</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>0</td>\n      <td>3</td>\n      <td>0</td>\n      <td>22.0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>7.2500</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>1</td>\n      <td>1</td>\n      <td>1</td>\n      <td>38.0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>71.2833</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>1</td>\n      <td>3</td>\n      <td>1</td>\n      <td>26.0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>7.9250</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>1</td>\n      <td>1</td>\n      <td>1</td>\n      <td>35.0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>53.1000</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>0</td>\n      <td>3</td>\n      <td>0</td>\n      <td>35.0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>8.0500</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"   Survived  Pclass  Sex   Age  SibSp  Parch     Fare\n0         0       3    0  22.0      1      0   7.2500\n1         1       1    1  38.0      1      0  71.2833\n2         1       3    1  26.0      0      0   7.9250\n3         1       1    1  35.0      1      0  53.1000\n4         0       3    0  35.0      0      0   8.0500","content_type":"text/plain"}}},"children":[],"key":"vvLIHHPcsZ"}],"key":"pqhKzv1ExS"}],"key":"dhSFb5j2iO"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"データセットの作成","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cQVcr1zX7b"}],"identifier":"id","label":"データセットの作成","html_id":"id-16","implicit":true,"enumerator":"5.3","key":"Fq5mdpiJL3"}],"key":"ABkuHXpENM"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"データセットとデータローダーでミニバッチ学習ためのデータセットを作成します。","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PI3qinIvw3"}],"key":"Fm5BXOzTtG"}],"key":"A6PnXCBC81"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"features = [\"Pclass\", \"Sex\", \"Age\", \"SibSp\", \"Parch\", \"Fare\"]\nX = train_df[features]\ny = train_df[\"Survived\"]","key":"k3r24DKCpO"},{"type":"outputs","id":"8kY9rossZd5NWjiEo_HPG","children":[],"key":"i4tP0scN1n"}],"key":"WpssCJprYT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.model_selection import train_test_split\n\nX_train, X_val, y_train, y_val = train_test_split(X, y, test_size=0.2, random_state=42)","key":"TWoYZ8hmZl"},{"type":"outputs","id":"6uRe76USIrCN3QCVzxmPX","children":[],"key":"YxIz5kzgdk"}],"key":"nOXNh0z76N"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"class TitanicDataset(Dataset):\n    def __init__(self, X, y):\n        # DataFrameをNumPy配列に変換\n        self.X = torch.tensor(X.values, dtype=torch.float32)  # XをNumPy配列に変換してからテンソル化\n        self.y = torch.tensor(y.values, dtype=torch.float32)  # yも同様にテンソル化\n\n    def __len__(self):\n        return len(self.y)\n\n    def __getitem__(self, idx):\n        return self.X[idx], self.y[idx]\n\n","key":"TeHaPmswn9"},{"type":"outputs","id":"VrbS5oHeSnW3kObL7Cv6L","children":[],"key":"z6NNhmSQXB"}],"key":"JI5xZV9LXP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# データローダーの作成\ntrain_dataset = TitanicDataset(X_train, y_train)\nval_dataset = TitanicDataset(X_val, y_val)\n\ntrain_loader = DataLoader(train_dataset, batch_size=32, shuffle=True)\nval_loader = DataLoader(val_dataset, batch_size=32, shuffle=False)","key":"OslM81BxpJ"},{"type":"outputs","id":"McRxmJ8szt6SxiptGJZ_5","children":[],"key":"XZIl1PupEf"}],"key":"Kq5hoNkS0x"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"train_dataset[0]","key":"EhoAqGxpgZ"},{"type":"outputs","id":"hvwAQFZTtyA3EXTtN947a","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":93,"metadata":{},"data":{"text/plain":{"content":"(tensor([ 1.0000,  0.0000, 45.5000,  0.0000,  0.0000, 28.5000]), tensor(0.))","content_type":"text/plain"}}},"children":[],"key":"gFv9JC1tf6"}],"key":"jXJhS3Dq3h"}],"key":"QBPRAu3hBW"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"モデルの定義","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vgv36EIDxB"}],"identifier":"id","label":"モデルの定義","html_id":"id-17","implicit":true,"enumerator":"5.4","key":"a6VcFef4tX"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"__init__","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"iw5c2JNUUs"},{"type":"text","value":"で行列の掛け算の定義をして，","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wRSy7VYiCy"},{"type":"inlineCode","value":"forward","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"djJv7ZCir8"},{"type":"text","value":"でそれをどの順番で行うかを指定する感じです．","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vx6wvqTX3O"}],"key":"gycmTM7RPo"}],"key":"ADd2cxPfZp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"class TitanicModel(nn.Module):\n    def __init__(self, input_size):\n        super(TitanicModel, self).__init__()\n        self.fc1 = nn.Linear(input_size, 64)\n        self.fc2 = nn.Linear(64, 32)\n        self.fc3 = nn.Linear(32, 1)\n\n    def forward(self, x):\n        x = torch.relu(self.fc1(x))\n        x = torch.relu(self.fc2(x))\n        x = torch.sigmoid(self.fc3(x))\n        return x","key":"YoTVAvqbrs"},{"type":"outputs","id":"GiZPrXowPyil9lBzK4hdd","children":[],"key":"IgDsor05zC"}],"key":"TcdgAizY9M"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"モデルの学習","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rvQ9ps4fCs"}],"identifier":"id","label":"モデルの学習","html_id":"id-18","implicit":true,"enumerator":"5.5","key":"cnpVTU5htV"}],"key":"MSuZXDRJoy"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"損失関数は2乗誤差、最適化関数はAdamを使用します．","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SBGw128YzR"}],"key":"JlNnnAQVJb"}],"key":"rKMuM32B0E"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import torch.optim as optim\n\n\ndef train_model(model, train_loader, val_loader, n_epochs, learning_rate):\n    criterion = nn.BCELoss()  # 分類の損失関数\n    optimizer = optim.Adam(model.parameters(), lr=learning_rate)\n\n    for epoch in range(n_epochs):\n        model.train()\n        train_loss = 0.0\n        for X_batch, y_batch in train_loader:\n            optimizer.zero_grad()\n            outputs = model(X_batch).squeeze()\n            loss = criterion(outputs, y_batch)\n            loss.backward()\n            optimizer.step()\n            train_loss += loss.item() * X_batch.size(0)\n\n        # 検証データでの評価\n        model.eval()\n        val_loss = 0.0\n        with torch.no_grad():\n            for X_batch, y_batch in val_loader:\n                outputs = model(X_batch).squeeze()\n                loss = criterion(outputs, y_batch)\n                val_loss += loss.item() * X_batch.size(0)\n        # 訓練と検証の損失をデータセットのサイズで割り、平均損失を計算します\n        train_loss /= len(train_loader.dataset) \n        val_loss /= len(val_loader.dataset)\n        if epoch % 10 == 0:\n            print(f\"Epoch {epoch+1}/{n_epochs}, Train Loss: {train_loss:.4f}, Val Loss: {val_loss:.4f}\")\n","key":"kLJDp80oXl"},{"type":"outputs","id":"sn50dC0cPKZLEOwvUaG-P","children":[],"key":"vW7gpn8V2O"}],"key":"rvBlbrICo7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"model = TitanicModel(input_size=X_train.shape[1])\ntrain_model(model, train_loader, val_loader, n_epochs=100, learning_rate=0.001)","key":"bVhGpfm10j"},{"type":"outputs","id":"eKRHW-wr05QO-DaPr7iSs","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Epoch 1/100, Train Loss: 0.6523, Val Loss: 0.6527\nEpoch 11/100, Train Loss: 0.5803, Val Loss: 0.5545\nEpoch 21/100, Train Loss: 0.5136, Val Loss: 0.4905\nEpoch 31/100, Train Loss: 0.4820, Val Loss: 0.4443\nEpoch 41/100, Train Loss: 0.4370, Val Loss: 0.4449\nEpoch 51/100, Train Loss: 0.4333, Val Loss: 0.4332\nEpoch 61/100, Train Loss: 0.4191, Val Loss: 0.4213\nEpoch 71/100, Train Loss: 0.4163, Val Loss: 0.4295\nEpoch 81/100, Train Loss: 0.5030, Val Loss: 0.4887\nEpoch 91/100, Train Loss: 0.4212, Val Loss: 0.4244\n"},"children":[],"key":"SO5Y5woqs0"}],"key":"m6LKntPDUW"}],"key":"BxB1FZTbFE"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"モデルの評価","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xleiOtHa1k"}],"identifier":"id","label":"モデルの評価","html_id":"id-19","implicit":true,"enumerator":"5.6","key":"M90vX17yG0"}],"key":"tCvWajLQL9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.metrics import classification_report\n\ndef evaluate_model(model, loader):\n    model.eval()\n    predictions = []\n    true_labels = []\n    \n    with torch.no_grad():\n        for X_batch, y_batch in loader:\n            outputs = model(X_batch).squeeze()\n            # 出力を0または1に丸める\n            predicted_classes = outputs.round().numpy()\n            predictions.extend(predicted_classes)\n            true_labels.extend(y_batch.numpy())\n\n    # レポートの表示\n    print(classification_report(true_labels, predictions, target_names=[\"Did not survive\", \"Survived\"],digits=4))\n","key":"T8Y62s91Nh"},{"type":"outputs","id":"9vnYb6EEMo1x2vNSYaO2D","children":[],"key":"OvntOnFz1r"}],"key":"XKyUZiCilP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# モデルの評価を実行\nevaluate_model(model, val_loader)","key":"L6vLv9bIH6"},{"type":"outputs","id":"-NurKHqJ0B1GCDIuELOhh","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"                 precision    recall  f1-score   support\n\nDid not survive     0.8125    0.8667    0.8387       105\n       Survived     0.7910    0.7162    0.7518        74\n\n       accuracy                         0.8045       179\n      macro avg     0.8018    0.7914    0.7952       179\n   weighted avg     0.8036    0.8045    0.8028       179\n\n"},"children":[],"key":"Jml3L4o0ea"}],"key":"GrZwbl24xK"}],"key":"Pn4Fnu0Rx4"},{"type":"block","kind":"notebook-content","children":[{"type":"tabSet","children":[{"type":"tabItem","title":"実習問題","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"深層学習の実装を以下の指示に従って、改めて学習を行なってください。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vR7VW9LHVT"}],"key":"R5QXvdnNYB"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"バッチサイズを64に変更しなさい","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"lDvmBro5b0"}],"key":"knosehgg4H"}],"key":"AMsnL2s2CG"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"モデルに一つ隠れ層を追加しなさい","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Swg8OabQWu"}],"key":"vqAXoy3HaI"}],"key":"wyuilW3hoE"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"ドロップアウト層を追加しなさい","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"K0sNu6DXqQ"}],"key":"QxumpkBxaT"}],"key":"alQy0CbQaO"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"オプティマイザはAdamWを設定しなさい","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"AKAaM60zvc"}],"key":"CEvlNThQU5"}],"key":"oaPp9TgrZy"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"epochを増やしなさい","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Q3nmaPSOJi"}],"key":"kztNUezbMf"}],"key":"pmvOiENrvz"}],"key":"H8UWam6rPf"}],"key":"YEDm0NwjU5"}],"key":"Rw7eW81TzD"}],"key":"u5rAP2qswp"}],"key":"cwTfQh750J"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"学習に関するテクニック","url":"/sgd","group":"ニューラルネットワーク"},"next":{"title":"単語分散表現","url":"/word2vec-1","group":"単語分散表現"}}},"domain":"http://localhost:3000"}