<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>LSTMによる文書分類 - 計算社会科学と自然言語処理</title><meta property="og:title" content="LSTMによる文書分類 - 計算社会科学と自然言語処理"/><meta name="generator" content="mystmd"/><meta name="keywords" content=""/><link rel="stylesheet" href="/build/_assets/app-AIT5GAEP.css"/><link rel="stylesheet" href="/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-85RFPTYEE3"></script><script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-85RFPTYEE3');</script><link rel="icon" href="/favicon.ico"/><link rel="stylesheet" href="/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="myst-skip-to-article fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article content</a></div><dialog id="myst-no-css" style="position:fixed;left:0px;top:0px;width:100vw;height:100vh;font-size:4rem;padding:1rem;color:black;background:white"><strong>Site not loading correctly?</strong><p>This may be due to an incorrect <code>BASE_URL</code> configuration. See<!-- --> <a href="https://mystmd.org/guide/deployment#deploy-base-url">the MyST Documentation</a> <!-- -->for reference.</p><script>
    (() => {
            // Test for has-styling variable set by the MyST stylesheet
            const node = document.currentScript.parentNode;
            const hasCSS = window.getComputedStyle(node).getPropertyValue("--has-styling");
            if (hasCSS === ""){
                    node.showModal();
            }

    })()
</script></dialog><div class="myst-top-nav bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="myst-top-nav-bar flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="myst-top-nav-menu-button flex items-center justify-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100 w-10 h-10"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="myst-home-link flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/"><div class="myst-home-link-logo mr-3 flex items-center dark:bg-white dark:rounded px-1"><img src="/build/tohoku-university-lo-68dede7d9dcb965aff25e8429e755296.svg" class="h-9" height="2.25rem"/></div><span class="text-md sm:text-xl tracking-tight sm:mr-5 sr-only">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R75cp:" data-state="closed" class="myst-search-bar flex items-center h-10 aspect-square sm:w-64 text-left text-gray-600 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 myst-search-bar-disabled hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="myst-search-text-placeholder hidden sm:block grow">Search</span><div aria-hidden="true" class="myst-search-shortcut items-center hidden mx-1 font-mono text-sm text-gray-600 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="myst-theme-button theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-10 h-10 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-moon-icon h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-sun-icon h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="myst-primary-sidebar fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="myst-primary-sidebar-pointer pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="myst-primary-sidebar-nav flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="myst-primary-sidebar-topnav overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white font-medium"></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="myst-primary-sidebar-toc flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="myst-toc w-full px-1 dark:text-white"><a title="計算社会科学と自然言語処理" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/">計算社会科学と自然言語処理</a><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="イントロダクション" class="block break-words rounded py-2 grow cursor-pointer">イントロダクション</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rmpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rmpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="基礎知識" class="block break-words rounded py-2 grow cursor-pointer">基礎知識</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rupsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rupsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="ニューラルネットワーク" class="block break-words rounded py-2 grow cursor-pointer">ニューラルネットワーク</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R16psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R16psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="PyTorch" class="block break-words rounded py-2 grow cursor-pointer">PyTorch</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1epsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1epsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="単語分散表現" class="block break-words rounded py-2 grow cursor-pointer">単語分散表現</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1mpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1mpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="open" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="RNN" class="block break-words rounded py-2 grow font-semibold text-blue-800 dark:text-blue-200 cursor-pointer">RNN</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1upsp:" aria-expanded="true" data-state="open"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="open" id="radix-:R1upsp:" class="pl-3 pr-[2px] collapsible-content"><a title="RNNの基礎" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/rnn">RNNの基礎</a><a title="LSTM" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/lstm">LSTM</a><a title="LSTMの実装" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/pytorch-lstm">LSTMの実装</a><a title="LSTMによる文書分類" aria-current="page" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg myst-toc-item-exact bg-blue-300/30 active" href="/lstm-classification">LSTMによる文書分類</a><a title="Seq2seq" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/seq2seq">Seq2seq</a></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Transformer" class="block break-words rounded py-2 grow cursor-pointer">Transformer</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R26psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R26psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="大規模言語モデル" class="block break-words rounded py-2 grow cursor-pointer">大規模言語モデル</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R2epsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R2epsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav></div><div class="myst-primary-sidebar-footer flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="myst-made-with-myst flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="myst-fm-block mb-8 pt-9"><div class="myst-fm-block-header flex items-center mb-5 h-6 text-sm font-light"><div class="flex-grow"></div><div class="myst-fm-block-badges"><a href="https://github.com/lvzeyu/css_nlp" title="GitHub Repository: lvzeyu/css_nlp" target="_blank" rel="noopener noreferrer" class="myst-fm-github-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="myst-fm-github-icon inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a></div><a href="https://github.com/lvzeyu/css_nlp/edit/master/notebook/lstm_classification.ipynb" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="myst-fm-edit-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-edit-icon inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="myst-fm-downloads-dropdown relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="myst-fm-downloads-button relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8ucp:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-downloads-icon"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="myst-fm-block-title mb-0">LSTMによる文書分類</h1></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><div id="c60o5xLBDU" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import pandas as pd
import numpy as np
import torch
import re
import nltk
from nltk.tokenize import word_tokenize
nltk.download(&#x27;punkt&#x27;)
from sklearn.model_selection import train_test_split
from torch.utils.data import DataLoader, TensorDataset
import torch.nn as nn
import torch.optim as optim
from collections import Counter
from torchtext.vocab import vocab
from sklearn.metrics import accuracy_score, f1_score
device = torch.device(&#x27;cuda&#x27; if torch.cuda.is_available() else &#x27;cpu&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="5x27BsInzy7O1i8YrLrfO" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>[nltk_data] Downloading package punkt to /home/lyuzeyu/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
</span></code></pre></div></div></div></div><div id="rUm6ud3Up8" class="myst-jp-nb-block relative group/block"><h2 id="id" class="relative group"><span class="mr-3 select-none">1</span><span class="heading-text">データ準備</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><h3 id="csv" class="relative group"><span class="mr-3 select-none">1.1</span><span class="heading-text">CSVファイルを読み込む</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#csv" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="ZPyE3PGyxP" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">df= pd.read_csv(&#x27;./Data/twitter_training.csv&#x27;,names=[&#x27;index&#x27;,&#x27;brand&#x27;,&#x27;sentiment&#x27;,&#x27;text&#x27;])
df.head()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="xJ9T91EmRtmynwlJrmEaz" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="hrlTw6IF39" class="myst-jp-nb-block relative group/block"><h3 id="id-1" class="relative group"><span class="mr-3 select-none">1.2</span><span class="heading-text">ラベルデータの処理</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="dWYhWDreTV" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">df[&quot;label&quot;]=df[&quot;sentiment&quot;].replace({&quot;Positive&quot;:2,&quot;Negative&quot;:0,&quot;Neutral&quot;:1,&quot;Irrelevant&quot;:np.nan})
df.dropna(inplace=True)
df.head()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="ItyMtzZoicxAReRholURr" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="rTz4CwAdcy" class="myst-jp-nb-block relative group/block"><h3 id="id-2" class="relative group"><span class="mr-3 select-none">1.3</span><span class="heading-text">テキストデータの前処理</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><ul><li><p>テキストを小文字に変換</p></li><li><p>句読点を削除</p></li><li><p>トークン化</p></li><li><p>単語ID化</p></li></ul></div><div id="u7I4WQSMQb" class="myst-jp-nb-block relative group/block"><h4 id="tokenization" class="relative group"><span class="mr-3 select-none">1.3.1</span><span class="heading-text">Tokenization</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#tokenization" title="Link to this Section" aria-label="Link to this Section">¶</a></h4></div><div id="YSAkC9qdDs" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def preprocess_text(text):
    text = text.lower()  # Lowercasing
    text = re.sub(r&#x27;\W+&#x27;, &#x27; &#x27;, text)  # Remove punctuation
    tokens = word_tokenize(text)  # Tokenization
    return tokens</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="lFQBmSEUYkJMvJIYIlH4y" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="FGcYNVj6E0" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">df[&quot;processed_text&quot;]=df[&quot;text&quot;].apply(preprocess_text)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="tntapNaPjbDtfTrfsUL80" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="c8qnk1mu4e" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">df.head()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="7PIKqeKpB9GtHkXejsPLy" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="oFE6qptNBQ" class="myst-jp-nb-block relative group/block"><h4 id="id-3" class="relative group"><span class="mr-3 select-none">1.3.2</span><span class="heading-text">単語辞書</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p><code>Vocab</code>は、各単語（トークン）に対して一意のインデックス（またはID）を割り当てます。このマッピングにより、テキストデータを数値データに変換することができます。</p></div><div id="XCi6HBtDeq" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">counter = Counter()
for line in df[&quot;processed_text&quot;]:
    counter.update(line)
Vocab = vocab(counter, min_freq=1)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="T3EcZwMIM-CU3FjnzGIbt" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="xM67DW7MsM" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># 単語からインデックスへのマッピング
word_to_index = Vocab.get_stoi()

# 最初の5つのアイテムを取得して表示
for i, (word, index) in enumerate(word_to_index.items()):
    if i &gt;= 5:  # 最初の5つのアイテムのみ表示
        break
    print(f&quot;&#x27;{word}&#x27;: {index}&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="WNWr9ni8nRjvL6dArACmu" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>&#x27;partition&#x27;: 26882
&#x27;gfn&#x27;: 26881
&#x27;unnoticed&#x27;: 26880
&#x27;intend&#x27;: 26878
&#x27;techsall&#x27;: 26874
</span></code></pre></div></div></div></div><div id="KKY3Gld15B" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">df[&#x27;numericalized_text&#x27;] = df[&quot;processed_text&quot;].apply(lambda x: [Vocab[token] for token in x])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="d0vTRKkhDVFH4tU7kcUUg" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="jikwb7ckml" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">df.head()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="SpQhYzLrxP2JvuXMIEoXs" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="OAgAJnza1V" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def pad_sequences(seq, max_len):
    padded = np.zeros((max_len,), dtype=np.int64)
    if len(seq) &gt; max_len: padded[:] = seq[:max_len]
    else: padded[:len(seq)] = seq
    return padded</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="vX7fcoedb4x3UywvlnYyM" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="gsjQJATWQc" class="myst-jp-nb-block relative group/block"><h4 id="padding" class="relative group"><span class="mr-3 select-none">1.3.3</span><span class="heading-text">Padding</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#padding" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>ニューラルネットワークは、入力データが固定長であることを前提としていますので、テキストシーケンスを特定の最大長にパディング（埋める）する必要があります。</p></div><div id="Op5aiSoflc" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">df[&quot;text_length&quot;]=df[&quot;numericalized_text&quot;].apply(lambda x: len(x)) </code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="Ug459ygKiiIJXOCi70j8j" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="PwcgsTuDCI" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">df[&quot;text_length&quot;].describe()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="cUUPocR_2YnD5Da5tnW7x" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-text" class="font-mono text-sm whitespace-pre-wrap myst-jp-safe-output-text"><code><span>count    61121.000000
mean        19.455212
std         14.430986
min          0.000000
25%          8.000000
50%         16.000000
75%         27.000000
max        198.000000
Name: text_length, dtype: float64</span></code></div></div></div><div id="SstEBmLJlC" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">max_len=30
df[&#x27;padded_text&#x27;] = df[&#x27;numericalized_text&#x27;].apply(lambda x: pad_sequences(x, max_len))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="wdARszLpZAJtr6EXwibLL" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="lmVKs0wlC2" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">df.head()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="A5GQDdcH82v9EvVM0DK8X" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="gGLgP2R7hx" class="myst-jp-nb-block relative group/block"><h2 id="id-batch-datasets" class="relative group"><span class="mr-3 select-none">2</span><span class="heading-text">学習用データセットの作成(Batch Datasets)</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-batch-datasets" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="OOT54eZA7s" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Split the original dataset into training plus validation and testing sets
train_val_df, test_df = train_test_split(df, test_size=0.2)

# Split the training plus validation set into separate training and validation sets
train_df, val_df = train_test_split(train_val_df, test_size=0.25)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="q9WjsfSd1QIbCrvpYSsw6" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="PdDDFHRPpJ" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Create TensorDatasets
train_data = TensorDataset(torch.LongTensor(train_df[&#x27;padded_text&#x27;].tolist()), torch.LongTensor(train_df[&#x27;label&#x27;].tolist()))
val_data = TensorDataset(torch.LongTensor(val_df[&#x27;padded_text&#x27;].tolist()), torch.LongTensor(val_df[&#x27;label&#x27;].tolist()))
test_data = TensorDataset(torch.LongTensor(test_df[&#x27;padded_text&#x27;].tolist()), torch.LongTensor(test_df[&#x27;label&#x27;].tolist()))

# Create DataLoaders
batch_size = 32
train_loader = DataLoader(train_data, shuffle=True, batch_size=batch_size)
val_loader = DataLoader(val_data, batch_size=batch_size)
test_loader = DataLoader(test_data, batch_size=batch_size)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="JtCWnVUkbJIQsin2VdoBO" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>/tmp/ipykernel_3912/2868894412.py:2: UserWarning: Creating a tensor from a list of numpy.ndarrays is extremely slow. Please consider converting the list to a single numpy.ndarray with numpy.array() before converting to a tensor. (Triggered internally at /opt/conda/conda-bld/pytorch_1699449201450/work/torch/csrc/utils/tensor_new.cpp:261.)
  train_data = TensorDataset(torch.LongTensor(train_df[&#x27;padded_text&#x27;].tolist()), torch.LongTensor(train_df[&#x27;label&#x27;].tolist()))
</span></code></pre></div></div></div></div><div id="DyO6fWOQdu" class="myst-jp-nb-block relative group/block"><h2 id="id-4" class="relative group"><span class="mr-3 select-none">3</span><span class="heading-text">モデルの作成</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-4" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><h3 id="id-5" class="relative group"><span class="mr-3 select-none">3.1</span><span class="heading-text">メソッドの説明</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-5" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><h4 id="nn-embedding" class="relative group"><span class="mr-3 select-none">3.1.1</span><span class="heading-text"><code>nn.Embedding</code></span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#nn-embedding" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><ul><li><p><code>nn.Embedding</code>は単語の埋め込みを行うために使用されます。単語の埋め込みとは、単語を固定長のベクトルに変換することを指します。このベクトルは、単語の意味的な特性を捉えることができます。<code>nn.Embedding</code>の主なパラメータは以下の通りです：</p><ul><li><p><code>num_embeddings</code>：埋め込みを行う単語の総数。通常は語彙のサイズに設定します。</p></li><li><p><code>embedding_dim</code>：各単語の埋め込みベクトルの次元数。</p></li></ul></li><li><p><code>nn.Embedding</code>は、整数のインデックスを入力として受け取り、それに対応する埋め込みベクトルを出力します。</p></li><li><p>下の例では、<code>input</code>の各インデックスが対応する埋め込みベクトルに置き換えられ、<code>embedded</code>はサイズ<code>(batch_size, sequence_length, embedding_dim)</code>のテンソルになります。</p></li></ul><h4 id="nn-dropout" class="relative group"><span class="mr-3 select-none">3.1.2</span><span class="heading-text"><code>nn.Dropout</code></span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#nn-dropout" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><ul><li><p>ドロップアウトは、ニューラルネットワークの訓練中にランダムにノードを「ドロップアウト」（つまり無効化）することで、過学習を防ぐための一般的なテクニックです<code>nn.Dropout</code>の主なパラメータは以下の通りです：</p><ul><li><p><code>p</code>：ノードをドロップアウトする確率。0.0（ノードをドロップアウトしない）から1.0（全てのノードをドロップアウトする）までの値を取ります。デフォルトは0.5です。</p></li></ul></li><li><p><code>nn.Dropout</code>は、訓練中にのみドロップアウトを適用し、評価（つまりモデルが<code>.eval()</code>モードにあるとき）中にはドロップアウトを適用しません。これは、訓練中にはモデルのロバスト性を向上させるためにランダム性が必要である一方、評価中にはモデルの全ての学習特性を使用して一貫した出力を得る必要があるためです。</p></li></ul></div><div id="XdXXPNgqC8" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">embedding = nn.Embedding(num_embeddings=10000, embedding_dim=300)
input = torch.LongTensor([[1, 2, 4, 5], [4, 3, 2, 9]])
embedded = embedding(input)
embedded.shape</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="jeW3_NtbZQnChDc54nAR6" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-text" class="font-mono text-sm whitespace-pre-wrap myst-jp-safe-output-text"><code><span>torch.Size([2, 4, 300])</span></code></div></div></div><div id="s5Z8LXD6bx" class="myst-jp-nb-block relative group/block"><h3 id="id-6" class="relative group"><span class="mr-3 select-none">3.2</span><span class="heading-text">モデルの定義</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-6" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p><code>hidden = self.dropout(torch.cat((hidden[-2,:,:], hidden[-1,:,:]), dim = 1))</code></p><p>ここでは、双方向LSTMの最後の隠れ状態を取り扱っています。</p><p>双方向LSTMは、順方向と逆方向の2つのLSTMを使用します。順方向のLSTMはシーケンスを通常の順序で処理し、逆方向のLSTMはシーケンスを逆順で処理します。その結果、各時間ステップで2つの隠れ状態（順方向と逆方向のそれぞれから1つずつ）が得られます。</p><ul><li><p><code>hidden[-2,:,:]</code>と<code>hidden[-1,:,:]</code>は、それぞれ最後の時間ステップでの順方向と逆方向の隠れ状態を取得しています。</p></li><li><p><code>torch.cat((hidden[-2,:,:], hidden[-1,:,:]), dim = 1)</code>は、これら2つの隠れ状態を結合しています。結合は<code>dim=1</code>（つまり、特徴量の次元）に沿って行われます。</p></li></ul><p>その結果、順方向と逆方向の隠れ状態が1つのベクトルに結合され、そのベクトルは次の全結合層に入力されます。</p><p><code>self.fc = nn.Linear(hidden_dim * 2 if bidirectional else hidden_dim, output_dim)</code></p><p><code>self.fc</code>は全結合層で、LSTMからの出力を最終的な出力次元に変換します。この出力は、分類タスクのクラス数に等しいなります。</p><p>全結合層の入力次元は、LSTMの隠れ状態の次元数に依存します。</p><ul><li><p>LSTMが双方向の場合（<code>bidirectional=True</code>）、順方向と逆方向の隠れ状態が結合されるため、隠れ状態の次元数は<code>hidden_dim * 2</code>になります。</p></li><li><p>LSTMが一方向の場合（<code>bidirectional=False</code>）、隠れ状態の次元数は<code>hidden_dim</code>になります。</p></li></ul><p>したがって、<code>nn.Linear(hidden_dim * 2 if bidirectional else hidden_dim, output_dim)</code>は、LSTMの方向性に応じて全結合層の入力次元を適切に設定します。</p><p>出力次元<code>output_dim</code>は、タスクのクラス数または回帰の出力次元に設定します。</p><p><code>batch_first=True</code></p><p><code>batch_first=True</code>を設定すると、</p><ul><li><p>入力テンソルの形状は<code>(batch_size, sequence_length, input_size)</code>と解釈されます。つまり、バッチの次元が最初に来ます。</p></li><li><p><code>output</code>テンソルの形状は<code>(batch_size, seq_len, num_directions * hidden_size)</code>になります。</p></li></ul><p><code>batch_first=True</code>を使用する主な理由は、多くの場合、バッチの次元を最初に持ってくると、テンソル操作が直感的になり、コードが読みやすくなります。</p></div><div id="UUcWVSzYW1" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">class LSTMClassifier(nn.Module):
    def __init__(self, vocab_size, embedding_dim, hidden_dim, output_dim, n_layers, bidirectional, dropout):
        super().__init__()
        self.embedding = nn.Embedding(vocab_size, embedding_dim)
        self.lstm = nn.LSTM(embedding_dim, 
                            hidden_dim, 
                            num_layers=n_layers, 
                            bidirectional=bidirectional, 
                            dropout=dropout, 
                            batch_first=True)
        self.fc = nn.Linear(hidden_dim * 2 if bidirectional else hidden_dim, output_dim)
        self.bidirectional = bidirectional
    
    def forward(self, text):
        embedded = self.embedding(text)
        output, (hidden, cell) = self.lstm(embedded)
        if self.bidirectional:
            hidden = torch.cat((hidden[-2,:,:], hidden[-1,:,:]), dim = 1)
        else:
            hidden = hidden[-1,:,:]
        return self.fc(hidden.squeeze(0))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="xVTCt0W8FzqfPwecyPAfI" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="K1dXyE0SCD" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">vocab_size = len(Vocab)
embedding_dim = 100  
hidden_dim = 256     
output_dim = 3 
n_layers = 2        
bidirectional = True 
dropout = 0.2        

model = LSTMClassifier(vocab_size, embedding_dim, hidden_dim, output_dim, n_layers, bidirectional, dropout)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="Ttj0CHhA9UIeEM1Hd7zHE" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="gdCWg6krD6" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">model = model.to(device)
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="OZIRP1CA4dxYA649rgVN5" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="V6Jbn9Nem7" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">criterion = nn.CrossEntropyLoss()
optimizer = optim.Adam(model.parameters())</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="-bufYzC5qvqYVWvQAK-24" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>/home/lyuzeyu/.local/lib/python3.11/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm
</span></code></pre></div></div></div></div><div id="HL7v6H1FCM" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def train_model(model, train_loader, val_loader, optimizer, criterion, n_epochs):
    model.train()
    for epoch in range(n_epochs):
        for texts, labels in train_loader:
            texts, labels = texts.to(device), labels.to(device)
            optimizer.zero_grad()
            predictions = model(texts)
            loss = criterion(predictions, labels)
            loss.backward()
            optimizer.step()

        # Validation
        model.eval()
        with torch.no_grad():
            val_labels = []
            val_preds = []
            for texts, labels in val_loader:
                texts, labels = texts.to(device), labels.to(device)
                predictions = model(texts)
                val_labels.extend(labels.tolist())
                val_preds.extend(torch.argmax(predictions, dim=1).tolist())

            accuracy = accuracy_score(val_labels, val_preds)
            f1 = f1_score(val_labels, val_preds, average=&#x27;weighted&#x27;)
            print(f&quot;Epoch {epoch+1}, Loss: {loss.item()}, Accuracy: {accuracy}, F1 Score: {f1}&quot;)
        model.train()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="qx_qviG3PUn1KTRPwUI_f" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Z5hdkAzaQ3" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from torch.utils.tensorboard import SummaryWriter

def train_model(model, train_loader, val_loader, optimizer, criterion, n_epochs, tensorboard=False, tensorboard_path=&#x27;./runs&#x27;):
    # Initialize TensorBoard writer if tensorboard logging is enabled
    writer = SummaryWriter(tensorboard_path) if tensorboard else None

    model.train()
    for epoch in range(n_epochs):
        for texts, labels in train_loader:
            texts, labels = texts.to(device), labels.to(device)
            optimizer.zero_grad()
            predictions = model(texts)
            loss = criterion(predictions, labels)
            loss.backward()
            optimizer.step()

        # Validation
        model.eval()
        with torch.no_grad():
            val_labels = []
            val_preds = []
            for texts, labels in val_loader:
                texts, labels = texts.to(device), labels.to(device)
                predictions = model(texts)
                val_labels.extend(labels.tolist())
                val_preds.extend(torch.argmax(predictions, dim=1).tolist())

            accuracy = accuracy_score(val_labels, val_preds)
            f1 = f1_score(val_labels, val_preds, average=&#x27;weighted&#x27;)

            # Log metrics to TensorBoard
            if tensorboard:
                writer.add_scalar(&#x27;Loss/train&#x27;, loss.item(), epoch)
                writer.add_scalar(&#x27;Accuracy/val&#x27;, accuracy, epoch)
                writer.add_scalar(&#x27;F1-Score/val&#x27;, f1, epoch)

            print(f&quot;Epoch {epoch+1}, Loss: {loss.item()}, Accuracy: {accuracy}, F1 Score: {f1}&quot;)

        model.train()

    # Close the TensorBoard writer
    if tensorboard:
        writer.close()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="LQU9QOFKwoWiS-DaqQl6I" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="kRO8YSTmem" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Train the model
n_epochs = 30
#train_model(model, train_loader, val_loader, optimizer, criterion, n_epochs, tensorboard=True, tensorboard_path=&#x27;./runs/lstm&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="NP5YcjmZyVByJ5tXmiN6s" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div class="myst-backmatter-parts"></div><div class="myst-footer-links flex pt-10 mb-10 space-x-4"><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-prev" href="/pytorch-lstm"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">RNN</div>LSTMの実装</div></div></a><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-next" href="/seq2seq"><div class="flex h-full align-middle"><div class="flex-grow"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">RNN</div>Seq2seq</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></article></main><script>((a,l)=>{if(!window.history.state||!window.history.state.key){let u=Math.random().toString(32).slice(2);window.history.replaceState({key:u},"")}try{let d=JSON.parse(sessionStorage.getItem(a)||"{}")[l||window.history.state.key];typeof d=="number"&&window.scrollTo(0,d)}catch(u){console.error(u),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/build/entry.client-PCJPW7TK.js"/><link rel="modulepreload" href="/build/_shared/chunk-AQ2CODAG.js"/><link rel="modulepreload" href="/build/_shared/chunk-JJXTQVMA.js"/><link rel="modulepreload" href="/build/_shared/chunk-OZE3FFNP.js"/><link rel="modulepreload" href="/build/_shared/chunk-OYMW4E3D.js"/><link rel="modulepreload" href="/build/_shared/chunk-C4DFGG5C.js"/><link rel="modulepreload" href="/build/_shared/chunk-J7TUH54J.js"/><link rel="modulepreload" href="/build/_shared/chunk-FZ2S7OYD.js"/><link rel="modulepreload" href="/build/_shared/chunk-JEM6JXYA.js"/><link rel="modulepreload" href="/build/_shared/chunk-34XIY2DH.js"/><link rel="modulepreload" href="/build/_shared/chunk-KQM5FBHR.js"/><link rel="modulepreload" href="/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/build/_shared/chunk-7HNKBP4B.js"/><link rel="modulepreload" href="/build/_shared/chunk-CUKUDK3R.js"/><link rel="modulepreload" href="/build/_shared/chunk-3EBOCCHJ.js"/><link rel="modulepreload" href="/build/_shared/chunk-O4VQNZ62.js"/><link rel="modulepreload" href="/build/_shared/chunk-4OEDG4JQ.js"/><link rel="modulepreload" href="/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/build/root-CXYA7X5D.js"/><link rel="modulepreload" href="/build/_shared/chunk-DATP5P2X.js"/><link rel="modulepreload" href="/build/routes/$-JRBPULBO.js"/><script>window.__remixContext = {"url":"/lstm-classification","state":{"loaderData":{"root":{"config":{"version":3,"myst":"1.7.0","options":{"favicon":"/build/tohoku-university-lo-68dede7d9dcb965aff25e8429e755296.svg","logo":"/build/tohoku-university-lo-68dede7d9dcb965aff25e8429e755296.svg","analytics_google":"G-85RFPTYEE3"},"nav":[],"actions":[],"projects":[{"numbering":{"heading_1":{"template":"enabled","enabled":true},"heading_2":{"template":"enabled","enabled":true},"heading_3":{"template":"enabled","enabled":true},"heading_4":{"template":"enabled","enabled":true},"heading_5":{"template":"enabled","enabled":true},"heading_6":{"template":"enabled","enabled":true}},"title":"計算社会科学と自然言語処理","github":"https://github.com/lvzeyu/css_nlp","id":"356ed62a-cf04-49ae-b7bc-d9f79f2ef8bb","exports":[],"bibliography":[],"index":"intro","pages":[{"title":"イントロダクション","level":1},{"slug":"introduction","title":"ガイダンス","description":"このページで、行動科学演習(LB63310)と計算人文社会学研究演習Ⅱ (LM23309)の授業資料を公開しています。","date":"","thumbnail":"/build/NLP_history-80702ee1d37040856a480174f5bcbbfc.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"基礎知識","level":1},{"slug":"nlp-basis2","title":"自然言語処理の基礎","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ml-basis2","title":"機械学習の基本概念","description":"","date":"","thumbnail":"/build/supervised-learning-b5be7f5e73313e60f2c06d545c226553.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"math-basis2","title":"数学基礎","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"ニューラルネットワーク","level":1},{"slug":"nn2","title":"ニューラルネットワーク","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"backpropagation","title":"誤差逆伝播法","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"sgd","title":"学習に関するテクニック","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"PyTorch","level":1},{"slug":"pytorch2","title":"Pytorch","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"単語分散表現","level":1},{"slug":"word2vec-1","title":"単語分散表現","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"word2vec-2-embedding","title":"word2vec","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"word2vec-gensim","title":"GensimによるWord2Vecの学習と使用","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"word2vec-application","title":"Word2Vecが人文・社会科学研究における応用","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"RNN","level":1},{"slug":"rnn","title":"RNNの基礎","description":"","date":"","thumbnail":"/build/rnn-4dbf33ec81abf2baa6d5bbe97bb61683.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"lstm","title":"LSTM","description":"","date":"","thumbnail":"/build/lstm1-4ea8525c2f72b4f2ff8298a9f7b9c0be.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"pytorch-lstm","title":"LSTMの実装","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"lstm-classification","title":"LSTMによる文書分類","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"seq2seq","title":"Seq2seq","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"Transformer","level":1},{"slug":"attention","title":"Attention","description":"","date":"","thumbnail":"/build/attention-eed7f8fafc28c8cb6bd5276bbd04714b.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"self-attention","title":"Self-Attention","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"transformer","title":"Transformerアーキテクチャ","description":"","date":"","thumbnail":"/build/transformer-493148401fbb971a745b29ab5b44e10f.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"bert","title":"BERT","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"bert-sentiment","title":"BERTによるセンチメント分析","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"bert-topic","title":"BERTopic","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"大規模言語モデル","level":1},{"slug":"gpt","title":"GPT","description":"","date":"","thumbnail":"/build/gpt_history-c08ab6ce749d3aed300b023e318cb96c.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"llm","title":"大規模言語モデルの基本","description":"","date":"","thumbnail":"/build/LLMs_parameter-ec157a4028abc601fb429210b7f4b07c.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"langchain-basic","title":"LLMSの応用(1)：Langchainの基礎","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static"},"routes/$":{"config":{"version":3,"myst":"1.7.0","options":{"favicon":"/build/tohoku-university-lo-68dede7d9dcb965aff25e8429e755296.svg","logo":"/build/tohoku-university-lo-68dede7d9dcb965aff25e8429e755296.svg","analytics_google":"G-85RFPTYEE3"},"nav":[],"actions":[],"projects":[{"numbering":{"heading_1":{"template":"enabled","enabled":true},"heading_2":{"template":"enabled","enabled":true},"heading_3":{"template":"enabled","enabled":true},"heading_4":{"template":"enabled","enabled":true},"heading_5":{"template":"enabled","enabled":true},"heading_6":{"template":"enabled","enabled":true}},"title":"計算社会科学と自然言語処理","github":"https://github.com/lvzeyu/css_nlp","id":"356ed62a-cf04-49ae-b7bc-d9f79f2ef8bb","exports":[],"bibliography":[],"index":"intro","pages":[{"title":"イントロダクション","level":1},{"slug":"introduction","title":"ガイダンス","description":"このページで、行動科学演習(LB63310)と計算人文社会学研究演習Ⅱ (LM23309)の授業資料を公開しています。","date":"","thumbnail":"/build/NLP_history-80702ee1d37040856a480174f5bcbbfc.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"基礎知識","level":1},{"slug":"nlp-basis2","title":"自然言語処理の基礎","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ml-basis2","title":"機械学習の基本概念","description":"","date":"","thumbnail":"/build/supervised-learning-b5be7f5e73313e60f2c06d545c226553.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"math-basis2","title":"数学基礎","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"ニューラルネットワーク","level":1},{"slug":"nn2","title":"ニューラルネットワーク","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"backpropagation","title":"誤差逆伝播法","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"sgd","title":"学習に関するテクニック","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"PyTorch","level":1},{"slug":"pytorch2","title":"Pytorch","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"単語分散表現","level":1},{"slug":"word2vec-1","title":"単語分散表現","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"word2vec-2-embedding","title":"word2vec","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"word2vec-gensim","title":"GensimによるWord2Vecの学習と使用","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"word2vec-application","title":"Word2Vecが人文・社会科学研究における応用","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"RNN","level":1},{"slug":"rnn","title":"RNNの基礎","description":"","date":"","thumbnail":"/build/rnn-4dbf33ec81abf2baa6d5bbe97bb61683.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"lstm","title":"LSTM","description":"","date":"","thumbnail":"/build/lstm1-4ea8525c2f72b4f2ff8298a9f7b9c0be.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"pytorch-lstm","title":"LSTMの実装","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"lstm-classification","title":"LSTMによる文書分類","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"seq2seq","title":"Seq2seq","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"Transformer","level":1},{"slug":"attention","title":"Attention","description":"","date":"","thumbnail":"/build/attention-eed7f8fafc28c8cb6bd5276bbd04714b.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"self-attention","title":"Self-Attention","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"transformer","title":"Transformerアーキテクチャ","description":"","date":"","thumbnail":"/build/transformer-493148401fbb971a745b29ab5b44e10f.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"bert","title":"BERT","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"bert-sentiment","title":"BERTによるセンチメント分析","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"bert-topic","title":"BERTopic","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"大規模言語モデル","level":1},{"slug":"gpt","title":"GPT","description":"","date":"","thumbnail":"/build/gpt_history-c08ab6ce749d3aed300b023e318cb96c.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"llm","title":"大規模言語モデルの基本","description":"","date":"","thumbnail":"/build/LLMs_parameter-ec157a4028abc601fb429210b7f4b07c.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"langchain-basic","title":"LLMSの応用(1)：Langchainの基礎","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"version":3,"kind":"Notebook","sha256":"5e3139c4d503090a6379749d1202f00b562cc83788801ea63d7c3ed626286c55","slug":"lstm-classification","location":"/notebook/lstm_classification.ipynb","dependencies":[],"frontmatter":{"title":"LSTMによる文書分類","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"jupyterbook","language":"python"},"github":"https://github.com/lvzeyu/css_nlp","numbering":{"heading_1":{"enabled":true,"template":"enabled"},"heading_2":{"enabled":true,"template":"enabled"},"heading_3":{"enabled":true,"template":"enabled"},"heading_4":{"enabled":true,"template":"enabled"},"heading_5":{"enabled":true,"template":"enabled"},"heading_6":{"enabled":true,"template":"enabled"},"title":{"offset":1}},"source_url":"https://github.com/lvzeyu/css_nlp/blob/master/notebook/lstm_classification.ipynb","edit_url":"https://github.com/lvzeyu/css_nlp/edit/master/notebook/lstm_classification.ipynb","exports":[{"format":"ipynb","filename":"lstm_classification.ipynb","url":"/build/lstm_classification-a2fbadc0cd0d0be6f34ba22490333c4d.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\nimport numpy as np\nimport torch\nimport re\nimport nltk\nfrom nltk.tokenize import word_tokenize\nnltk.download('punkt')\nfrom sklearn.model_selection import train_test_split\nfrom torch.utils.data import DataLoader, TensorDataset\nimport torch.nn as nn\nimport torch.optim as optim\nfrom collections import Counter\nfrom torchtext.vocab import vocab\nfrom sklearn.metrics import accuracy_score, f1_score\ndevice = torch.device('cuda' if torch.cuda.is_available() else 'cpu')","key":"nCwQzcDxob"},{"type":"outputs","id":"5x27BsInzy7O1i8YrLrfO","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"[nltk_data] Downloading package punkt to /home/lyuzeyu/nltk_data...\n[nltk_data]   Package punkt is already up-to-date!\n"},"children":[],"key":"fw7BCn0Q0R"}],"key":"SqktgWGEnB"}],"key":"c60o5xLBDU"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"データ準備","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vE11tgQNDk"}],"identifier":"id","label":"データ準備","html_id":"id","implicit":true,"enumerator":"1","key":"ZYVTfKF1pg"},{"type":"heading","depth":3,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"CSVファイルを読み込む","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bpuAxFS39U"}],"identifier":"csv","label":"CSVファイルを読み込む","html_id":"csv","implicit":true,"enumerator":"1.1","key":"XwZzBj5RBb"}],"key":"rUm6ud3Up8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df= pd.read_csv('./Data/twitter_training.csv',names=['index','brand','sentiment','text'])\ndf.head()","key":"LbtMV2qk0o"},{"type":"outputs","id":"xJ9T91EmRtmynwlJrmEaz","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":2,"metadata":{},"data":{"text/html":{"content":"\u003cdiv\u003e\n\u003cstyle scoped\u003e\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n\u003c/style\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003eindex\u003c/th\u003e\n      \u003cth\u003ebrand\u003c/th\u003e\n      \u003cth\u003esentiment\u003c/th\u003e\n      \u003cth\u003etext\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e0\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eim getting on borderlands and i will murder yo...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e1\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eI am coming to the borders and I will kill you...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eim getting on borderlands and i will kill you ...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e3\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eim coming on borderlands and i will murder you...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e4\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eim getting on borderlands 2 and i will murder ...\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/div\u003e","content_type":"text/html"},"text/plain":{"content":"   index        brand sentiment  \\\n0   2401  Borderlands  Positive   \n1   2401  Borderlands  Positive   \n2   2401  Borderlands  Positive   \n3   2401  Borderlands  Positive   \n4   2401  Borderlands  Positive   \n\n                                                text  \n0  im getting on borderlands and i will murder yo...  \n1  I am coming to the borders and I will kill you...  \n2  im getting on borderlands and i will kill you ...  \n3  im coming on borderlands and i will murder you...  \n4  im getting on borderlands 2 and i will murder ...  ","content_type":"text/plain"}}},"children":[],"key":"z6JF442e3c"}],"key":"rHtwqUMvBt"}],"key":"ZPyE3PGyxP"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"ラベルデータの処理","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tv4CVWrTjV"}],"identifier":"id","label":"ラベルデータの処理","html_id":"id-1","implicit":true,"enumerator":"1.2","key":"jhApdNaNmy"}],"key":"hrlTw6IF39"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df[\"label\"]=df[\"sentiment\"].replace({\"Positive\":2,\"Negative\":0,\"Neutral\":1,\"Irrelevant\":np.nan})\ndf.dropna(inplace=True)\ndf.head()","key":"kHdwl95CVh"},{"type":"outputs","id":"ItyMtzZoicxAReRholURr","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/html":{"content":"\u003cdiv\u003e\n\u003cstyle scoped\u003e\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n\u003c/style\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003eindex\u003c/th\u003e\n      \u003cth\u003ebrand\u003c/th\u003e\n      \u003cth\u003esentiment\u003c/th\u003e\n      \u003cth\u003etext\u003c/th\u003e\n      \u003cth\u003elabel\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e0\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eim getting on borderlands and i will murder yo...\u003c/td\u003e\n      \u003ctd\u003e2.0\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e1\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eI am coming to the borders and I will kill you...\u003c/td\u003e\n      \u003ctd\u003e2.0\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eim getting on borderlands and i will kill you ...\u003c/td\u003e\n      \u003ctd\u003e2.0\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e3\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eim coming on borderlands and i will murder you...\u003c/td\u003e\n      \u003ctd\u003e2.0\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e4\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eim getting on borderlands 2 and i will murder ...\u003c/td\u003e\n      \u003ctd\u003e2.0\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/div\u003e","content_type":"text/html"},"text/plain":{"content":"   index        brand sentiment  \\\n0   2401  Borderlands  Positive   \n1   2401  Borderlands  Positive   \n2   2401  Borderlands  Positive   \n3   2401  Borderlands  Positive   \n4   2401  Borderlands  Positive   \n\n                                                text  label  \n0  im getting on borderlands and i will murder yo...    2.0  \n1  I am coming to the borders and I will kill you...    2.0  \n2  im getting on borderlands and i will kill you ...    2.0  \n3  im coming on borderlands and i will murder you...    2.0  \n4  im getting on borderlands 2 and i will murder ...    2.0  ","content_type":"text/plain"}}},"children":[],"key":"z7ZqUrZdgt"}],"key":"PI26HX7Bdc"}],"key":"dWYhWDreTV"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"テキストデータの前処理","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cOgrG6mbW3"}],"identifier":"id","label":"テキストデータの前処理","html_id":"id-2","implicit":true,"enumerator":"1.3","key":"yeOh1kcPOC"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"テキストを小文字に変換","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Zbk2ZqGPIn"}],"key":"xjyIpSuu84"}],"key":"zsYpIdSxXw"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"句読点を削除","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"RTMceSV6rj"}],"key":"x6TqoLV9b6"}],"key":"W8YWnl1uCp"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"トークン化","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"l32OyhqXnM"}],"key":"kCUbxlnrpZ"}],"key":"AIWli7EDmG"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"単語ID化","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"q1AKB13NCA"}],"key":"ldKYSm3MCc"}],"key":"tI4udBtBJf"}],"key":"u3Zoti1o6C"}],"key":"rTz4CwAdcy"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Tokenization","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"C87FN86rc1"}],"identifier":"tokenization","label":"Tokenization","html_id":"tokenization","implicit":true,"enumerator":"1.3.1","key":"AKopNWEfkq"}],"key":"u7I4WQSMQb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def preprocess_text(text):\n    text = text.lower()  # Lowercasing\n    text = re.sub(r'\\W+', ' ', text)  # Remove punctuation\n    tokens = word_tokenize(text)  # Tokenization\n    return tokens","key":"kzIaS1aIJF"},{"type":"outputs","id":"lFQBmSEUYkJMvJIYIlH4y","children":[],"key":"uS7WDyUqVg"}],"key":"YSAkC9qdDs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df[\"processed_text\"]=df[\"text\"].apply(preprocess_text)","key":"V6lxccHjkL"},{"type":"outputs","id":"tntapNaPjbDtfTrfsUL80","children":[],"key":"hyMoAtBUXr"}],"key":"FGcYNVj6E0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df.head()","key":"LxMhPtIXB5"},{"type":"outputs","id":"7PIKqeKpB9GtHkXejsPLy","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/html":{"content":"\u003cdiv\u003e\n\u003cstyle scoped\u003e\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n\u003c/style\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003eindex\u003c/th\u003e\n      \u003cth\u003ebrand\u003c/th\u003e\n      \u003cth\u003esentiment\u003c/th\u003e\n      \u003cth\u003etext\u003c/th\u003e\n      \u003cth\u003elabel\u003c/th\u003e\n      \u003cth\u003eprocessed_text\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e0\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eim getting on borderlands and i will murder yo...\u003c/td\u003e\n      \u003ctd\u003e2.0\u003c/td\u003e\n      \u003ctd\u003e[im, getting, on, borderlands, and, i, will, m...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e1\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eI am coming to the borders and I will kill you...\u003c/td\u003e\n      \u003ctd\u003e2.0\u003c/td\u003e\n      \u003ctd\u003e[i, am, coming, to, the, borders, and, i, will...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eim getting on borderlands and i will kill you ...\u003c/td\u003e\n      \u003ctd\u003e2.0\u003c/td\u003e\n      \u003ctd\u003e[im, getting, on, borderlands, and, i, will, k...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e3\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eim coming on borderlands and i will murder you...\u003c/td\u003e\n      \u003ctd\u003e2.0\u003c/td\u003e\n      \u003ctd\u003e[im, coming, on, borderlands, and, i, will, mu...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e4\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eim getting on borderlands 2 and i will murder ...\u003c/td\u003e\n      \u003ctd\u003e2.0\u003c/td\u003e\n      \u003ctd\u003e[im, getting, on, borderlands, 2, and, i, will...\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/div\u003e","content_type":"text/html"},"text/plain":{"content":"   index        brand sentiment  \\\n0   2401  Borderlands  Positive   \n1   2401  Borderlands  Positive   \n2   2401  Borderlands  Positive   \n3   2401  Borderlands  Positive   \n4   2401  Borderlands  Positive   \n\n                                                text  label  \\\n0  im getting on borderlands and i will murder yo...    2.0   \n1  I am coming to the borders and I will kill you...    2.0   \n2  im getting on borderlands and i will kill you ...    2.0   \n3  im coming on borderlands and i will murder you...    2.0   \n4  im getting on borderlands 2 and i will murder ...    2.0   \n\n                                      processed_text  \n0  [im, getting, on, borderlands, and, i, will, m...  \n1  [i, am, coming, to, the, borders, and, i, will...  \n2  [im, getting, on, borderlands, and, i, will, k...  \n3  [im, coming, on, borderlands, and, i, will, mu...  \n4  [im, getting, on, borderlands, 2, and, i, will...  ","content_type":"text/plain"}}},"children":[],"key":"AgkgZVEkMa"}],"key":"JiUzkdkxeQ"}],"key":"c8qnk1mu4e"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"単語辞書","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RiVWtEQ7Sn"}],"identifier":"id","label":"単語辞書","html_id":"id-3","implicit":true,"enumerator":"1.3.2","key":"hnWCriHCXQ"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"Vocab","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hO6Sd7adq5"},{"type":"text","value":"は、各単語（トークン）に対して一意のインデックス（またはID）を割り当てます。このマッピングにより、テキストデータを数値データに変換することができます。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RuXiwfBFZh"}],"key":"n25NL3ZMmn"}],"key":"oFE6qptNBQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"counter = Counter()\nfor line in df[\"processed_text\"]:\n    counter.update(line)\nVocab = vocab(counter, min_freq=1)","key":"lOel2KlqwA"},{"type":"outputs","id":"T3EcZwMIM-CU3FjnzGIbt","children":[],"key":"ZaTrKsvoBE"}],"key":"XCi6HBtDeq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# 単語からインデックスへのマッピング\nword_to_index = Vocab.get_stoi()\n\n# 最初の5つのアイテムを取得して表示\nfor i, (word, index) in enumerate(word_to_index.items()):\n    if i \u003e= 5:  # 最初の5つのアイテムのみ表示\n        break\n    print(f\"'{word}': {index}\")","key":"SfDixGsN7u"},{"type":"outputs","id":"WNWr9ni8nRjvL6dArACmu","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"'partition': 26882\n'gfn': 26881\n'unnoticed': 26880\n'intend': 26878\n'techsall': 26874\n"},"children":[],"key":"G1mxNdyu4l"}],"key":"fd0cxovJe4"}],"key":"xM67DW7MsM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df['numericalized_text'] = df[\"processed_text\"].apply(lambda x: [Vocab[token] for token in x])","key":"IjKopBFFZA"},{"type":"outputs","id":"d0vTRKkhDVFH4tU7kcUUg","children":[],"key":"mXJQcWeKAC"}],"key":"KKY3Gld15B"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df.head()","key":"BVE5OROPpg"},{"type":"outputs","id":"SpQhYzLrxP2JvuXMIEoXs","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":10,"metadata":{},"data":{"text/html":{"content":"\u003cdiv\u003e\n\u003cstyle scoped\u003e\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n\u003c/style\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003eindex\u003c/th\u003e\n      \u003cth\u003ebrand\u003c/th\u003e\n      \u003cth\u003esentiment\u003c/th\u003e\n      \u003cth\u003etext\u003c/th\u003e\n      \u003cth\u003elabel\u003c/th\u003e\n      \u003cth\u003eprocessed_text\u003c/th\u003e\n      \u003cth\u003enumericalized_text\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e0\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eim getting on borderlands and i will murder yo...\u003c/td\u003e\n      \u003ctd\u003e2.0\u003c/td\u003e\n      \u003ctd\u003e[im, getting, on, borderlands, and, i, will, m...\u003c/td\u003e\n      \u003ctd\u003e[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e1\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eI am coming to the borders and I will kill you...\u003c/td\u003e\n      \u003ctd\u003e2.0\u003c/td\u003e\n      \u003ctd\u003e[i, am, coming, to, the, borders, and, i, will...\u003c/td\u003e\n      \u003ctd\u003e[5, 10, 11, 12, 13, 14, 4, 5, 6, 15, 8, 9]\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eim getting on borderlands and i will kill you ...\u003c/td\u003e\n      \u003ctd\u003e2.0\u003c/td\u003e\n      \u003ctd\u003e[im, getting, on, borderlands, and, i, will, k...\u003c/td\u003e\n      \u003ctd\u003e[0, 1, 2, 3, 4, 5, 6, 15, 8, 9]\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e3\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eim coming on borderlands and i will murder you...\u003c/td\u003e\n      \u003ctd\u003e2.0\u003c/td\u003e\n      \u003ctd\u003e[im, coming, on, borderlands, and, i, will, mu...\u003c/td\u003e\n      \u003ctd\u003e[0, 11, 2, 3, 4, 5, 6, 7, 8, 9]\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e4\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eim getting on borderlands 2 and i will murder ...\u003c/td\u003e\n      \u003ctd\u003e2.0\u003c/td\u003e\n      \u003ctd\u003e[im, getting, on, borderlands, 2, and, i, will...\u003c/td\u003e\n      \u003ctd\u003e[0, 1, 2, 3, 16, 4, 5, 6, 7, 8, 17, 9]\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/div\u003e","content_type":"text/html"},"text/plain":{"content":"   index        brand sentiment  \\\n0   2401  Borderlands  Positive   \n1   2401  Borderlands  Positive   \n2   2401  Borderlands  Positive   \n3   2401  Borderlands  Positive   \n4   2401  Borderlands  Positive   \n\n                                                text  label  \\\n0  im getting on borderlands and i will murder yo...    2.0   \n1  I am coming to the borders and I will kill you...    2.0   \n2  im getting on borderlands and i will kill you ...    2.0   \n3  im coming on borderlands and i will murder you...    2.0   \n4  im getting on borderlands 2 and i will murder ...    2.0   \n\n                                      processed_text  \\\n0  [im, getting, on, borderlands, and, i, will, m...   \n1  [i, am, coming, to, the, borders, and, i, will...   \n2  [im, getting, on, borderlands, and, i, will, k...   \n3  [im, coming, on, borderlands, and, i, will, mu...   \n4  [im, getting, on, borderlands, 2, and, i, will...   \n\n                           numericalized_text  \n0              [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]  \n1  [5, 10, 11, 12, 13, 14, 4, 5, 6, 15, 8, 9]  \n2             [0, 1, 2, 3, 4, 5, 6, 15, 8, 9]  \n3             [0, 11, 2, 3, 4, 5, 6, 7, 8, 9]  \n4      [0, 1, 2, 3, 16, 4, 5, 6, 7, 8, 17, 9]  ","content_type":"text/plain"}}},"children":[],"key":"RGiHKSx79I"}],"key":"mF6FPQpsdF"}],"key":"jikwb7ckml"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def pad_sequences(seq, max_len):\n    padded = np.zeros((max_len,), dtype=np.int64)\n    if len(seq) \u003e max_len: padded[:] = seq[:max_len]\n    else: padded[:len(seq)] = seq\n    return padded","key":"Hz0I3GSUuB"},{"type":"outputs","id":"vX7fcoedb4x3UywvlnYyM","children":[],"key":"ptQFaMwSOj"}],"key":"OAgAJnza1V"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Padding","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"H2vFjrEKH8"}],"identifier":"padding","label":"Padding","html_id":"padding","implicit":true,"enumerator":"1.3.3","key":"thfqdVAVbp"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"ニューラルネットワークは、入力データが固定長であることを前提としていますので、テキストシーケンスを特定の最大長にパディング（埋める）する必要があります。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GK7P1lePJy"}],"key":"KMOf7yC2Qh"}],"key":"gsjQJATWQc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df[\"text_length\"]=df[\"numericalized_text\"].apply(lambda x: len(x)) ","key":"JCv8Ik322m"},{"type":"outputs","id":"Ug459ygKiiIJXOCi70j8j","children":[],"key":"p51W77PTNX"}],"key":"Op5aiSoflc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df[\"text_length\"].describe()","key":"zuiUvMLycw"},{"type":"outputs","id":"cUUPocR_2YnD5Da5tnW7x","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":13,"metadata":{},"data":{"text/plain":{"content":"count    61121.000000\nmean        19.455212\nstd         14.430986\nmin          0.000000\n25%          8.000000\n50%         16.000000\n75%         27.000000\nmax        198.000000\nName: text_length, dtype: float64","content_type":"text/plain"}}},"children":[],"key":"zntowVlcdq"}],"key":"id8G1VJ15O"}],"key":"PwcgsTuDCI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"max_len=30\ndf['padded_text'] = df['numericalized_text'].apply(lambda x: pad_sequences(x, max_len))","key":"TIGXc65QP8"},{"type":"outputs","id":"wdARszLpZAJtr6EXwibLL","children":[],"key":"MJFqrl8B5G"}],"key":"SstEBmLJlC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df.head()","key":"pGZGg5e8sN"},{"type":"outputs","id":"A5GQDdcH82v9EvVM0DK8X","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":15,"metadata":{},"data":{"text/html":{"content":"\u003cdiv\u003e\n\u003cstyle scoped\u003e\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n\u003c/style\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003eindex\u003c/th\u003e\n      \u003cth\u003ebrand\u003c/th\u003e\n      \u003cth\u003esentiment\u003c/th\u003e\n      \u003cth\u003etext\u003c/th\u003e\n      \u003cth\u003elabel\u003c/th\u003e\n      \u003cth\u003eprocessed_text\u003c/th\u003e\n      \u003cth\u003enumericalized_text\u003c/th\u003e\n      \u003cth\u003etext_length\u003c/th\u003e\n      \u003cth\u003epadded_text\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e0\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eim getting on borderlands and i will murder yo...\u003c/td\u003e\n      \u003ctd\u003e2.0\u003c/td\u003e\n      \u003ctd\u003e[im, getting, on, borderlands, and, i, will, m...\u003c/td\u003e\n      \u003ctd\u003e[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\u003c/td\u003e\n      \u003ctd\u003e10\u003c/td\u003e\n      \u003ctd\u003e[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 0, 0, 0, 0, ...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e1\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eI am coming to the borders and I will kill you...\u003c/td\u003e\n      \u003ctd\u003e2.0\u003c/td\u003e\n      \u003ctd\u003e[i, am, coming, to, the, borders, and, i, will...\u003c/td\u003e\n      \u003ctd\u003e[5, 10, 11, 12, 13, 14, 4, 5, 6, 15, 8, 9]\u003c/td\u003e\n      \u003ctd\u003e12\u003c/td\u003e\n      \u003ctd\u003e[5, 10, 11, 12, 13, 14, 4, 5, 6, 15, 8, 9, 0, ...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eim getting on borderlands and i will kill you ...\u003c/td\u003e\n      \u003ctd\u003e2.0\u003c/td\u003e\n      \u003ctd\u003e[im, getting, on, borderlands, and, i, will, k...\u003c/td\u003e\n      \u003ctd\u003e[0, 1, 2, 3, 4, 5, 6, 15, 8, 9]\u003c/td\u003e\n      \u003ctd\u003e10\u003c/td\u003e\n      \u003ctd\u003e[0, 1, 2, 3, 4, 5, 6, 15, 8, 9, 0, 0, 0, 0, 0,...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e3\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eim coming on borderlands and i will murder you...\u003c/td\u003e\n      \u003ctd\u003e2.0\u003c/td\u003e\n      \u003ctd\u003e[im, coming, on, borderlands, and, i, will, mu...\u003c/td\u003e\n      \u003ctd\u003e[0, 11, 2, 3, 4, 5, 6, 7, 8, 9]\u003c/td\u003e\n      \u003ctd\u003e10\u003c/td\u003e\n      \u003ctd\u003e[0, 11, 2, 3, 4, 5, 6, 7, 8, 9, 0, 0, 0, 0, 0,...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e4\u003c/th\u003e\n      \u003ctd\u003e2401\u003c/td\u003e\n      \u003ctd\u003eBorderlands\u003c/td\u003e\n      \u003ctd\u003ePositive\u003c/td\u003e\n      \u003ctd\u003eim getting on borderlands 2 and i will murder ...\u003c/td\u003e\n      \u003ctd\u003e2.0\u003c/td\u003e\n      \u003ctd\u003e[im, getting, on, borderlands, 2, and, i, will...\u003c/td\u003e\n      \u003ctd\u003e[0, 1, 2, 3, 16, 4, 5, 6, 7, 8, 17, 9]\u003c/td\u003e\n      \u003ctd\u003e12\u003c/td\u003e\n      \u003ctd\u003e[0, 1, 2, 3, 16, 4, 5, 6, 7, 8, 17, 9, 0, 0, 0...\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/div\u003e","content_type":"text/html"},"text/plain":{"content":"   index        brand sentiment  \\\n0   2401  Borderlands  Positive   \n1   2401  Borderlands  Positive   \n2   2401  Borderlands  Positive   \n3   2401  Borderlands  Positive   \n4   2401  Borderlands  Positive   \n\n                                                text  label  \\\n0  im getting on borderlands and i will murder yo...    2.0   \n1  I am coming to the borders and I will kill you...    2.0   \n2  im getting on borderlands and i will kill you ...    2.0   \n3  im coming on borderlands and i will murder you...    2.0   \n4  im getting on borderlands 2 and i will murder ...    2.0   \n\n                                      processed_text  \\\n0  [im, getting, on, borderlands, and, i, will, m...   \n1  [i, am, coming, to, the, borders, and, i, will...   \n2  [im, getting, on, borderlands, and, i, will, k...   \n3  [im, coming, on, borderlands, and, i, will, mu...   \n4  [im, getting, on, borderlands, 2, and, i, will...   \n\n                           numericalized_text  text_length  \\\n0              [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]           10   \n1  [5, 10, 11, 12, 13, 14, 4, 5, 6, 15, 8, 9]           12   \n2             [0, 1, 2, 3, 4, 5, 6, 15, 8, 9]           10   \n3             [0, 11, 2, 3, 4, 5, 6, 7, 8, 9]           10   \n4      [0, 1, 2, 3, 16, 4, 5, 6, 7, 8, 17, 9]           12   \n\n                                         padded_text  \n0  [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 0, 0, 0, 0, ...  \n1  [5, 10, 11, 12, 13, 14, 4, 5, 6, 15, 8, 9, 0, ...  \n2  [0, 1, 2, 3, 4, 5, 6, 15, 8, 9, 0, 0, 0, 0, 0,...  \n3  [0, 11, 2, 3, 4, 5, 6, 7, 8, 9, 0, 0, 0, 0, 0,...  \n4  [0, 1, 2, 3, 16, 4, 5, 6, 7, 8, 17, 9, 0, 0, 0...  ","content_type":"text/plain"}}},"children":[],"key":"ZO7EJ0fzNZ"}],"key":"SmpuumQr5a"}],"key":"lmVKs0wlC2"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"学習用データセットの作成(Batch Datasets)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xzVnR9gFe6"}],"identifier":"id-batch-datasets","label":"学習用データセットの作成(Batch Datasets)","html_id":"id-batch-datasets","implicit":true,"enumerator":"2","key":"aMvWxEuxQr"}],"key":"gGLgP2R7hx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Split the original dataset into training plus validation and testing sets\ntrain_val_df, test_df = train_test_split(df, test_size=0.2)\n\n# Split the training plus validation set into separate training and validation sets\ntrain_df, val_df = train_test_split(train_val_df, test_size=0.25)","key":"JyVZ1GGoOZ"},{"type":"outputs","id":"q9WjsfSd1QIbCrvpYSsw6","children":[],"key":"v91bzy1to3"}],"key":"OOT54eZA7s"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Create TensorDatasets\ntrain_data = TensorDataset(torch.LongTensor(train_df['padded_text'].tolist()), torch.LongTensor(train_df['label'].tolist()))\nval_data = TensorDataset(torch.LongTensor(val_df['padded_text'].tolist()), torch.LongTensor(val_df['label'].tolist()))\ntest_data = TensorDataset(torch.LongTensor(test_df['padded_text'].tolist()), torch.LongTensor(test_df['label'].tolist()))\n\n# Create DataLoaders\nbatch_size = 32\ntrain_loader = DataLoader(train_data, shuffle=True, batch_size=batch_size)\nval_loader = DataLoader(val_data, batch_size=batch_size)\ntest_loader = DataLoader(test_data, batch_size=batch_size)","key":"Vme714I5Ql"},{"type":"outputs","id":"JtCWnVUkbJIQsin2VdoBO","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/tmp/ipykernel_3912/2868894412.py:2: UserWarning: Creating a tensor from a list of numpy.ndarrays is extremely slow. Please consider converting the list to a single numpy.ndarray with numpy.array() before converting to a tensor. (Triggered internally at /opt/conda/conda-bld/pytorch_1699449201450/work/torch/csrc/utils/tensor_new.cpp:261.)\n  train_data = TensorDataset(torch.LongTensor(train_df['padded_text'].tolist()), torch.LongTensor(train_df['label'].tolist()))\n"},"children":[],"key":"PGBJgpcGE7"}],"key":"whgg23ZwAI"}],"key":"PdDDFHRPpJ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"モデルの作成","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VOrQ5A7cCm"}],"identifier":"id","label":"モデルの作成","html_id":"id-4","implicit":true,"enumerator":"3","key":"m3xu4HqSdw"},{"type":"heading","depth":3,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"メソッドの説明","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YP6mpCUsoW"}],"identifier":"id","label":"メソッドの説明","html_id":"id-5","implicit":true,"enumerator":"3.1","key":"soPZhBGPLL"},{"type":"heading","depth":4,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"inlineCode","value":"nn.Embedding","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"RgGryJZANK"}],"identifier":"nn-embedding","label":"nn.Embedding","html_id":"nn-embedding","implicit":true,"enumerator":"3.1.1","key":"yfOBvFm4dR"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"nn.Embedding","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"G60cYURo7j"},{"type":"text","value":"は単語の埋め込みを行うために使用されます。単語の埋め込みとは、単語を固定長のベクトルに変換することを指します。このベクトルは、単語の意味的な特性を捉えることができます。","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"loZrIs5JMj"},{"type":"inlineCode","value":"nn.Embedding","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"YrVK59Ay3b"},{"type":"text","value":"の主なパラメータは以下の通りです：","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"IaqjQdPpR7"}],"key":"X64KuvO73O"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"num_embeddings","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"zh8XTRoOej"},{"type":"text","value":"：埋め込みを行う単語の総数。通常は語彙のサイズに設定します。","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"xbi9G2XWlL"}],"key":"M0xydaHYF8"}],"key":"rpVysCaFbC"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"embedding_dim","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"PleStaBepO"},{"type":"text","value":"：各単語の埋め込みベクトルの次元数。","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"xuJs5Gz8L4"}],"key":"H0fvK4wv1G"}],"key":"tT4l1DMk39"}],"key":"k5H9mIf5hE"}],"key":"gZgNQYedtO"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"nn.Embedding","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"DxGEo2h7TQ"},{"type":"text","value":"は、整数のインデックスを入力として受け取り、それに対応する埋め込みベクトルを出力します。","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"RTXOXePxgF"}],"key":"fb3Ax7ghdb"}],"key":"yLQzdUrGpz"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"下の例では、","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"qBOYbHb2l6"},{"type":"inlineCode","value":"input","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"AAjdJkW61Y"},{"type":"text","value":"の各インデックスが対応する埋め込みベクトルに置き換えられ、","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"IjSu5KlL03"},{"type":"inlineCode","value":"embedded","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"dxbjYUFyOC"},{"type":"text","value":"はサイズ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"fmKbPT3YJ8"},{"type":"inlineCode","value":"(batch_size, sequence_length, embedding_dim)","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"GJhx1r7XG9"},{"type":"text","value":"のテンソルになります。","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"d91LcWudS1"}],"key":"sUhvNYKdsT"}],"key":"ZE6WyuuhzH"}],"key":"EmYkLoswCg"},{"type":"heading","depth":4,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"inlineCode","value":"nn.Dropout","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"QBWJfShXfs"}],"identifier":"nn-dropout","label":"nn.Dropout","html_id":"nn-dropout","implicit":true,"enumerator":"3.1.2","key":"bRlFdE9Erw"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":15,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"ドロップアウトは、ニューラルネットワークの訓練中にランダムにノードを「ドロップアウト」（つまり無効化）することで、過学習を防ぐための一般的なテクニックです","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"QVbrPY7DqX"},{"type":"inlineCode","value":"nn.Dropout","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"BC3sqRqr5O"},{"type":"text","value":"の主なパラメータは以下の通りです：","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"wugPuCda7X"}],"key":"bzHA6yCgWD"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"p","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"sQEAUW2Kfs"},{"type":"text","value":"：ノードをドロップアウトする確率。0.0（ノードをドロップアウトしない）から1.0（全てのノードをドロップアウトする）までの値を取ります。デフォルトは0.5です。","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"Ww2esJzNou"}],"key":"zJ9pwgXno3"}],"key":"GcReg90W25"}],"key":"xQrxf9j6Gs"}],"key":"lHejZAMD1n"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"nn.Dropout","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"jSKqoO2yOu"},{"type":"text","value":"は、訓練中にのみドロップアウトを適用し、評価（つまりモデルが","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"E59tK3IeEF"},{"type":"inlineCode","value":".eval()","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"bNKdVIzWHJ"},{"type":"text","value":"モードにあるとき）中にはドロップアウトを適用しません。これは、訓練中にはモデルのロバスト性を向上させるためにランダム性が必要である一方、評価中にはモデルの全ての学習特性を使用して一貫した出力を得る必要があるためです。","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"P9Tpc6T1YW"}],"key":"R1fg8vUDkk"}],"key":"J0o1A87KPN"}],"key":"KSXatBlqVU"}],"key":"DyO6fWOQdu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"embedding = nn.Embedding(num_embeddings=10000, embedding_dim=300)\ninput = torch.LongTensor([[1, 2, 4, 5], [4, 3, 2, 9]])\nembedded = embedding(input)\nembedded.shape","key":"AyuXtYxO7C"},{"type":"outputs","id":"jeW3_NtbZQnChDc54nAR6","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":18,"metadata":{},"data":{"text/plain":{"content":"torch.Size([2, 4, 300])","content_type":"text/plain"}}},"children":[],"key":"lbQjYpVJDU"}],"key":"aEww3EwKUQ"}],"key":"XdXXPNgqC8"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"モデルの定義","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"V4dKC3M1MT"}],"identifier":"id","label":"モデルの定義","html_id":"id-6","implicit":true,"enumerator":"3.2","key":"Qo0D5l028I"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"hidden = self.dropout(torch.cat((hidden[-2,:,:], hidden[-1,:,:]), dim = 1))","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bnl2UmIvCr"}],"key":"mCvDnKwSqN"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"ここでは、双方向LSTMの最後の隠れ状態を取り扱っています。","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"JYb7W81AUO"}],"key":"rS6HTtbt9k"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"双方向LSTMは、順方向と逆方向の2つのLSTMを使用します。順方向のLSTMはシーケンスを通常の順序で処理し、逆方向のLSTMはシーケンスを逆順で処理します。その結果、各時間ステップで2つの隠れ状態（順方向と逆方向のそれぞれから1つずつ）が得られます。","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ehY9NLuR2N"}],"key":"rzFtSDZt5V"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":9,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"inlineCode","value":"hidden[-2,:,:]","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"KH84PMem6r"},{"type":"text","value":"と","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"J3tpT4ak2E"},{"type":"inlineCode","value":"hidden[-1,:,:]","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"JpI52TiJ9t"},{"type":"text","value":"は、それぞれ最後の時間ステップでの順方向と逆方向の隠れ状態を取得しています。","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"weLtn5grLh"}],"key":"l6OJ10ElS7"}],"key":"ettzcZDvaQ"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"inlineCode","value":"torch.cat((hidden[-2,:,:], hidden[-1,:,:]), dim = 1)","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"QVkU0nFHjy"},{"type":"text","value":"は、これら2つの隠れ状態を結合しています。結合は","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"HlwpX1bQ0Z"},{"type":"inlineCode","value":"dim=1","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"q0rsGOIjk8"},{"type":"text","value":"（つまり、特徴量の次元）に沿って行われます。","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"LaXlpsZqKV"}],"key":"HKl2LPRkxU"}],"key":"WdDpL5uEWY"}],"key":"cCmI8QFgRm"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"その結果、順方向と逆方向の隠れ状態が1つのベクトルに結合され、そのベクトルは次の全結合層に入力されます。","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"SUMu1gz8R5"}],"key":"u6dLuadKuv"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"inlineCode","value":"self.fc = nn.Linear(hidden_dim * 2 if bidirectional else hidden_dim, output_dim)","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"Nhjtguyyz7"}],"key":"XdTLgNBkYV"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"inlineCode","value":"self.fc","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"bdJNWCgZRS"},{"type":"text","value":"は全結合層で、LSTMからの出力を最終的な出力次元に変換します。この出力は、分類タスクのクラス数に等しいなります。","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"joTXhq4wWf"}],"key":"QBtmHnVaol"},{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"全結合層の入力次元は、LSTMの隠れ状態の次元数に依存します。","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"DYYiDW39aQ"}],"key":"nIS4N1ULYw"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":21,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"LSTMが双方向の場合（","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"sxWxWf99T3"},{"type":"inlineCode","value":"bidirectional=True","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"GCt6x50HYM"},{"type":"text","value":"）、順方向と逆方向の隠れ状態が結合されるため、隠れ状態の次元数は","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"S0WlcG0w1h"},{"type":"inlineCode","value":"hidden_dim * 2","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"vkUm3UiA44"},{"type":"text","value":"になります。","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"JAnjDJhyvV"}],"key":"A8Q6drIgTx"}],"key":"j9YyrpxGIs"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"LSTMが一方向の場合（","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"YObBa50vOS"},{"type":"inlineCode","value":"bidirectional=False","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"uvloXQ0msd"},{"type":"text","value":"）、隠れ状態の次元数は","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"TwFuweHxRK"},{"type":"inlineCode","value":"hidden_dim","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"siRJxD4Muj"},{"type":"text","value":"になります。","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"h4afDC74Ze"}],"key":"joAm7CR35c"}],"key":"budfaWeaom"}],"key":"hNGoLu4e1N"},{"type":"paragraph","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"したがって、","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"XyMkRuQt6p"},{"type":"inlineCode","value":"nn.Linear(hidden_dim * 2 if bidirectional else hidden_dim, output_dim)","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"JlK4iuPM7w"},{"type":"text","value":"は、LSTMの方向性に応じて全結合層の入力次元を適切に設定します。","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"E6oAiMsyzb"}],"key":"D2BhzuBe51"},{"type":"paragraph","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"出力次元","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"yqQFtiFAUK"},{"type":"inlineCode","value":"output_dim","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"aUsilBBQza"},{"type":"text","value":"は、タスクのクラス数または回帰の出力次元に設定します。","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"pQnwCraG47"}],"key":"aoolBV353Y"},{"type":"paragraph","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"inlineCode","value":"batch_first=True","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"dRCaCEvhIZ"}],"key":"Zj4P0w2Z89"},{"type":"paragraph","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"inlineCode","value":"batch_first=True","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"h6M5QJH8bn"},{"type":"text","value":"を設定すると、","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"b8ZSNnyX4q"}],"key":"fb2bDjfNw9"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":32,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"入力テンソルの形状は","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"olagazPAAy"},{"type":"inlineCode","value":"(batch_size, sequence_length, input_size)","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"NsITs5mNrO"},{"type":"text","value":"と解釈されます。つまり、バッチの次元が最初に来ます。","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"qNv1NKYV4f"}],"key":"ViyOHmcLuI"}],"key":"V7L97cwd5x"},{"type":"listItem","spread":true,"position":{"start":{"line":33,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"output","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"HXMDQ1nqv6"},{"type":"text","value":"テンソルの形状は","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"upcs6RB0P5"},{"type":"inlineCode","value":"(batch_size, seq_len, num_directions * hidden_size)","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"YDwwlLdhg1"},{"type":"text","value":"になります。","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"HlX0uhoWYI"}],"key":"z6aCXPqaeL"}],"key":"RFFvHZSiSD"}],"key":"fhVhE4me0Y"},{"type":"paragraph","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"inlineCode","value":"batch_first=True","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"afL5Z8SI6R"},{"type":"text","value":"を使用する主な理由は、多くの場合、バッチの次元を最初に持ってくると、テンソル操作が直感的になり、コードが読みやすくなります。","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"sh1ncqSB4i"}],"key":"GxgxGYAAiz"}],"key":"s5Z8LXD6bx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"class LSTMClassifier(nn.Module):\n    def __init__(self, vocab_size, embedding_dim, hidden_dim, output_dim, n_layers, bidirectional, dropout):\n        super().__init__()\n        self.embedding = nn.Embedding(vocab_size, embedding_dim)\n        self.lstm = nn.LSTM(embedding_dim, \n                            hidden_dim, \n                            num_layers=n_layers, \n                            bidirectional=bidirectional, \n                            dropout=dropout, \n                            batch_first=True)\n        self.fc = nn.Linear(hidden_dim * 2 if bidirectional else hidden_dim, output_dim)\n        self.bidirectional = bidirectional\n    \n    def forward(self, text):\n        embedded = self.embedding(text)\n        output, (hidden, cell) = self.lstm(embedded)\n        if self.bidirectional:\n            hidden = torch.cat((hidden[-2,:,:], hidden[-1,:,:]), dim = 1)\n        else:\n            hidden = hidden[-1,:,:]\n        return self.fc(hidden.squeeze(0))","key":"GhIeaTEraa"},{"type":"outputs","id":"xVTCt0W8FzqfPwecyPAfI","children":[],"key":"w4bIKpHgQD"}],"key":"UUcWVSzYW1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"vocab_size = len(Vocab)\nembedding_dim = 100  \nhidden_dim = 256     \noutput_dim = 3 \nn_layers = 2        \nbidirectional = True \ndropout = 0.2        \n\nmodel = LSTMClassifier(vocab_size, embedding_dim, hidden_dim, output_dim, n_layers, bidirectional, dropout)","key":"xCh18OFB7N"},{"type":"outputs","id":"Ttj0CHhA9UIeEM1Hd7zHE","children":[],"key":"IJVlNS6C8U"}],"key":"K1dXyE0SCD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"model = model.to(device)\n","key":"lkWWpB60ip"},{"type":"outputs","id":"OZIRP1CA4dxYA649rgVN5","children":[],"key":"Gu4nr4nDft"}],"key":"gdCWg6krD6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"criterion = nn.CrossEntropyLoss()\noptimizer = optim.Adam(model.parameters())","key":"kxy2Cj1VTS"},{"type":"outputs","id":"-bufYzC5qvqYVWvQAK-24","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/home/lyuzeyu/.local/lib/python3.11/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html\n  from .autonotebook import tqdm as notebook_tqdm\n"},"children":[],"key":"dWSjq7HrEo"}],"key":"pGqFY9KB2g"}],"key":"V6Jbn9Nem7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def train_model(model, train_loader, val_loader, optimizer, criterion, n_epochs):\n    model.train()\n    for epoch in range(n_epochs):\n        for texts, labels in train_loader:\n            texts, labels = texts.to(device), labels.to(device)\n            optimizer.zero_grad()\n            predictions = model(texts)\n            loss = criterion(predictions, labels)\n            loss.backward()\n            optimizer.step()\n\n        # Validation\n        model.eval()\n        with torch.no_grad():\n            val_labels = []\n            val_preds = []\n            for texts, labels in val_loader:\n                texts, labels = texts.to(device), labels.to(device)\n                predictions = model(texts)\n                val_labels.extend(labels.tolist())\n                val_preds.extend(torch.argmax(predictions, dim=1).tolist())\n\n            accuracy = accuracy_score(val_labels, val_preds)\n            f1 = f1_score(val_labels, val_preds, average='weighted')\n            print(f\"Epoch {epoch+1}, Loss: {loss.item()}, Accuracy: {accuracy}, F1 Score: {f1}\")\n        model.train()","key":"F2qX7ERG7j"},{"type":"outputs","id":"qx_qviG3PUn1KTRPwUI_f","children":[],"key":"R7qqaiJsCF"}],"key":"HL7v6H1FCM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from torch.utils.tensorboard import SummaryWriter\n\ndef train_model(model, train_loader, val_loader, optimizer, criterion, n_epochs, tensorboard=False, tensorboard_path='./runs'):\n    # Initialize TensorBoard writer if tensorboard logging is enabled\n    writer = SummaryWriter(tensorboard_path) if tensorboard else None\n\n    model.train()\n    for epoch in range(n_epochs):\n        for texts, labels in train_loader:\n            texts, labels = texts.to(device), labels.to(device)\n            optimizer.zero_grad()\n            predictions = model(texts)\n            loss = criterion(predictions, labels)\n            loss.backward()\n            optimizer.step()\n\n        # Validation\n        model.eval()\n        with torch.no_grad():\n            val_labels = []\n            val_preds = []\n            for texts, labels in val_loader:\n                texts, labels = texts.to(device), labels.to(device)\n                predictions = model(texts)\n                val_labels.extend(labels.tolist())\n                val_preds.extend(torch.argmax(predictions, dim=1).tolist())\n\n            accuracy = accuracy_score(val_labels, val_preds)\n            f1 = f1_score(val_labels, val_preds, average='weighted')\n\n            # Log metrics to TensorBoard\n            if tensorboard:\n                writer.add_scalar('Loss/train', loss.item(), epoch)\n                writer.add_scalar('Accuracy/val', accuracy, epoch)\n                writer.add_scalar('F1-Score/val', f1, epoch)\n\n            print(f\"Epoch {epoch+1}, Loss: {loss.item()}, Accuracy: {accuracy}, F1 Score: {f1}\")\n\n        model.train()\n\n    # Close the TensorBoard writer\n    if tensorboard:\n        writer.close()","key":"RPqFtTHRfE"},{"type":"outputs","id":"LQU9QOFKwoWiS-DaqQl6I","children":[],"key":"JiEqXzPzSe"}],"key":"Z5hdkAzaQ3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Train the model\nn_epochs = 30\n#train_model(model, train_loader, val_loader, optimizer, criterion, n_epochs, tensorboard=True, tensorboard_path='./runs/lstm')","key":"ZBkMz8hQMg"},{"type":"outputs","id":"NP5YcjmZyVByJ5tXmiN6s","children":[],"key":"UQXre7thXP"}],"key":"kRO8YSTmem"}],"key":"RtN5deeKVm"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"LSTMの実装","url":"/pytorch-lstm","group":"RNN"},"next":{"title":"Seq2seq","url":"/seq2seq","group":"RNN"}}},"domain":"http://localhost:3000"},"project":{"numbering":{"heading_1":{"template":"enabled","enabled":true},"heading_2":{"template":"enabled","enabled":true},"heading_3":{"template":"enabled","enabled":true},"heading_4":{"template":"enabled","enabled":true},"heading_5":{"template":"enabled","enabled":true},"heading_6":{"template":"enabled","enabled":true}},"title":"計算社会科学と自然言語処理","github":"https://github.com/lvzeyu/css_nlp","id":"356ed62a-cf04-49ae-b7bc-d9f79f2ef8bb","exports":[],"bibliography":[],"index":"intro","pages":[{"title":"イントロダクション","level":1},{"slug":"introduction","title":"ガイダンス","description":"このページで、行動科学演習(LB63310)と計算人文社会学研究演習Ⅱ (LM23309)の授業資料を公開しています。","date":"","thumbnail":"/build/NLP_history-80702ee1d37040856a480174f5bcbbfc.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"基礎知識","level":1},{"slug":"nlp-basis2","title":"自然言語処理の基礎","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ml-basis2","title":"機械学習の基本概念","description":"","date":"","thumbnail":"/build/supervised-learning-b5be7f5e73313e60f2c06d545c226553.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"math-basis2","title":"数学基礎","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"ニューラルネットワーク","level":1},{"slug":"nn2","title":"ニューラルネットワーク","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"backpropagation","title":"誤差逆伝播法","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"sgd","title":"学習に関するテクニック","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"PyTorch","level":1},{"slug":"pytorch2","title":"Pytorch","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"単語分散表現","level":1},{"slug":"word2vec-1","title":"単語分散表現","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"word2vec-2-embedding","title":"word2vec","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"word2vec-gensim","title":"GensimによるWord2Vecの学習と使用","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"word2vec-application","title":"Word2Vecが人文・社会科学研究における応用","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"RNN","level":1},{"slug":"rnn","title":"RNNの基礎","description":"","date":"","thumbnail":"/build/rnn-4dbf33ec81abf2baa6d5bbe97bb61683.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"lstm","title":"LSTM","description":"","date":"","thumbnail":"/build/lstm1-4ea8525c2f72b4f2ff8298a9f7b9c0be.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"pytorch-lstm","title":"LSTMの実装","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"lstm-classification","title":"LSTMによる文書分類","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"seq2seq","title":"Seq2seq","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"Transformer","level":1},{"slug":"attention","title":"Attention","description":"","date":"","thumbnail":"/build/attention-eed7f8fafc28c8cb6bd5276bbd04714b.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"self-attention","title":"Self-Attention","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"transformer","title":"Transformerアーキテクチャ","description":"","date":"","thumbnail":"/build/transformer-493148401fbb971a745b29ab5b44e10f.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"bert","title":"BERT","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"bert-sentiment","title":"BERTによるセンチメント分析","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"bert-topic","title":"BERTopic","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"大規模言語モデル","level":1},{"slug":"gpt","title":"GPT","description":"","date":"","thumbnail":"/build/gpt_history-c08ab6ce749d3aed300b023e318cb96c.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"llm","title":"大規模言語モデルの基本","description":"","date":"","thumbnail":"/build/LLMs_parameter-ec157a4028abc601fb429210b7f4b07c.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"langchain-basic","title":"LLMSの応用(1)：Langchainの基礎","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/build/manifest-86A905A4.js";
import * as route0 from "/build/root-CXYA7X5D.js";
import * as route1 from "/build/routes/$-JRBPULBO.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/build/entry.client-PCJPW7TK.js");</script></body></html>