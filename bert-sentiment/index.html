<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>BERTによるセンチメント分析 - 計算社会科学と自然言語処理</title><meta property="og:title" content="BERTによるセンチメント分析 - 計算社会科学と自然言語処理"/><meta name="generator" content="mystmd"/><meta name="keywords" content=""/><meta name="image" content="/build/7e2db436150c38a00650f96925aa5581.svg"/><meta property="og:image" content="/build/7e2db436150c38a00650f96925aa5581.svg"/><link rel="stylesheet" href="/build/_assets/app-AIT5GAEP.css"/><link rel="stylesheet" href="/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-85RFPTYEE3"></script><script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-85RFPTYEE3');</script><link rel="icon" href="/favicon.ico"/><link rel="stylesheet" href="/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="myst-skip-to-article fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article content</a></div><dialog id="myst-no-css" style="position:fixed;left:0px;top:0px;width:100vw;height:100vh;font-size:4rem;padding:1rem;color:black;background:white"><strong>Site not loading correctly?</strong><p>This may be due to an incorrect <code>BASE_URL</code> configuration. See<!-- --> <a href="https://mystmd.org/guide/deployment#deploy-base-url">the MyST Documentation</a> <!-- -->for reference.</p><script>
    (() => {
            // Test for has-styling variable set by the MyST stylesheet
            const node = document.currentScript.parentNode;
            const hasCSS = window.getComputedStyle(node).getPropertyValue("--has-styling");
            if (hasCSS === ""){
                    node.showModal();
            }

    })()
</script></dialog><div class="myst-top-nav bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="myst-top-nav-bar flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="myst-top-nav-menu-button flex items-center justify-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100 w-10 h-10"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="myst-home-link flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/"><div class="myst-home-link-logo mr-3 flex items-center dark:bg-white dark:rounded px-1"><img src="/build/tohoku-university-lo-68dede7d9dcb965aff25e8429e755296.svg" class="h-9" height="2.25rem"/></div><span class="text-md sm:text-xl tracking-tight sm:mr-5 sr-only">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R75cp:" data-state="closed" class="myst-search-bar flex items-center h-10 aspect-square sm:w-64 text-left text-gray-600 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 myst-search-bar-disabled hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="myst-search-text-placeholder hidden sm:block grow">Search</span><div aria-hidden="true" class="myst-search-shortcut items-center hidden mx-1 font-mono text-sm text-gray-600 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="myst-theme-button theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-10 h-10 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-moon-icon h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-sun-icon h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="myst-primary-sidebar fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="myst-primary-sidebar-pointer pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="myst-primary-sidebar-nav flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="myst-primary-sidebar-topnav overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white font-medium"></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="myst-primary-sidebar-toc flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="myst-toc w-full px-1 dark:text-white"><a title="計算社会科学と自然言語処理" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/">計算社会科学と自然言語処理</a><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="イントロダクション" class="block break-words rounded py-2 grow cursor-pointer">イントロダクション</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rmpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rmpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="基礎知識" class="block break-words rounded py-2 grow cursor-pointer">基礎知識</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rupsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rupsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="ニューラルネットワーク" class="block break-words rounded py-2 grow cursor-pointer">ニューラルネットワーク</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R16psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R16psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="PyTorch" class="block break-words rounded py-2 grow cursor-pointer">PyTorch</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1epsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1epsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="単語分散表現" class="block break-words rounded py-2 grow cursor-pointer">単語分散表現</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1mpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1mpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="RNN" class="block break-words rounded py-2 grow cursor-pointer">RNN</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1upsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1upsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="open" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Transformer" class="block break-words rounded py-2 grow font-semibold text-blue-800 dark:text-blue-200 cursor-pointer">Transformer</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R26psp:" aria-expanded="true" data-state="open"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="open" id="radix-:R26psp:" class="pl-3 pr-[2px] collapsible-content"><a title="Attention" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/attention">Attention</a><a title="Self-Attention" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/self-attention">Self-Attention</a><a title="Transformerアーキテクチャ" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/transformer">Transformerアーキテクチャ</a><a title="BERT" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/bert">BERT</a><a title="BERTによるセンチメント分析" aria-current="page" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg myst-toc-item-exact bg-blue-300/30 active" href="/bert-sentiment">BERTによるセンチメント分析</a><a title="BERTopic" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/bert-topic">BERTopic</a></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="大規模言語モデル" class="block break-words rounded py-2 grow cursor-pointer">大規模言語モデル</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R2epsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R2epsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav></div><div class="myst-primary-sidebar-footer flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="myst-made-with-myst flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="myst-fm-block mb-8 pt-9"><div class="myst-fm-block-header flex items-center mb-5 h-6 text-sm font-light"><div class="flex-grow"></div><div class="myst-fm-block-badges"><a href="https://github.com/lvzeyu/css_nlp" title="GitHub Repository: lvzeyu/css_nlp" target="_blank" rel="noopener noreferrer" class="myst-fm-github-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="myst-fm-github-icon inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a></div><a href="https://github.com/lvzeyu/css_nlp/edit/master/notebook/bert_sentiment.ipynb" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="myst-fm-edit-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-edit-icon inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="myst-fm-downloads-dropdown relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="myst-fm-downloads-button relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8ucp:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-downloads-icon"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="myst-fm-block-title mb-0">BERTによるセンチメント分析</h1></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><div id="CLcgctiNKZ" class="myst-jp-nb-block relative group/block"><p><a target="_blank" rel="noreferrer" href="https://colab.research.google.com/github/lvzeyu/css_nlp/blob/master/notebook/bert_sentiment.ipynb" class=""><img id="nsPBnC5uck" style="margin-left:auto;margin-right:auto" src="/build/7e2db436150c38a00650f96925aa5581.svg" alt="Open In Colab" data-canonical-url="https://colab.research.google.com/assets/colab-badge.svg" class=""/></a></p><h2 id="id" class="relative group"><span class="mr-3 select-none">1</span><span class="heading-text">転移学習とファインチューニング</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>転移学習は、あるタスクの学習で得られた知識を、他の関連するタスクの学習に適用する手法を指します。一般的には、以下のステップで行われることが多いです：</p><ul><li><p>事前学習: 事前学習モデル（pre-trained models)とは、大規模なデータセットを用いて訓練した学習済みモデルのことです。一般的に、大量のデータ（例えば、インターネット上のテキストデータ）を使用して、モデルを事前に学習します。この時点でのモデルは、言語の汎用的な特徴や構造を捉えることができます。</p></li><li><p>ファインチューニング(fine-tuning): 事前学習モデルを、特定のタスクのデータ（例えば、感情分析や質問応答）でファインチューニングします。事前学習モデルでは汎用的な特徴をあらかじめ学習しておきますので、手元にある学習データが小規模でも高精度な認識性能を達成することが知られています。</p></li></ul><img id="TRWUARmMXs" style="margin-left:auto;margin-right:auto" src="/build/fine-tuning_methods-0f88d44d58067b02fe4454d82fccc880.png" data-canonical-url="./Figure/fine-tuning_methods.png" class=""/></div><div id="UwyXCDrqdg" class="myst-jp-nb-block relative group/block"><h2 id="id-1" class="relative group"><span class="mr-3 select-none">2</span><span class="heading-text">センチメント分析の実装</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="VYVdiFofV6" class="myst-jp-nb-block relative group/block"><details class="myst-admonition myst-admonition-note my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500 dropdown tohokupurple"><summary class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900 cursor-pointer hover:shadow-[inset_0_0_0px_30px_#00000003] dark:hover:shadow-[inset_0_0_0px_30px_#FFFFFF03]"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Google ColabdでGPUを使用する</div><div class="self-center flex-none text-sm font-thin text-neutral-700 dark:text-neutral-200"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none transition-transform details-toggle"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></div></summary><div class="myst-admonition-body px-4 py-1 details-body"><p>「ランタイム」→「ランタイムのタイプを変更」→「ハードウェア アクセラレータ」→「GPU」</p></div></details></div><div id="tO2HfZVINj" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">!nvidia-smi</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="XDWdKzK99MYnyC1H5l1mi" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Sun Jan  4 16:58:32 2026       
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 580.95.05              Driver Version: 580.95.05      CUDA Version: 13.0     |
+-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  NVIDIA RTX A6000               Off |   00000000:01:00.0  On |                  Off |
| 30%   35C    P8             17W /  300W |    1379MiB /  49140MiB |      0%      Default |
|                                         |                        |                  N/A |
+-----------------------------------------+------------------------+----------------------+
|   1  NVIDIA RTX A6000               Off |   00000000:02:00.0 Off |                  Off |
| 30%   26C    P8             12W /  300W |      18MiB /  49140MiB |      0%      Default |
|                                         |                        |                  N/A |
+-----------------------------------------+------------------------+----------------------+

+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI              PID   Type   Process name                        GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
|    0   N/A  N/A            3971      G   /usr/bin/gnome-shell                    526MiB |
|    0   N/A  N/A            4428      G   /usr/bin/Xwayland                         4MiB |
|    0   N/A  N/A            5204      G   /usr/share/code/code                    543MiB |
|    1   N/A  N/A            3971      G   /usr/bin/gnome-shell                      4MiB |
+-----------------------------------------------------------------------------------------+
</span></code></pre></div></div></div></div><div id="Mp9o4oQp53" class="myst-jp-nb-block relative group/block"><h3 id="id-2" class="relative group"><span class="mr-3 select-none">2.1</span><span class="heading-text">データセット</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="GqtXxlGRFm" class="myst-jp-nb-block relative group/block"><h4 id="hugging-face" class="relative group"><span class="mr-3 select-none">2.1.1</span><span class="heading-text">Hugging Faceからサンプルデータの取得</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#hugging-face" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>Hugging Faceのには色々なデータセットが用意されております。ここでは、多言語のセンチメントデータセットを例として使用することにします。その中に、英語と日本語のサプセットが含まれます。</p></div><div id="XYPlECn190" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">!pip -q install &quot;datasets&lt;4.0.0&quot;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="WErtEvrJVkoUpimcl3bQL" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="LdskSVXUyW" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from datasets import load_dataset
#dataset = load_dataset(&quot;tyqiangz/multilingual-sentiments&quot;, &quot;japanese&quot;)
dataset = load_dataset(&quot;tyqiangz/multilingual-sentiments&quot;, &quot;english&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="8_y-IWQhlPi-iJu10jmVX" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="q4FqBZL7Mm" class="myst-jp-nb-block relative group/block"><h4 id="weights-biases-wandb" class="relative group"><span class="mr-3 select-none">2.1.2</span><span class="heading-text">Weights &amp; Biases (wandb)</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#weights-biases-wandb" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>Weights &amp; Biases (wandb)は、機械学習の実験を追跡・可視化・管理するためのプラットフォームです。</p><p>主な機能：</p><ul><li><p><strong>実験追跡</strong>: 学習の進捗、損失、精度などのメトリクスをリアルタイムで記録・可視化</p></li><li><p><strong>ハイパーパラメータ管理</strong>: 異なる設定での実験結果を比較</p></li><li><p><strong>モデル管理</strong>: 学習済みモデルのバージョン管理と共有</p></li></ul><p>ここでは、モデルの学習過程を追跡するためにwandbを使用します。<code>wandb.login()</code>でアカウントにログインし、実験結果をクラウドに保存します。</p></div><div id="iBUPhSCLtv" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">!pip install wandb
import wandb
wandb.login()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="oU_0UZCAxwITDBo_FlFK7" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Requirement already satisfied: wandb in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (0.23.1)
Requirement already satisfied: click&gt;=8.0.1 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from wandb) (8.1.7)
Requirement already satisfied: gitpython!=3.1.29,&gt;=1.0.0 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from wandb) (3.1.37)
Requirement already satisfied: packaging in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from wandb) (24.1)
Requirement already satisfied: platformdirs in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from wandb) (3.10.0)
Requirement already satisfied: protobuf!=4.21.0,!=5.28.0,&lt;7,&gt;=3.19.0 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from wandb) (3.20.3)
Requirement already satisfied: pydantic&lt;3 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from wandb) (2.10.6)
Requirement already satisfied: pyyaml in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from wandb) (6.0.1)
Requirement already satisfied: requests&lt;3,&gt;=2.0.0 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from wandb) (2.32.5)
Requirement already satisfied: sentry-sdk&gt;=2.0.0 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from wandb) (2.48.0)
Requirement already satisfied: typing-extensions&lt;5,&gt;=4.8 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from wandb) (4.12.2)
Requirement already satisfied: gitdb&lt;5,&gt;=4.0.1 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from gitpython!=3.1.29,&gt;=1.0.0-&gt;wandb) (4.0.7)
Requirement already satisfied: annotated-types&gt;=0.6.0 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from pydantic&lt;3-&gt;wandb) (0.7.0)
Requirement already satisfied: pydantic-core==2.27.2 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from pydantic&lt;3-&gt;wandb) (2.27.2)
Requirement already satisfied: charset_normalizer&lt;4,&gt;=2 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from requests&lt;3,&gt;=2.0.0-&gt;wandb) (2.0.4)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from requests&lt;3,&gt;=2.0.0-&gt;wandb) (3.4)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from requests&lt;3,&gt;=2.0.0-&gt;wandb) (2.0.7)
Requirement already satisfied: certifi&gt;=2017.4.17 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from requests&lt;3,&gt;=2.0.0-&gt;wandb) (2024.2.2)
Requirement already satisfied: smmap&lt;5,&gt;=3.0.1 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from gitdb&lt;5,&gt;=4.0.1-&gt;gitpython!=3.1.29,&gt;=1.0.0-&gt;wandb) (4.0.0)
</span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span style="color:rgb(0, 0, 187);font-weight:bold">wandb</span><span>: Currently logged in as: </span><span style="color:rgb(187, 187, 0)">lvzeyu1995</span><span> (</span><span style="color:rgb(187, 187, 0)">lvzeyu1995-tohoku-university</span><span>) to </span><span style="color:rgb(0, 187, 0)">https://api.wandb.ai</span><span>. Use </span><span style="font-weight:bold">`wandb login --relogin`</span><span> to force relogin
</span></code></pre></div></div><div data-name="safe-output-text" class="font-mono text-sm whitespace-pre-wrap myst-jp-safe-output-text"><code><span>True</span></code></div></div></div><div id="qxL8P5fCaI" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import os
os.environ[&quot;WANDB_PROJECT&quot;]=&quot;sentiment_analysis&quot;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="ZmquzQcyJxdjGx6dGZoUU" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="n4seCEnPB1" class="myst-jp-nb-block relative group/block"><h4 id="id-3" class="relative group"><span class="mr-3 select-none">2.1.3</span><span class="heading-text">サンプルデータの確認</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>取得したデータセットの中身を確認します。</p><p>データセットはこのようにtrain, validation, testに分かれています。
[‘text’, ‘source’, ‘label’]といった情報を持っています。</p></div><div id="NHZPngapcQ" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">dataset</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="cg21mCyFJgWm87qZo1VtY" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-text" class="font-mono text-sm whitespace-pre-wrap myst-jp-safe-output-text"><code><span>DatasetDict({
    train: Dataset({
        features: [&#x27;text&#x27;, &#x27;source&#x27;, &#x27;label&#x27;],
        num_rows: 1839
    })
    validation: Dataset({
        features: [&#x27;text&#x27;, &#x27;source&#x27;, &#x27;label&#x27;],
        num_rows: 324
    })
    test: Dataset({
        features: [&#x27;text&#x27;, &#x27;source&#x27;, &#x27;label&#x27;],
        num_rows: 870
    })
})</span></code></div></div></div><div id="lBVpgodJTH" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">dataset.set_format(type=&quot;pandas&quot;)
train_df = dataset[&quot;train&quot;][:]
train_df.head(5)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="3esCDNrtftvflub7okCpw" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="lOx2FCee1I" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">dataset[&quot;train&quot;].features</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="j7GrfvO9rGAq-hYolVkDy" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-text" class="font-mono text-sm whitespace-pre-wrap myst-jp-safe-output-text"><code><span>{&#x27;text&#x27;: Value(dtype=&#x27;string&#x27;, id=None),
 &#x27;source&#x27;: Value(dtype=&#x27;string&#x27;, id=None),
 &#x27;label&#x27;: ClassLabel(names=[&#x27;positive&#x27;, &#x27;neutral&#x27;, &#x27;negative&#x27;], id=None)}</span></code></div></div></div><div id="N96lyWHwTV" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import matplotlib.pyplot as plt
train_df[&quot;label&quot;].value_counts(ascending=True).plot(kind=&quot;barh&quot;, title=&quot;Train Dataset&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="gP4FLY9NvTGHnXQqANmD6" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-text" class="font-mono text-sm whitespace-pre-wrap myst-jp-safe-output-text"><code><span>&lt;Axes: title={&#x27;center&#x27;: &#x27;Train Dataset&#x27;}&gt;</span></code></div><div data-name="safe-output-image"><img src="/build/03bde67fdeaf84b43310b7c9ae7b8743.png" alt="&lt;Figure size 640x480 with 1 Axes&gt;"/></div></div></div><div id="cTMQqcXMod" class="myst-jp-nb-block relative group/block"><h4 id="id-4" class="relative group"><span class="mr-3 select-none">2.1.4</span><span class="heading-text">テキストの確認</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-4" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>Transformerモデルは、最大コンテキストサイズ(maximum context size)と呼ばれる最大入力系列長があります。</p><p>モデルのコンテキストサイズより長いテキストは切り捨てる必要があり、切り捨てたテキストに重要な情報が含まれている場合、性能の低下につながることがあります。</p></div><div id="MiW06yXDhz" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">train_df[&quot;text_length&quot;]=train_df[&quot;text&quot;].str.len()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="a8Bb1zAEzhx5vyyp6VLhU" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="rPN2hlFbBx" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">train_df.boxplot(column=&quot;text_length&quot;, by=&quot;label&quot;, figsize=(12, 6))
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="Q2UzKdh4TRM1jRVIjHwQb" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-text" class="font-mono text-sm whitespace-pre-wrap myst-jp-safe-output-text"><code><span>&lt;Axes: title={&#x27;center&#x27;: &#x27;text_length&#x27;}, xlabel=&#x27;label&#x27;&gt;</span></code></div><div data-name="safe-output-image"><img src="/build/c3e2ec270cbf9d31c31f43ac0a47678d.png" alt="&lt;Figure size 1200x600 with 1 Axes&gt;"/></div></div></div><div id="ptxht66xMD" class="myst-jp-nb-block relative group/block"><h3 id="id-5" class="relative group"><span class="mr-3 select-none">2.2</span><span class="heading-text">トークン化</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-5" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>コンピュータは、入力として生の文字列を受け取ることができません。その代わりに、テキストがトークン化され、数値ベクトルとしてエンコードされていることが想定しています。</p><p>トークン化は、文字列をモデルで使用される最小単位に分解するステップです。</p><p>Transformerライブラリー は便利なAutoTokenizerクラスを提供しており、事前学習済みモデルに関連つけられたトークナイザーを素早く使用することができます。</p></div><div id="lJxm98TL3U" class="myst-jp-nb-block relative group/block"><h4 id="id-6" class="relative group"><span class="mr-3 select-none">2.2.1</span><span class="heading-text">トークナイザの動作確認</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-6" title="Link to this Section" aria-label="Link to this Section">¶</a></h4></div><div id="DxGIjoQVJI" class="myst-jp-nb-block relative group/block"><p>tokenizerテキストを数値形式（トークン）に変換します。</p><ul><li><p>入力テキストをトークンに分割します</p></li><li><p>特殊トークンが自動的に付加されます</p></li><li><p>トークンをトークンIDに変換します</p></li></ul></div><div id="uGAY51wide" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from transformers import AutoTokenizer
model_ckpt = &quot;distilbert-base-uncased&quot;
tokenizer = AutoTokenizer.from_pretrained(model_ckpt)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="cXklzoYB19lq6g3hQf2gd" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="vnvCpaLHT6" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">train_df[&quot;text&quot;][0]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="0m9dhDJ9zF1EE3kEKzPbq" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-text" class="font-mono text-sm whitespace-pre-wrap myst-jp-safe-output-text"><code><span>&#x27;okay i\\u2019m sorry but TAYLOR SWIFT LOOKS NOTHING LIKE JACKIE O SO STOP COMPARING THE TWO. c\\u2019mon America aren\\u2019t you sick of her yet? (sorry) &#x27;</span></code></div></div></div><div id="MLR38TCTiB" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">sample_text_encoded = tokenizer(train_df[&quot;text&quot;][0])
sample_text_encoded</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="tblmSR7R2bc4zUHyonr9u" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-text" class="font-mono text-sm whitespace-pre-wrap myst-jp-safe-output-text"><code><span>{&#x27;input_ids&#x27;: [101, 3100, 1045, 1032, 23343, 24096, 2683, 2213, 3374, 2021, 4202, 9170, 3504, 2498, 2066, 9901, 1051, 2061, 2644, 13599, 1996, 2048, 1012, 1039, 1032, 23343, 24096, 2683, 8202, 2637, 4995, 1032, 23343, 24096, 2683, 2102, 2017, 5305, 1997, 2014, 2664, 1029, 1006, 3374, 1007, 102], &#x27;attention_mask&#x27;: [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]}</span></code></div></div></div><div id="EhYBV4dM92" class="myst-jp-nb-block relative group/block"><p>結果にinput_idsとattention_maskが含まれます。</p><ul><li><p>input_ids: 数字にエンコードされたトークン</p></li><li><p>attention_mask: モデルで有効なトークンかどうかを判別するためのマスクです。無効なトークン（例えば、PADなど）に対しては、attention_maskを
として処理します。</p></li></ul><p>各batchにおいて、入力系列はbatch内最大系列長までpaddingされます。</p><img id="EJDP8DWd4Y" style="margin-left:auto;margin-right:auto" src="/build/attention_id-3873cba03fa81523923bc1d9baa87924.png" data-canonical-url="./Figure/attention_id.png" class=""/></div><div id="nV8FcIe1mA" class="myst-jp-nb-block relative group/block"><p>トークナイザの結果は数字にエンコードされているため、トークン文字列を得るには、convert_ids_to_tokensを用います。</p><p>文の開始が[CLS]、文の終了が[SEP]という特殊なトークンとなっています。</p></div><div id="bNnkIP0vv8" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">tokens = tokenizer.convert_ids_to_tokens(sample_text_encoded.input_ids)
print(tokens)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="3igH9oLus_uKs2dqjgQPw" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>[&#x27;[CLS]&#x27;, &#x27;okay&#x27;, &#x27;i&#x27;, &#x27;\\&#x27;, &#x27;u2&#x27;, &#x27;##01&#x27;, &#x27;##9&#x27;, &#x27;##m&#x27;, &#x27;sorry&#x27;, &#x27;but&#x27;, &#x27;taylor&#x27;, &#x27;swift&#x27;, &#x27;looks&#x27;, &#x27;nothing&#x27;, &#x27;like&#x27;, &#x27;jackie&#x27;, &#x27;o&#x27;, &#x27;so&#x27;, &#x27;stop&#x27;, &#x27;comparing&#x27;, &#x27;the&#x27;, &#x27;two&#x27;, &#x27;.&#x27;, &#x27;c&#x27;, &#x27;\\&#x27;, &#x27;u2&#x27;, &#x27;##01&#x27;, &#x27;##9&#x27;, &#x27;##mon&#x27;, &#x27;america&#x27;, &#x27;aren&#x27;, &#x27;\\&#x27;, &#x27;u2&#x27;, &#x27;##01&#x27;, &#x27;##9&#x27;, &#x27;##t&#x27;, &#x27;you&#x27;, &#x27;sick&#x27;, &#x27;of&#x27;, &#x27;her&#x27;, &#x27;yet&#x27;, &#x27;?&#x27;, &#x27;(&#x27;, &#x27;sorry&#x27;, &#x27;)&#x27;, &#x27;[SEP]&#x27;]
</span></code></pre></div></div></div></div><div id="RPgslftMjr" class="myst-jp-nb-block relative group/block"><h4 id="id-7" class="relative group"><span class="mr-3 select-none">2.2.2</span><span class="heading-text">データセット全体のトークン化</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-7" title="Link to this Section" aria-label="Link to this Section">¶</a></h4></div><div id="xGGecMC9zw" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def tokenize(batch):
    return tokenizer(batch[&quot;text&quot;], padding=True, truncation=True)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="ck9ElyBJ4lPEvpVQdu7S3" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="b2rGdXLNVw" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">dataset.reset_format()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="0CTnWldI_8WYPjFjYFLUa" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="UXQYUb2kms" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">dataset_encoded = dataset.map(tokenize, batched=True, batch_size=None)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="c8KcagGjf5ySOLURWSBFY" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="AdQ2J2POyy" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import pandas as pd
sample_encoded = dataset_encoded[&quot;train&quot;][0]
pd.DataFrame(
    [sample_encoded[&quot;input_ids&quot;]
     , sample_encoded[&quot;attention_mask&quot;]
     , tokenizer.convert_ids_to_tokens(sample_encoded[&quot;input_ids&quot;])],
    [&#x27;input_ids&#x27;, &#x27;attention_mask&#x27;, &quot;tokens&quot;]
).T</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="5GQm_xjTwrCJUVUw1XCtt" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="kNjYTEMKOh" class="myst-jp-nb-block relative group/block"><h3 id="id-8" class="relative group"><span class="mr-3 select-none">2.3</span><span class="heading-text">分類器の実装</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-8" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><h4 id="id-9" class="relative group"><span class="mr-3 select-none">2.3.1</span><span class="heading-text">事前学習モデルの導入</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-9" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>Transformerライブラリは事前学習モデルの使用ため<code>AutoModel</code>クラスを提供します。</p><p><code>AutoModel</code>クラスはトークンエンコーディングを埋め込みに変換し、エンコーダスタックを経由して<strong>最後の</strong>隠れ状態を返します。</p></div><div id="cXknJY2Nwt" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import torch
from transformers import AutoModel

# GPUある場合はGPUを使う
device = torch.device(&quot;cuda&quot; if torch.cuda.is_available() else &quot;cpu&quot;)
model = AutoModel.from_pretrained(model_ckpt).to(device)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="sowPkmBPRhZXx4-gWzDyH" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="jhNWCHQd1J" class="myst-jp-nb-block relative group/block"><p>最初に、文字列をエンコーダしてトークンをPyTorchのテンソルに変換する必要があります。</p><p>結果として得られるテンソルは<code>[batch_size,n_tokens]</code>という形状です。</p></div><div id="HnwTFUVyg8" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">text = &quot;this is a test&quot;
inputs = tokenizer(text, return_tensors=&quot;pt&quot;)
print(f&quot;Input tensor shape: {inputs[&#x27;input_ids&#x27;].size()}&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="qlc9T_2Noy4ZrZ6yluAc2" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Input tensor shape: torch.Size([1, 6])
</span></code></pre></div></div></div></div><div id="NREczyuRC5" class="myst-jp-nb-block relative group/block"><p>得られるテンソルをモデルの入力として渡します。</p><ul><li><p>モデルと同じデバイス(GPU or CPU)に設置します。</p></li><li><p>計算のメモリを減らせるため、<code>torch.no_grad()</code>で、勾配の自動計算を無効します。</p></li><li><p>出力には隠れ状態、損失、アテンションのオブジェクトが含まれます。</p></li></ul></div><div id="skhRsKtaV7" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">inputs = {k:v.to(device) for k,v in inputs.items()}
with torch.no_grad():
    outputs = model(**inputs)
print(outputs)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="KsNXPmmsM5QvW40ttv5ku" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>BaseModelOutput(last_hidden_state=tensor([[[-0.1565, -0.1862,  0.0528,  ..., -0.1188,  0.0662,  0.5470],
         [-0.3575, -0.6484, -0.0618,  ..., -0.3040,  0.3508,  0.5221],
         [-0.2772, -0.4459,  0.1818,  ..., -0.0948, -0.0076,  0.9958],
         [-0.2841, -0.3917,  0.3753,  ..., -0.2151, -0.1173,  1.0526],
         [ 0.2661, -0.5094, -0.3180,  ..., -0.4203,  0.0144, -0.2149],
         [ 0.9441,  0.0112, -0.4714,  ...,  0.1439, -0.7288, -0.1619]]],
       device=&#x27;cuda:0&#x27;), hidden_states=None, attentions=None)
</span></code></pre></div></div></div></div><div id="UjAvRFWSUA" class="myst-jp-nb-block relative group/block"><p>隠れた状態テンソルを見ると、その形状は [batch_size, n_tokens, hidden_dim] であることがわかります。つまり、6つの入力トークンのそれぞれに対して、768次元のベクトルが返されます。</p></div><div id="CbnYtHMIBq" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">outputs.last_hidden_state.size()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="qitqXh6faUoVrX38nUJoD" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-text" class="font-mono text-sm whitespace-pre-wrap myst-jp-safe-output-text"><code><span>torch.Size([1, 6, 768])</span></code></div></div></div><div id="yUyPRv8aUf" class="myst-jp-nb-block relative group/block"><p>分類タスクでは、<code>[CLS]</code> トークンに関連する隠れた状態を入力特徴として使用するのが一般的な方法です。このトークンは各シーケンスの始まりに現れるため、次のように outputs.last_hidden_state に単純にインデックスを付けることで抽出できます。</p></div><div id="buLBPm1PZQ" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">outputs.last_hidden_state[:,0].size()
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="MArhTzoYfxJGfMQRYRMVh" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-text" class="font-mono text-sm whitespace-pre-wrap myst-jp-safe-output-text"><code><span>torch.Size([1, 768])</span></code></div></div></div><div id="OWrgkKwX4n" class="myst-jp-nb-block relative group/block"><p>最後の隠れ状態を取得する方法がわかりましたので、データ全体に対して処理を行うため、これまでのステップを関数でまとめます。</p><p>そして、データ全体に適用し、すべてのテキストの隠れ状態を抽出します。</p></div><div id="BCP8BVOzTq" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def extract_hidden_states(batch):
    # Place model inputs on the GPU
    inputs = {k:v.to(device) for k,v in batch.items() 
              if k in tokenizer.model_input_names}
    # Extract last hidden states
    with torch.no_grad():
        last_hidden_state = model(**inputs).last_hidden_state
    # Return vector for [CLS] token
    return {&quot;hidden_state&quot;: last_hidden_state[:,0].cpu().numpy()}</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="Ah5OrIecL80KChEX4FHUm" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="hR5YfHupO8" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">dataset_encoded.set_format(type=&quot;torch&quot;, columns=[&quot;input_ids&quot;, &quot;attention_mask&quot;,&quot;label&quot;])
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="CxK879LRPBks4teb6oVgs" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="U3e21azQjJ" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">dataset_hidden=dataset_encoded.map(extract_hidden_states, batched=True, batch_size=16)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="6zrPJplFggAI8j_khyZBQ" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="zyjmNpXXoZ" class="myst-jp-nb-block relative group/block"><h4 id="automodelforsequenceclassification" class="relative group"><span class="mr-3 select-none">2.3.2</span><span class="heading-text">AutoModelForSequenceClassificationのファインチューニング</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#automodelforsequenceclassification" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>transformerライブラリは、ファインチューニングのタスクに応じてAPIを提供しています。</p><p>分類タスクの場合、<code>AutoModel</code>の代わりに<code>AutoModelForSequenceClassification</code>を使用します。</p><p><code>AutoModelForSequenceClassification</code>が事前学習済みモデルの出力の上に分類器ヘッドを持っており、モデルの設定がより簡単になります。</p></div><div id="pmldMnpHFu" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from transformers import AutoModelForSequenceClassification

device = torch.device(&quot;cuda&quot; if torch.cuda.is_available() else &quot;cpu&quot;)
num_labels = 3

model = (AutoModelForSequenceClassification
    .from_pretrained(model_ckpt, num_labels=num_labels)
    .to(device))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="3n31RgcpxvFyuXokfG3Gz" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Some weights of DistilBertForSequenceClassification were not initialized from the model checkpoint at distilbert-base-uncased and are newly initialized: [&#x27;classifier.bias&#x27;, &#x27;classifier.weight&#x27;, &#x27;pre_classifier.bias&#x27;, &#x27;pre_classifier.weight&#x27;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
</span></code></pre></div></div></div></div><div id="HRted5UReG" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">model</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="NYWzqvvrMwu0ioeHkJtco" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-text" class="font-mono text-sm whitespace-pre-wrap myst-jp-safe-output-text"><code><span>DistilBertForSequenceClassification(
  (distilbert): DistilBertModel(
    (embeddings): Embeddings(
      (word_embeddings): Embedding(30522, 768, padding_idx=0)
      (position_embeddings): Embedding(512, 768)
      (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
      (dropout): Dropout(p=0.1, inplace=False)
    )
    (transformer): Transformer(
      (layer): ModuleList(
        (0-5): 6 x TransformerBlock(
          (attention): DistilBertSdpaAttention(
            (dropout): Dropout(p=0.1, inplace=False)
            (q_lin): Linear(in_features=768, out_features=768, bias=True)
            (k_lin): Linear(in_features=768, out_features=768, bias=True)
            (v_lin): Linear(in_features=768, out_features=768, bias=True)
            (out_lin): Linear(in_features=768, out_features=768, bias=True)
          )
          (sa_layer_norm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
          (ffn): FFN(
            (dropout): Dropout(p=0.1, inplace=False)
            (lin1): Linear(in_features=768, out_features=3072, bias=True)
            (lin2): Linear(in_features=3072, out_features=768, bias=True)
            (activation): GELUActivation()
          )
          (output_layer_norm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
        )
      )
    )
  )
  (pre_classifier): Linear(in_features=768, out_features=768, bias=True)
  (classifier): Linear(in_features=768, out_features=3, bias=True)
  (dropout): Dropout(p=0.2, inplace=False)
)</span></code></div></div></div><div id="FHMQ2UHdgv" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">inputs = tokenizer(&quot;I purchased these boots to use both for everyday wear and when riding my motorcycle.&quot;, return_tensors=&quot;pt&quot;) # pytorch tensorに変換するためにreturn_tensors=&quot;pt&quot;を指定
inputs = {k: v.to(device) for k, v in inputs.items()}
with torch.no_grad():
    outputs = model(**inputs)
print(outputs)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="EvjjbOgUjyX_aqw9VTDsH" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>SequenceClassifierOutput(loss=None, logits=tensor([[ 0.0746, -0.1015, -0.0341]], device=&#x27;cuda:0&#x27;), hidden_states=None, attentions=None)
</span></code></pre></div></div></div></div><div id="ZklyqDQHi6" class="myst-jp-nb-block relative group/block"><h4 id="id-10" class="relative group"><span class="mr-3 select-none">2.3.3</span><span class="heading-text">学習の準備</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-10" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>学習時に性能指標を与える必要があるため、それを関数化して定義しておきます。</p></div><div id="biS4cUy9Uf" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from sklearn.metrics import accuracy_score, f1_score

def compute_metrics(pred):
    labels = pred.label_ids
    preds = pred.predictions.argmax(-1)
    f1 = f1_score(labels, preds, average=&quot;weighted&quot;)
    acc = accuracy_score(labels, preds)
    return {&quot;accuracy&quot;: acc, &quot;f1&quot;: f1}</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="vEEjz77UzbePKsCaguQxI" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="ZyWbJJeaes" class="myst-jp-nb-block relative group/block"><p>学習を効率化するために、transformerライブラリの<code>Trainer</code> APIを使用します。</p><p><code>Trainer</code>クラスを初期化する際には、<code>TrainingArguments</code>という訓練に関する様々な設定値の集合を引数に与えることで、訓練の設定に関する細かい調整が可能です。</p></div><div id="TguqmHSJgQ" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">
from transformers import TrainingArguments

batch_size = 16
logging_steps = len(dataset_encoded[&quot;train&quot;]) // batch_size
model_name = &quot;sample-text-classification-bert&quot;

training_args = TrainingArguments(
    output_dir=model_name,
    num_train_epochs=2,
    learning_rate=2e-5,
    per_device_train_batch_size=batch_size,
    per_device_eval_batch_size=batch_size,
    weight_decay=0.01,
    eval_strategy=&quot;epoch&quot;,
    disable_tqdm=False,
    logging_steps=logging_steps,
    push_to_hub=False,
    log_level=&quot;error&quot;,
    report_to=&quot;wandb&quot;,  # wandbに記録
    run_name=&quot;bert-sentiment-analysis_20260107&quot;  # wandbのrun名
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="9WPqFdaHtnfv51HKNGQlu" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="MOSqy3EfvA" class="myst-jp-nb-block relative group/block"><p>Trainerクラスで実行します。</p><p><strong>CUDAエラーのデバッグについて:</strong></p><ul><li><p><code>CUDA_LAUNCH_BLOCKING=1</code>: GPU操作を同期実行にし、エラーの正確な発生箇所を特定</p></li><li><p><code>TORCH_USE_CUDA_DSA</code>: デバイス側のアサーションを有効化してより詳細なエラー情報を取得</p></li><li><p>モデルとデータの整合性を事前に確認することで、ラベル数のミスマッチなどの問題を早期発見</p></li></ul></div><div id="pFX4L5cXFM" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from transformers import Trainer

trainer = Trainer(
    model=model,
    args=training_args,
    compute_metrics=compute_metrics,
    train_dataset=dataset_encoded[&quot;train&quot;],
    eval_dataset=dataset_encoded[&quot;validation&quot;],
    tokenizer=tokenizer
)
trainer.train()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="3v8TWUh7eYA8CkCcyWZYU" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="rOB5GdJ0zP" class="myst-jp-nb-block relative group/block"><h3 id="id-11" class="relative group"><span class="mr-3 select-none">2.4</span><span class="heading-text">学習済みモデルの使用</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-11" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><h4 id="id-12" class="relative group"><span class="mr-3 select-none">2.4.1</span><span class="heading-text">モデル精度の検証</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-12" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>学習済みのモデルを他のデータセットに適用します。</p></div><div id="owGZ2B4frb" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">preds_output = trainer.predict(dataset_encoded[&quot;test&quot;])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="yHjpzHVDkJcqKThXwouvS" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="JiV1GTigoT" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import numpy as np
import matplotlib.pyplot as plt
from sklearn.metrics import ConfusionMatrixDisplay, confusion_matrix

y_preds = np.argmax(preds_output.predictions, axis=1)
y_valid = np.array(dataset_encoded[&quot;test&quot;][&quot;label&quot;])
labels = dataset_encoded[&quot;train&quot;].features[&quot;label&quot;].names

def plot_confusion_matrix(y_preds, y_true, labels):
    cm = confusion_matrix(y_true, y_preds, normalize=&quot;true&quot;)
    fig, ax = plt.subplots(figsize=(6, 6))
    disp = ConfusionMatrixDisplay(confusion_matrix=cm, display_labels=labels)
    disp.plot(cmap=&quot;Blues&quot;, values_format=&quot;.2f&quot;, ax=ax, colorbar=False)
    plt.title(&quot;Normalized confusion matrix&quot;)
    plt.show()

plot_confusion_matrix(y_preds, y_valid, labels)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="o_wGVzvB5CWk3CnyxIUY-" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-image"><img src="/build/be2e3ca8465498495422be6a43b43869.png" alt="&lt;Figure size 600x600 with 1 Axes&gt;"/></div></div></div><div id="HfgDKs969L" class="myst-jp-nb-block relative group/block"><h4 id="id-13" class="relative group"><span class="mr-3 select-none">2.4.2</span><span class="heading-text">モデル保存</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-13" title="Link to this Section" aria-label="Link to this Section">¶</a></h4></div><div id="DwQpQscocp" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">id2label = {}
for i in range(dataset[&quot;train&quot;].features[&quot;label&quot;].num_classes):
    id2label[i] = dataset[&quot;train&quot;].features[&quot;label&quot;].int2str(i)

label2id = {}
for i in range(dataset[&quot;train&quot;].features[&quot;label&quot;].num_classes):
    label2id[dataset[&quot;train&quot;].features[&quot;label&quot;].int2str(i)] = i

trainer.model.config.id2label = id2label
trainer.model.config.label2id = label2id</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="EdbiZXsZobfB9F3X7ztjp" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="zxus9MrMEG" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">trainer.save_model(f&quot;./Data/sample-text-classification-bert&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="qr4Iy43n8ni_EuoM8bfa5" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="FNKM6i66WC" class="myst-jp-nb-block relative group/block"><h4 id="id-14" class="relative group"><span class="mr-3 select-none">2.4.3</span><span class="heading-text">学習済みモデルの読み込み</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-14" title="Link to this Section" aria-label="Link to this Section">¶</a></h4></div><div id="iIO5xbUEdx" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">new_tokenizer = AutoTokenizer\
    .from_pretrained(f&quot;./Data/sample-text-classification-bert&quot;)

new_model = (AutoModelForSequenceClassification
    .from_pretrained(f&quot;./Data/sample-text-classification-bert&quot;)
    .to(device))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="1gEcCZd6FcpF6h7UaLz2d" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="LZA5rwePKS" class="myst-jp-nb-block relative group/block"><p>サンプルテキストで推論の結果を確認します。</p></div><div id="Ls6YTB1vXO" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def id2label(x):
    label_dict={0:&quot;positive&quot;,1:&quot;neutral&quot;,2:&quot;negative&quot;}
    return label_dict[x]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="1vwm_ZOCs7_eGYiESosxo" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="yO2T3ZqOu0" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">text1=&quot;this week is not going as i had hoped&quot;
text2=&quot;awe i love you too!!!! 1 am here i miss you&quot;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="EXLblk_AHOvO0lXwXTiRk" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="jk1GJOV5Z2" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">
inputs = new_tokenizer(text1, return_tensors=&quot;pt&quot;)

new_model.eval()

with torch.no_grad():
    outputs = new_model(
        inputs[&quot;input_ids&quot;].to(device), 
        inputs[&quot;attention_mask&quot;].to(device),
    )
outputs.logits

y_preds = np.argmax(outputs.logits.to(&#x27;cpu&#x27;).detach().numpy().copy(), axis=1)
y_preds = [id2label(x) for x in y_preds]
y_preds</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="FGeQtaaxWRJxOuLgBVKa6" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-text" class="font-mono text-sm whitespace-pre-wrap myst-jp-safe-output-text"><code><span>[&#x27;negative&#x27;]</span></code></div></div></div><div id="YsrRYFUPhQ" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">inputs = new_tokenizer(text2, return_tensors=&quot;pt&quot;)

new_model.eval()

with torch.no_grad():
    outputs = new_model(
        inputs[&quot;input_ids&quot;].to(device), 
        inputs[&quot;attention_mask&quot;].to(device),
    )
outputs.logits

y_preds = np.argmax(outputs.logits.to(&#x27;cpu&#x27;).detach().numpy().copy(), axis=1)
y_preds = [id2label(x) for x in y_preds]
y_preds</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="VcppY2p-2sRx_Onr7Plcc" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-text" class="font-mono text-sm whitespace-pre-wrap myst-jp-safe-output-text"><code><span>[&#x27;positive&#x27;]</span></code></div></div></div><div class="myst-backmatter-parts"></div><div class="myst-footer-links flex pt-10 mb-10 space-x-4"><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-prev" href="/bert"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">Transformer</div>BERT</div></div></a><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-next" href="/bert-topic"><div class="flex h-full align-middle"><div class="flex-grow"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">Transformer</div>BERTopic</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></article></main><script>((a,l)=>{if(!window.history.state||!window.history.state.key){let u=Math.random().toString(32).slice(2);window.history.replaceState({key:u},"")}try{let d=JSON.parse(sessionStorage.getItem(a)||"{}")[l||window.history.state.key];typeof d=="number"&&window.scrollTo(0,d)}catch(u){console.error(u),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/build/entry.client-PCJPW7TK.js"/><link rel="modulepreload" href="/build/_shared/chunk-AQ2CODAG.js"/><link rel="modulepreload" href="/build/_shared/chunk-JJXTQVMA.js"/><link rel="modulepreload" href="/build/_shared/chunk-OZE3FFNP.js"/><link rel="modulepreload" href="/build/_shared/chunk-OYMW4E3D.js"/><link rel="modulepreload" href="/build/_shared/chunk-C4DFGG5C.js"/><link rel="modulepreload" href="/build/_shared/chunk-J7TUH54J.js"/><link rel="modulepreload" href="/build/_shared/chunk-FZ2S7OYD.js"/><link rel="modulepreload" href="/build/_shared/chunk-JEM6JXYA.js"/><link rel="modulepreload" href="/build/_shared/chunk-34XIY2DH.js"/><link rel="modulepreload" href="/build/_shared/chunk-KQM5FBHR.js"/><link rel="modulepreload" href="/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/build/_shared/chunk-7HNKBP4B.js"/><link rel="modulepreload" href="/build/_shared/chunk-CUKUDK3R.js"/><link rel="modulepreload" href="/build/_shared/chunk-3EBOCCHJ.js"/><link rel="modulepreload" href="/build/_shared/chunk-O4VQNZ62.js"/><link rel="modulepreload" href="/build/_shared/chunk-4OEDG4JQ.js"/><link rel="modulepreload" href="/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/build/root-CXYA7X5D.js"/><link rel="modulepreload" href="/build/_shared/chunk-DATP5P2X.js"/><link rel="modulepreload" href="/build/routes/$-JRBPULBO.js"/><script>window.__remixContext = {"url":"/bert-sentiment","state":{"loaderData":{"root":{"config":{"version":3,"myst":"1.7.0","options":{"favicon":"/build/tohoku-university-lo-68dede7d9dcb965aff25e8429e755296.svg","logo":"/build/tohoku-university-lo-68dede7d9dcb965aff25e8429e755296.svg","analytics_google":"G-85RFPTYEE3"},"nav":[],"actions":[],"projects":[{"numbering":{"heading_1":{"template":"enabled","enabled":true},"heading_2":{"template":"enabled","enabled":true},"heading_3":{"template":"enabled","enabled":true},"heading_4":{"template":"enabled","enabled":true},"heading_5":{"template":"enabled","enabled":true},"heading_6":{"template":"enabled","enabled":true}},"title":"計算社会科学と自然言語処理","github":"https://github.com/lvzeyu/css_nlp","id":"356ed62a-cf04-49ae-b7bc-d9f79f2ef8bb","exports":[],"bibliography":[],"index":"intro","pages":[{"title":"イントロダクション","level":1},{"slug":"introduction","title":"ガイダンス","description":"このページで、行動科学演習(LB63310)と計算人文社会学研究演習Ⅱ (LM23309)の授業資料を公開しています。","date":"","thumbnail":"/build/NLP_history-80702ee1d37040856a480174f5bcbbfc.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"基礎知識","level":1},{"slug":"nlp-basis2","title":"自然言語処理の基礎","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ml-basis2","title":"機械学習の基本概念","description":"","date":"","thumbnail":"/build/supervised-learning-b5be7f5e73313e60f2c06d545c226553.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"math-basis2","title":"数学基礎","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"ニューラルネットワーク","level":1},{"slug":"nn2","title":"ニューラルネットワーク","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"backpropagation","title":"誤差逆伝播法","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"sgd","title":"学習に関するテクニック","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"PyTorch","level":1},{"slug":"pytorch2","title":"Pytorch","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"単語分散表現","level":1},{"slug":"word2vec-1","title":"単語分散表現","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"word2vec-2-embedding","title":"word2vec","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"word2vec-gensim","title":"GensimによるWord2Vecの学習と使用","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"word2vec-application","title":"Word2Vecが人文・社会科学研究における応用","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"RNN","level":1},{"slug":"rnn","title":"RNNの基礎","description":"","date":"","thumbnail":"/build/rnn-4dbf33ec81abf2baa6d5bbe97bb61683.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"lstm","title":"LSTM","description":"","date":"","thumbnail":"/build/lstm1-4ea8525c2f72b4f2ff8298a9f7b9c0be.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"pytorch-lstm","title":"LSTMの実装","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"lstm-classification","title":"LSTMによる文書分類","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"seq2seq","title":"Seq2seq","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"Transformer","level":1},{"slug":"attention","title":"Attention","description":"","date":"","thumbnail":"/build/attention-eed7f8fafc28c8cb6bd5276bbd04714b.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"self-attention","title":"Self-Attention","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"transformer","title":"Transformerアーキテクチャ","description":"","date":"","thumbnail":"/build/transformer-493148401fbb971a745b29ab5b44e10f.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"bert","title":"BERT","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"bert-sentiment","title":"BERTによるセンチメント分析","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"bert-topic","title":"BERTopic","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"大規模言語モデル","level":1},{"slug":"gpt","title":"GPT","description":"","date":"","thumbnail":"/build/gpt_history-c08ab6ce749d3aed300b023e318cb96c.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"llm","title":"大規模言語モデルの基本","description":"","date":"","thumbnail":"/build/LLMs_parameter-ec157a4028abc601fb429210b7f4b07c.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"langchain-basic","title":"LLMSの応用(1)：Langchainの基礎","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static"},"routes/$":{"config":{"version":3,"myst":"1.7.0","options":{"favicon":"/build/tohoku-university-lo-68dede7d9dcb965aff25e8429e755296.svg","logo":"/build/tohoku-university-lo-68dede7d9dcb965aff25e8429e755296.svg","analytics_google":"G-85RFPTYEE3"},"nav":[],"actions":[],"projects":[{"numbering":{"heading_1":{"template":"enabled","enabled":true},"heading_2":{"template":"enabled","enabled":true},"heading_3":{"template":"enabled","enabled":true},"heading_4":{"template":"enabled","enabled":true},"heading_5":{"template":"enabled","enabled":true},"heading_6":{"template":"enabled","enabled":true}},"title":"計算社会科学と自然言語処理","github":"https://github.com/lvzeyu/css_nlp","id":"356ed62a-cf04-49ae-b7bc-d9f79f2ef8bb","exports":[],"bibliography":[],"index":"intro","pages":[{"title":"イントロダクション","level":1},{"slug":"introduction","title":"ガイダンス","description":"このページで、行動科学演習(LB63310)と計算人文社会学研究演習Ⅱ (LM23309)の授業資料を公開しています。","date":"","thumbnail":"/build/NLP_history-80702ee1d37040856a480174f5bcbbfc.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"基礎知識","level":1},{"slug":"nlp-basis2","title":"自然言語処理の基礎","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ml-basis2","title":"機械学習の基本概念","description":"","date":"","thumbnail":"/build/supervised-learning-b5be7f5e73313e60f2c06d545c226553.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"math-basis2","title":"数学基礎","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"ニューラルネットワーク","level":1},{"slug":"nn2","title":"ニューラルネットワーク","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"backpropagation","title":"誤差逆伝播法","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"sgd","title":"学習に関するテクニック","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"PyTorch","level":1},{"slug":"pytorch2","title":"Pytorch","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"単語分散表現","level":1},{"slug":"word2vec-1","title":"単語分散表現","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"word2vec-2-embedding","title":"word2vec","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"word2vec-gensim","title":"GensimによるWord2Vecの学習と使用","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"word2vec-application","title":"Word2Vecが人文・社会科学研究における応用","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"RNN","level":1},{"slug":"rnn","title":"RNNの基礎","description":"","date":"","thumbnail":"/build/rnn-4dbf33ec81abf2baa6d5bbe97bb61683.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"lstm","title":"LSTM","description":"","date":"","thumbnail":"/build/lstm1-4ea8525c2f72b4f2ff8298a9f7b9c0be.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"pytorch-lstm","title":"LSTMの実装","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"lstm-classification","title":"LSTMによる文書分類","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"seq2seq","title":"Seq2seq","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"Transformer","level":1},{"slug":"attention","title":"Attention","description":"","date":"","thumbnail":"/build/attention-eed7f8fafc28c8cb6bd5276bbd04714b.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"self-attention","title":"Self-Attention","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"transformer","title":"Transformerアーキテクチャ","description":"","date":"","thumbnail":"/build/transformer-493148401fbb971a745b29ab5b44e10f.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"bert","title":"BERT","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"bert-sentiment","title":"BERTによるセンチメント分析","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"bert-topic","title":"BERTopic","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"大規模言語モデル","level":1},{"slug":"gpt","title":"GPT","description":"","date":"","thumbnail":"/build/gpt_history-c08ab6ce749d3aed300b023e318cb96c.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"llm","title":"大規模言語モデルの基本","description":"","date":"","thumbnail":"/build/LLMs_parameter-ec157a4028abc601fb429210b7f4b07c.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"langchain-basic","title":"LLMSの応用(1)：Langchainの基礎","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"version":3,"kind":"Notebook","sha256":"26c738c59afdfd64f227a1171e744c8631c91ae34426390cc5ce2d50fe299538","slug":"bert-sentiment","location":"/notebook/bert_sentiment.ipynb","dependencies":[],"frontmatter":{"title":"BERTによるセンチメント分析","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"base","language":"python"},"github":"https://github.com/lvzeyu/css_nlp","numbering":{"heading_1":{"enabled":true,"template":"enabled"},"heading_2":{"enabled":true,"template":"enabled"},"heading_3":{"enabled":true,"template":"enabled"},"heading_4":{"enabled":true,"template":"enabled"},"heading_5":{"enabled":true,"template":"enabled"},"heading_6":{"enabled":true,"template":"enabled"},"title":{"offset":1}},"source_url":"https://github.com/lvzeyu/css_nlp/blob/master/notebook/bert_sentiment.ipynb","edit_url":"https://github.com/lvzeyu/css_nlp/edit/master/notebook/bert_sentiment.ipynb","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","exports":[{"format":"ipynb","filename":"bert_sentiment.ipynb","url":"/build/bert_sentiment-10c9a072b8ac199185f5ac58c75525ed.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"link","url":"https://colab.research.google.com/github/lvzeyu/css_nlp/blob/master/notebook/bert_sentiment.ipynb","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"image","url":"/build/7e2db436150c38a00650f96925aa5581.svg","alt":"Open In Colab","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nsPBnC5uck","urlSource":"https://colab.research.google.com/assets/colab-badge.svg"}],"urlSource":"https://colab.research.google.com/github/lvzeyu/css_nlp/blob/master/notebook/bert_sentiment.ipynb","key":"LIwqXMT5eR"}],"key":"NzbEUhhIdI"},{"type":"heading","depth":2,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"転移学習とファインチューニング","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"nsMTJZsJLC"}],"identifier":"id","label":"転移学習とファインチューニング","html_id":"id","implicit":true,"enumerator":"1","key":"O5kxqW8VYI"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"転移学習は、あるタスクの学習で得られた知識を、他の関連するタスクの学習に適用する手法を指します。一般的には、以下のステップで行われることが多いです：","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"GeL4ICMux3"}],"key":"k9QhARYQef"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":10,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"事前学習: 事前学習モデル（pre-trained models)とは、大規模なデータセットを用いて訓練した学習済みモデルのことです。一般的に、大量のデータ（例えば、インターネット上のテキストデータ）を使用して、モデルを事前に学習します。この時点でのモデルは、言語の汎用的な特徴や構造を捉えることができます。","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"ikCOpLQdze"}],"key":"IMUMed2Fwx"}],"key":"lpFWzPQcQ2"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"ファインチューニング(fine-tuning): 事前学習モデルを、特定のタスクのデータ（例えば、感情分析や質問応答）でファインチューニングします。事前学習モデルでは汎用的な特徴をあらかじめ学習しておきますので、手元にある学習データが小規模でも高精度な認識性能を達成することが知られています。","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"ukfHnggykA"}],"key":"l6HiFhv47A"}],"key":"ASIeATlLWk"}],"key":"yzZpFU70pD"},{"type":"image","url":"/build/fine-tuning_methods-0f88d44d58067b02fe4454d82fccc880.png","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"TRWUARmMXs","urlSource":"./Figure/fine-tuning_methods.png"}],"key":"CLcgctiNKZ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"センチメント分析の実装","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WstfOP0vDu"}],"identifier":"id","label":"センチメント分析の実装","html_id":"id-1","implicit":true,"enumerator":"2","key":"jSnp7zeDg0"}],"key":"UwyXCDrqdg"},{"type":"block","kind":"notebook-content","children":[{"type":"admonition","kind":"custom","class":"dropdown tohokupurple","icon":"question","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Google ColabdでGPUを使用する","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Ay2ZSz5uTy"}],"key":"Q4omP7P9GP"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"「ランタイム」→「ランタイムのタイプを変更」→「ハードウェア アクセラレータ」→「GPU」","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"LhEUxmu32h"}],"key":"iFCPA5rGXB"}],"key":"Dx6jmok33g"}],"key":"VYVdiFofV6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"!nvidia-smi","key":"D2l7bSMcuw"},{"type":"outputs","id":"XDWdKzK99MYnyC1H5l1mi","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Sun Jan  4 16:58:32 2026       \n+-----------------------------------------------------------------------------------------+\n| NVIDIA-SMI 580.95.05              Driver Version: 580.95.05      CUDA Version: 13.0     |\n+-----------------------------------------+------------------------+----------------------+\n| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |\n| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |\n|                                         |                        |               MIG M. |\n|=========================================+========================+======================|\n|   0  NVIDIA RTX A6000               Off |   00000000:01:00.0  On |                  Off |\n| 30%   35C    P8             17W /  300W |    1379MiB /  49140MiB |      0%      Default |\n|                                         |                        |                  N/A |\n+-----------------------------------------+------------------------+----------------------+\n|   1  NVIDIA RTX A6000               Off |   00000000:02:00.0 Off |                  Off |\n| 30%   26C    P8             12W /  300W |      18MiB /  49140MiB |      0%      Default |\n|                                         |                        |                  N/A |\n+-----------------------------------------+------------------------+----------------------+\n\n+-----------------------------------------------------------------------------------------+\n| Processes:                                                                              |\n|  GPU   GI   CI              PID   Type   Process name                        GPU Memory |\n|        ID   ID                                                               Usage      |\n|=========================================================================================|\n|    0   N/A  N/A            3971      G   /usr/bin/gnome-shell                    526MiB |\n|    0   N/A  N/A            4428      G   /usr/bin/Xwayland                         4MiB |\n|    0   N/A  N/A            5204      G   /usr/share/code/code                    543MiB |\n|    1   N/A  N/A            3971      G   /usr/bin/gnome-shell                      4MiB |\n+-----------------------------------------------------------------------------------------+\n"},"children":[],"key":"YUH0n6laa8"}],"key":"nM0eZI2Mvb"}],"key":"tO2HfZVINj"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"データセット","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"T4H3CkcPQo"}],"identifier":"id","label":"データセット","html_id":"id-2","implicit":true,"enumerator":"2.1","key":"qQczvwhvvh"}],"key":"Mp9o4oQp53"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Hugging Faceからサンプルデータの取得","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PuHdqfCVeB"}],"identifier":"hugging-face","label":"Hugging Faceからサンプルデータの取得","html_id":"hugging-face","implicit":true,"enumerator":"2.1.1","key":"V9K4i6tyQa"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Hugging Faceのには色々なデータセットが用意されております。ここでは、多言語のセンチメントデータセットを例として使用することにします。その中に、英語と日本語のサプセットが含まれます。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rvBOU5EpYC"}],"key":"pbBJlTG26T"}],"key":"GqtXxlGRFm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"!pip -q install \"datasets\u003c4.0.0\"","key":"IsLrMnVEfk"},{"type":"outputs","id":"WErtEvrJVkoUpimcl3bQL","children":[],"key":"vR8N9ZJmnx"}],"key":"XYPlECn190"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from datasets import load_dataset\n#dataset = load_dataset(\"tyqiangz/multilingual-sentiments\", \"japanese\")\ndataset = load_dataset(\"tyqiangz/multilingual-sentiments\", \"english\")","key":"AHoeSDuYXR"},{"type":"outputs","id":"8_y-IWQhlPi-iJu10jmVX","children":[],"key":"KgGqFaE6uf"}],"key":"LdskSVXUyW"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Weights \u0026 Biases (wandb)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vAIKjG66kJ"}],"identifier":"weights-biases-wandb","label":"Weights \u0026 Biases (wandb)","html_id":"weights-biases-wandb","implicit":true,"enumerator":"2.1.2","key":"zT3l4onQIc"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Weights \u0026 Biases (wandb)は、機械学習の実験を追跡・可視化・管理するためのプラットフォームです。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mkXg3dIJbL"}],"key":"Kr9hyMVnuQ"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"主な機能：","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"TXRQF4RKZJ"}],"key":"r8y1pnqRpI"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":6,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"実験追跡","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"PEJPxLFGjB"}],"key":"mSi0djjxdd"},{"type":"text","value":": 学習の進捗、損失、精度などのメトリクスをリアルタイムで記録・可視化","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"MqT6aEWqxd"}],"key":"KbqusEFQEh"}],"key":"CzaiUwhRYX"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"ハイパーパラメータ管理","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"jcHb4AlhFO"}],"key":"tuHgVXgvvq"},{"type":"text","value":": 異なる設定での実験結果を比較","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"IcCv2H1Fcw"}],"key":"xUMzxa9q56"}],"key":"DGXdfzPz86"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"モデル管理","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"DNMgIQDmn1"}],"key":"ItlfeNgyQ8"},{"type":"text","value":": 学習済みモデルのバージョン管理と共有","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"oNkr1nbmvX"}],"key":"nEHxc3poQ6"}],"key":"XkEY7HJOOH"}],"key":"Yc4JFEJYBz"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"ここでは、モデルの学習過程を追跡するためにwandbを使用します。","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"eIs6QjJhMm"},{"type":"inlineCode","value":"wandb.login()","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"GU0IZzc72B"},{"type":"text","value":"でアカウントにログインし、実験結果をクラウドに保存します。","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"hAJAXDxKev"}],"key":"o7c8TgdwNP"}],"key":"q4FqBZL7Mm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"!pip install wandb\nimport wandb\nwandb.login()","key":"RDogFJsbQs"},{"type":"outputs","id":"oU_0UZCAxwITDBo_FlFK7","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Requirement already satisfied: wandb in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (0.23.1)\nRequirement already satisfied: click\u003e=8.0.1 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from wandb) (8.1.7)\nRequirement already satisfied: gitpython!=3.1.29,\u003e=1.0.0 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from wandb) (3.1.37)\nRequirement already satisfied: packaging in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from wandb) (24.1)\nRequirement already satisfied: platformdirs in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from wandb) (3.10.0)\nRequirement already satisfied: protobuf!=4.21.0,!=5.28.0,\u003c7,\u003e=3.19.0 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from wandb) (3.20.3)\nRequirement already satisfied: pydantic\u003c3 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from wandb) (2.10.6)\nRequirement already satisfied: pyyaml in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from wandb) (6.0.1)\nRequirement already satisfied: requests\u003c3,\u003e=2.0.0 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from wandb) (2.32.5)\nRequirement already satisfied: sentry-sdk\u003e=2.0.0 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from wandb) (2.48.0)\nRequirement already satisfied: typing-extensions\u003c5,\u003e=4.8 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from wandb) (4.12.2)\nRequirement already satisfied: gitdb\u003c5,\u003e=4.0.1 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from gitpython!=3.1.29,\u003e=1.0.0-\u003ewandb) (4.0.7)\nRequirement already satisfied: annotated-types\u003e=0.6.0 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from pydantic\u003c3-\u003ewandb) (0.7.0)\nRequirement already satisfied: pydantic-core==2.27.2 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from pydantic\u003c3-\u003ewandb) (2.27.2)\nRequirement already satisfied: charset_normalizer\u003c4,\u003e=2 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from requests\u003c3,\u003e=2.0.0-\u003ewandb) (2.0.4)\nRequirement already satisfied: idna\u003c4,\u003e=2.5 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from requests\u003c3,\u003e=2.0.0-\u003ewandb) (3.4)\nRequirement already satisfied: urllib3\u003c3,\u003e=1.21.1 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from requests\u003c3,\u003e=2.0.0-\u003ewandb) (2.0.7)\nRequirement already satisfied: certifi\u003e=2017.4.17 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from requests\u003c3,\u003e=2.0.0-\u003ewandb) (2024.2.2)\nRequirement already satisfied: smmap\u003c5,\u003e=3.0.1 in /home/lvzeyu/anaconda3/lib/python3.11/site-packages (from gitdb\u003c5,\u003e=4.0.1-\u003egitpython!=3.1.29,\u003e=1.0.0-\u003ewandb) (4.0.0)\n"},"children":[],"key":"YzFD0A0cLV"},{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"\u001b[34m\u001b[1mwandb\u001b[0m: Currently logged in as: \u001b[33mlvzeyu1995\u001b[0m (\u001b[33mlvzeyu1995-tohoku-university\u001b[0m) to \u001b[32mhttps://api.wandb.ai\u001b[0m. Use \u001b[1m`wandb login --relogin`\u001b[0m to force relogin\n"},"children":[],"key":"CHZUeC3wWC"},{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/plain":{"content":"True","content_type":"text/plain"}}},"children":[],"key":"pWGSUdfUyl"}],"key":"XiNW1CTPi5"}],"key":"iBUPhSCLtv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import os\nos.environ[\"WANDB_PROJECT\"]=\"sentiment_analysis\"","key":"UAtXogYjkt"},{"type":"outputs","id":"ZmquzQcyJxdjGx6dGZoUU","children":[],"key":"RMeAtjj2Tc"}],"key":"qxL8P5fCaI"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"サンプルデータの確認","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TIqWsdG4P1"}],"identifier":"id","label":"サンプルデータの確認","html_id":"id-3","implicit":true,"enumerator":"2.1.3","key":"Q7fXHiU3j9"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"取得したデータセットの中身を確認します。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"um8H1KwJvj"}],"key":"y8JlxSOaoT"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"データセットはこのようにtrain, validation, testに分かれています。\n[‘text’, ‘source’, ‘label’]といった情報を持っています。","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"k414j6iOgB"}],"key":"PuNRvbta7K"}],"key":"n4seCEnPB1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"dataset","key":"BTQJVg2ELN"},{"type":"outputs","id":"cg21mCyFJgWm87qZo1VtY","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/plain":{"content":"DatasetDict({\n    train: Dataset({\n        features: ['text', 'source', 'label'],\n        num_rows: 1839\n    })\n    validation: Dataset({\n        features: ['text', 'source', 'label'],\n        num_rows: 324\n    })\n    test: Dataset({\n        features: ['text', 'source', 'label'],\n        num_rows: 870\n    })\n})","content_type":"text/plain"}}},"children":[],"key":"TzzPIGgb30"}],"key":"WbMLG1K9vg"}],"key":"NHZPngapcQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"dataset.set_format(type=\"pandas\")\ntrain_df = dataset[\"train\"][:]\ntrain_df.head(5)","key":"tIbXFefWRN"},{"type":"outputs","id":"3esCDNrtftvflub7okCpw","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"application/vnd.microsoft.datawrangler.viewer.v0+json":{"content":"{\"columns\":[{\"name\":\"index\",\"rawType\":\"int64\",\"type\":\"integer\"},{\"name\":\"text\",\"rawType\":\"object\",\"type\":\"string\"},{\"name\":\"source\",\"rawType\":\"object\",\"type\":\"string\"},{\"name\":\"label\",\"rawType\":\"int64\",\"type\":\"integer\"}],\"ref\":\"7ff8d620-6a93-4c90-8b6a-b6cd671c7b9f\",\"rows\":[[\"0\",\"okay i\\\\u2019m sorry but TAYLOR SWIFT LOOKS NOTHING LIKE JACKIE O SO STOP COMPARING THE TWO. c\\\\u2019mon America aren\\\\u2019t you sick of her yet? (sorry) \",\"sem_eval_2017\",\"2\"],[\"1\",\"@user the DC comics site has Batman 44 releases on the 9th but its out now? \",\"sem_eval_2017\",\"1\"],[\"2\",\"\\\"Frank Gaffrey\\\\u002c Cliff May\\\\u002c Steve Emerson: Brilliant. \\\\\\\"\\\"\\\"\\\"Looming Threats: Iran\\\\u002c Hezbollah Hamas\\\\\\\"\\\"\\\"\\\" is the best #cufidc session I\\\\u2019ve had thus far.\\\" \",\"sem_eval_2017\",\"0\"],[\"3\",\"The tragedy of only thinking up hilarious tweets for the Summer Olympics now is that in four years there may be no place for them. \",\"sem_eval_2017\",\"2\"],[\"4\",\"\\\"Oliseh meets with Victor Moses in London: Super Eagles coach, Sunday Oliseh, has met with Nigeria and Chelsea ... \",\"sem_eval_2017\",\"1\"]],\"shape\":{\"columns\":3,\"rows\":5}}","content_type":"application/vnd.microsoft.datawrangler.viewer.v0+json"},"text/html":{"content":"\u003cdiv\u003e\n\u003cstyle scoped\u003e\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n\u003c/style\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003etext\u003c/th\u003e\n      \u003cth\u003esource\u003c/th\u003e\n      \u003cth\u003elabel\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e0\u003c/th\u003e\n      \u003ctd\u003eokay i\\u2019m sorry but TAYLOR SWIFT LOOKS NOT...\u003c/td\u003e\n      \u003ctd\u003esem_eval_2017\u003c/td\u003e\n      \u003ctd\u003e2\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e1\u003c/th\u003e\n      \u003ctd\u003e@user the DC comics site has Batman 44 release...\u003c/td\u003e\n      \u003ctd\u003esem_eval_2017\u003c/td\u003e\n      \u003ctd\u003e1\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2\u003c/th\u003e\n      \u003ctd\u003e\"Frank Gaffrey\\u002c Cliff May\\u002c Steve Eme...\u003c/td\u003e\n      \u003ctd\u003esem_eval_2017\u003c/td\u003e\n      \u003ctd\u003e0\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e3\u003c/th\u003e\n      \u003ctd\u003eThe tragedy of only thinking up hilarious twee...\u003c/td\u003e\n      \u003ctd\u003esem_eval_2017\u003c/td\u003e\n      \u003ctd\u003e2\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e4\u003c/th\u003e\n      \u003ctd\u003e\"Oliseh meets with Victor Moses in London: Sup...\u003c/td\u003e\n      \u003ctd\u003esem_eval_2017\u003c/td\u003e\n      \u003ctd\u003e1\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/div\u003e","content_type":"text/html"},"text/plain":{"content":"                                                text         source  label\n0  okay i\\u2019m sorry but TAYLOR SWIFT LOOKS NOT...  sem_eval_2017      2\n1  @user the DC comics site has Batman 44 release...  sem_eval_2017      1\n2  \"Frank Gaffrey\\u002c Cliff May\\u002c Steve Eme...  sem_eval_2017      0\n3  The tragedy of only thinking up hilarious twee...  sem_eval_2017      2\n4  \"Oliseh meets with Victor Moses in London: Sup...  sem_eval_2017      1","content_type":"text/plain"}}},"children":[],"key":"cgjSgEKUZU"}],"key":"MQSJvwGRyt"}],"key":"lBVpgodJTH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"dataset[\"train\"].features","key":"YWHjgr9LTW"},{"type":"outputs","id":"j7GrfvO9rGAq-hYolVkDy","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/plain":{"content":"{'text': Value(dtype='string', id=None),\n 'source': Value(dtype='string', id=None),\n 'label': ClassLabel(names=['positive', 'neutral', 'negative'], id=None)}","content_type":"text/plain"}}},"children":[],"key":"xzHXnVjLD6"}],"key":"CpOgkvNx7g"}],"key":"lOx2FCee1I"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\ntrain_df[\"label\"].value_counts(ascending=True).plot(kind=\"barh\", title=\"Train Dataset\")","key":"m4bp6Ivzw6"},{"type":"outputs","id":"gP4FLY9NvTGHnXQqANmD6","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"\u003cAxes: title={'center': 'Train Dataset'}\u003e","content_type":"text/plain"}}},"children":[],"key":"JQXFqISNlb"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"03bde67fdeaf84b43310b7c9ae7b8743","path":"/build/03bde67fdeaf84b43310b7c9ae7b8743.png"},"text/plain":{"content":"\u003cFigure size 640x480 with 1 Axes\u003e","content_type":"text/plain"}}},"children":[],"key":"xh8JhLInw1"}],"key":"fJwHtpojfK"}],"key":"N96lyWHwTV"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"テキストの確認","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"L2UGAKFMM1"}],"identifier":"id","label":"テキストの確認","html_id":"id-4","implicit":true,"enumerator":"2.1.4","key":"LNxmnPH6hE"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Transformerモデルは、最大コンテキストサイズ(maximum context size)と呼ばれる最大入力系列長があります。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"g8RojA65p3"}],"key":"HqffMNuKB5"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"モデルのコンテキストサイズより長いテキストは切り捨てる必要があり、切り捨てたテキストに重要な情報が含まれている場合、性能の低下につながることがあります。","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"To19GPoiu3"}],"key":"qVxsDQOqZB"}],"key":"cTMQqcXMod"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"train_df[\"text_length\"]=train_df[\"text\"].str.len()","key":"sHJs9lF8s6"},{"type":"outputs","id":"a8Bb1zAEzhx5vyyp6VLhU","children":[],"key":"Kk75SXzr27"}],"key":"MiW06yXDhz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"train_df.boxplot(column=\"text_length\", by=\"label\", figsize=(12, 6))\n","key":"iD587trBw7"},{"type":"outputs","id":"Q2UzKdh4TRM1jRVIjHwQb","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"text/plain":{"content":"\u003cAxes: title={'center': 'text_length'}, xlabel='label'\u003e","content_type":"text/plain"}}},"children":[],"key":"I0mk13yZZ6"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c3e2ec270cbf9d31c31f43ac0a47678d","path":"/build/c3e2ec270cbf9d31c31f43ac0a47678d.png"},"text/plain":{"content":"\u003cFigure size 1200x600 with 1 Axes\u003e","content_type":"text/plain"}}},"children":[],"key":"hvYtOTZCE6"}],"key":"WGmQkW5phs"}],"key":"rPN2hlFbBx"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"トークン化","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"keoBeP6BRK"}],"identifier":"id","label":"トークン化","html_id":"id-5","implicit":true,"enumerator":"2.2","key":"USDWTb7zNO"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"コンピュータは、入力として生の文字列を受け取ることができません。その代わりに、テキストがトークン化され、数値ベクトルとしてエンコードされていることが想定しています。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LqG5dyF8cK"}],"key":"WNkw0vcZ2b"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"トークン化は、文字列をモデルで使用される最小単位に分解するステップです。","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"rpHi5gPipr"}],"key":"IQd7MLHREN"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Transformerライブラリー は便利なAutoTokenizerクラスを提供しており、事前学習済みモデルに関連つけられたトークナイザーを素早く使用することができます。","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"KPfcocawJg"}],"key":"OuJej3KA9C"}],"key":"ptxht66xMD"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"トークナイザの動作確認","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NAVy0efS1J"}],"identifier":"id","label":"トークナイザの動作確認","html_id":"id-6","implicit":true,"enumerator":"2.2.1","key":"unxa1rTbPt"}],"key":"lJxm98TL3U"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"tokenizerテキストを数値形式（トークン）に変換します。","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gN8pvZPEKJ"}],"key":"BprOM8VfOK"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"入力テキストをトークンに分割します","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"gZifMTjRAl"}],"key":"vYMZPEepx7"}],"key":"by7BDvKpuX"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"特殊トークンが自動的に付加されます","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sASbkMIVcx"}],"key":"gx0rcESuAL"}],"key":"voXGOSyVYa"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"トークンをトークンIDに変換します","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"cUDH3lvpJb"}],"key":"qRrsaTNo9A"}],"key":"zeJPdlqtwk"}],"key":"UFoJJCZDPW"}],"key":"DxGIjoQVJI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from transformers import AutoTokenizer\nmodel_ckpt = \"distilbert-base-uncased\"\ntokenizer = AutoTokenizer.from_pretrained(model_ckpt)","key":"yLBr7UxVpn"},{"type":"outputs","id":"cXklzoYB19lq6g3hQf2gd","children":[],"key":"DJWKae75KD"}],"key":"uGAY51wide"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"train_df[\"text\"][0]","key":"GTOu9vLeWY"},{"type":"outputs","id":"0m9dhDJ9zF1EE3kEKzPbq","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":13,"metadata":{},"data":{"text/plain":{"content":"'okay i\\\\u2019m sorry but TAYLOR SWIFT LOOKS NOTHING LIKE JACKIE O SO STOP COMPARING THE TWO. c\\\\u2019mon America aren\\\\u2019t you sick of her yet? (sorry) '","content_type":"text/plain"}}},"children":[],"key":"ViQkvZXZC7"}],"key":"J6PJQMN953"}],"key":"vnvCpaLHT6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"sample_text_encoded = tokenizer(train_df[\"text\"][0])\nsample_text_encoded","key":"yDxhqAV0xU"},{"type":"outputs","id":"tblmSR7R2bc4zUHyonr9u","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":14,"metadata":{},"data":{"text/plain":{"content":"{'input_ids': [101, 3100, 1045, 1032, 23343, 24096, 2683, 2213, 3374, 2021, 4202, 9170, 3504, 2498, 2066, 9901, 1051, 2061, 2644, 13599, 1996, 2048, 1012, 1039, 1032, 23343, 24096, 2683, 8202, 2637, 4995, 1032, 23343, 24096, 2683, 2102, 2017, 5305, 1997, 2014, 2664, 1029, 1006, 3374, 1007, 102], 'attention_mask': [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]}","content_type":"text/plain"}}},"children":[],"key":"Iq5VoiVb7T"}],"key":"nzQ3pcGiBQ"}],"key":"MLR38TCTiB"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"結果にinput_idsとattention_maskが含まれます。","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kTANce7EpM"}],"key":"gNBfhVIBHO"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"input_ids: 数字にエンコードされたトークン","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qPfCIiiEed"}],"key":"ObydVq80FX"}],"key":"xXn0gEAQew"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"attention_mask: モデルで有効なトークンかどうかを判別するためのマスクです。無効なトークン（例えば、PADなど）に対しては、attention_maskを\nとして処理します。","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"q1v7ywIkLc"}],"key":"HUwnrT5Ly2"}],"key":"TYzNHtixnS"}],"key":"DyKBSHpkU9"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"各batchにおいて、入力系列はbatch内最大系列長までpaddingされます。","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"rAHp50bS9M"}],"key":"bYCUqQVTKU"},{"type":"image","url":"/build/attention_id-3873cba03fa81523923bc1d9baa87924.png","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"EJDP8DWd4Y","urlSource":"./Figure/attention_id.png"}],"key":"EhYBV4dM92"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"トークナイザの結果は数字にエンコードされているため、トークン文字列を得るには、convert_ids_to_tokensを用います。","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LDqIDJ81os"}],"key":"t9NQKbPiVc"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"文の開始が[CLS]、文の終了が[SEP]という特殊なトークンとなっています。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ekim5IJFs4"}],"key":"cXBhUcS4gc"}],"key":"nV8FcIe1mA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"tokens = tokenizer.convert_ids_to_tokens(sample_text_encoded.input_ids)\nprint(tokens)","key":"fEXsVcLdTk"},{"type":"outputs","id":"3igH9oLus_uKs2dqjgQPw","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"['[CLS]', 'okay', 'i', '\\\\', 'u2', '##01', '##9', '##m', 'sorry', 'but', 'taylor', 'swift', 'looks', 'nothing', 'like', 'jackie', 'o', 'so', 'stop', 'comparing', 'the', 'two', '.', 'c', '\\\\', 'u2', '##01', '##9', '##mon', 'america', 'aren', '\\\\', 'u2', '##01', '##9', '##t', 'you', 'sick', 'of', 'her', 'yet', '?', '(', 'sorry', ')', '[SEP]']\n"},"children":[],"key":"H9sF26kHl9"}],"key":"VrTmPDd2pB"}],"key":"bNnkIP0vv8"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"データセット全体のトークン化","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ktfzQ8GY7h"}],"identifier":"id","label":"データセット全体のトークン化","html_id":"id-7","implicit":true,"enumerator":"2.2.2","key":"LHOzQMk3Bg"}],"key":"RPgslftMjr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def tokenize(batch):\n    return tokenizer(batch[\"text\"], padding=True, truncation=True)","key":"tNramcdlUr"},{"type":"outputs","id":"ck9ElyBJ4lPEvpVQdu7S3","children":[],"key":"gq0ryqzYYl"}],"key":"xGGecMC9zw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"dataset.reset_format()","key":"qaRcTCdllF"},{"type":"outputs","id":"0CTnWldI_8WYPjFjYFLUa","children":[],"key":"ieR0lUh8ZI"}],"key":"b2rGdXLNVw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"dataset_encoded = dataset.map(tokenize, batched=True, batch_size=None)","key":"eDcUvM0Wlh"},{"type":"outputs","id":"c8KcagGjf5ySOLURWSBFY","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"9b6dd632bdb64a529c1c62c8a368ab9b\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"Map:   0%|          | 0/324 [00:00\u003c?, ? examples/s]","content_type":"text/plain"}}},"children":[],"key":"Z6TNz3TfPF"}],"key":"wRtZKlnHcR"}],"key":"UXQYUb2kms"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\nsample_encoded = dataset_encoded[\"train\"][0]\npd.DataFrame(\n    [sample_encoded[\"input_ids\"]\n     , sample_encoded[\"attention_mask\"]\n     , tokenizer.convert_ids_to_tokens(sample_encoded[\"input_ids\"])],\n    ['input_ids', 'attention_mask', \"tokens\"]\n).T","key":"LOJYZR3avB"},{"type":"outputs","id":"5GQm_xjTwrCJUVUw1XCtt","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":19,"metadata":{},"data":{"application/vnd.microsoft.datawrangler.viewer.v0+json":{"content":"{\"columns\":[{\"name\":\"index\",\"rawType\":\"int64\",\"type\":\"integer\"},{\"name\":\"input_ids\",\"rawType\":\"object\",\"type\":\"string\"},{\"name\":\"attention_mask\",\"rawType\":\"object\",\"type\":\"string\"},{\"name\":\"tokens\",\"rawType\":\"object\",\"type\":\"string\"}],\"ref\":\"82c21289-e1a7-4422-82fb-f0feb6413095\",\"rows\":[[\"0\",\"101\",\"1\",\"[CLS]\"],[\"1\",\"3100\",\"1\",\"okay\"],[\"2\",\"1045\",\"1\",\"i\"],[\"3\",\"1032\",\"1\",\"\\\\\"],[\"4\",\"23343\",\"1\",\"u2\"],[\"5\",\"24096\",\"1\",\"##01\"],[\"6\",\"2683\",\"1\",\"##9\"],[\"7\",\"2213\",\"1\",\"##m\"],[\"8\",\"3374\",\"1\",\"sorry\"],[\"9\",\"2021\",\"1\",\"but\"],[\"10\",\"4202\",\"1\",\"taylor\"],[\"11\",\"9170\",\"1\",\"swift\"],[\"12\",\"3504\",\"1\",\"looks\"],[\"13\",\"2498\",\"1\",\"nothing\"],[\"14\",\"2066\",\"1\",\"like\"],[\"15\",\"9901\",\"1\",\"jackie\"],[\"16\",\"1051\",\"1\",\"o\"],[\"17\",\"2061\",\"1\",\"so\"],[\"18\",\"2644\",\"1\",\"stop\"],[\"19\",\"13599\",\"1\",\"comparing\"],[\"20\",\"1996\",\"1\",\"the\"],[\"21\",\"2048\",\"1\",\"two\"],[\"22\",\"1012\",\"1\",\".\"],[\"23\",\"1039\",\"1\",\"c\"],[\"24\",\"1032\",\"1\",\"\\\\\"],[\"25\",\"23343\",\"1\",\"u2\"],[\"26\",\"24096\",\"1\",\"##01\"],[\"27\",\"2683\",\"1\",\"##9\"],[\"28\",\"8202\",\"1\",\"##mon\"],[\"29\",\"2637\",\"1\",\"america\"],[\"30\",\"4995\",\"1\",\"aren\"],[\"31\",\"1032\",\"1\",\"\\\\\"],[\"32\",\"23343\",\"1\",\"u2\"],[\"33\",\"24096\",\"1\",\"##01\"],[\"34\",\"2683\",\"1\",\"##9\"],[\"35\",\"2102\",\"1\",\"##t\"],[\"36\",\"2017\",\"1\",\"you\"],[\"37\",\"5305\",\"1\",\"sick\"],[\"38\",\"1997\",\"1\",\"of\"],[\"39\",\"2014\",\"1\",\"her\"],[\"40\",\"2664\",\"1\",\"yet\"],[\"41\",\"1029\",\"1\",\"?\"],[\"42\",\"1006\",\"1\",\"(\"],[\"43\",\"3374\",\"1\",\"sorry\"],[\"44\",\"1007\",\"1\",\")\"],[\"45\",\"102\",\"1\",\"[SEP]\"],[\"46\",\"0\",\"0\",\"[PAD]\"],[\"47\",\"0\",\"0\",\"[PAD]\"],[\"48\",\"0\",\"0\",\"[PAD]\"],[\"49\",\"0\",\"0\",\"[PAD]\"]],\"shape\":{\"columns\":3,\"rows\":78}}","content_type":"application/vnd.microsoft.datawrangler.viewer.v0+json"},"text/html":{"content":"\u003cdiv\u003e\n\u003cstyle scoped\u003e\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n\u003c/style\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003einput_ids\u003c/th\u003e\n      \u003cth\u003eattention_mask\u003c/th\u003e\n      \u003cth\u003etokens\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e0\u003c/th\u003e\n      \u003ctd\u003e101\u003c/td\u003e\n      \u003ctd\u003e1\u003c/td\u003e\n      \u003ctd\u003e[CLS]\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e1\u003c/th\u003e\n      \u003ctd\u003e3100\u003c/td\u003e\n      \u003ctd\u003e1\u003c/td\u003e\n      \u003ctd\u003eokay\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2\u003c/th\u003e\n      \u003ctd\u003e1045\u003c/td\u003e\n      \u003ctd\u003e1\u003c/td\u003e\n      \u003ctd\u003ei\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e3\u003c/th\u003e\n      \u003ctd\u003e1032\u003c/td\u003e\n      \u003ctd\u003e1\u003c/td\u003e\n      \u003ctd\u003e\\\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e4\u003c/th\u003e\n      \u003ctd\u003e23343\u003c/td\u003e\n      \u003ctd\u003e1\u003c/td\u003e\n      \u003ctd\u003eu2\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e...\u003c/th\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e73\u003c/th\u003e\n      \u003ctd\u003e0\u003c/td\u003e\n      \u003ctd\u003e0\u003c/td\u003e\n      \u003ctd\u003e[PAD]\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e74\u003c/th\u003e\n      \u003ctd\u003e0\u003c/td\u003e\n      \u003ctd\u003e0\u003c/td\u003e\n      \u003ctd\u003e[PAD]\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e75\u003c/th\u003e\n      \u003ctd\u003e0\u003c/td\u003e\n      \u003ctd\u003e0\u003c/td\u003e\n      \u003ctd\u003e[PAD]\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e76\u003c/th\u003e\n      \u003ctd\u003e0\u003c/td\u003e\n      \u003ctd\u003e0\u003c/td\u003e\n      \u003ctd\u003e[PAD]\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e77\u003c/th\u003e\n      \u003ctd\u003e0\u003c/td\u003e\n      \u003ctd\u003e0\u003c/td\u003e\n      \u003ctd\u003e[PAD]\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e78 rows × 3 columns\u003c/p\u003e\n\u003c/div\u003e","content_type":"text/html"},"text/plain":{"content":"   input_ids attention_mask tokens\n0        101              1  [CLS]\n1       3100              1   okay\n2       1045              1      i\n3       1032              1      \\\n4      23343              1     u2\n..       ...            ...    ...\n73         0              0  [PAD]\n74         0              0  [PAD]\n75         0              0  [PAD]\n76         0              0  [PAD]\n77         0              0  [PAD]\n\n[78 rows x 3 columns]","content_type":"text/plain"}}},"children":[],"key":"Ly0ZAADmqV"}],"key":"aiHqznbzDl"}],"key":"AdQ2J2POyy"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"分類器の実装","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"N09hefS3bi"}],"identifier":"id","label":"分類器の実装","html_id":"id-8","implicit":true,"enumerator":"2.3","key":"ZSs0I21uGo"},{"type":"heading","depth":4,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"事前学習モデルの導入","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"V28feaVeGi"}],"identifier":"id","label":"事前学習モデルの導入","html_id":"id-9","implicit":true,"enumerator":"2.3.1","key":"WGHy6kNwb0"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Transformerライブラリは事前学習モデルの使用ため","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"CUWq725nA0"},{"type":"inlineCode","value":"AutoModel","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"vqju95WHGS"},{"type":"text","value":"クラスを提供します。","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"mL2ALDfI4w"}],"key":"UGwTQsVVvc"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"inlineCode","value":"AutoModel","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"SZ4AvsHAA2"},{"type":"text","value":"クラスはトークンエンコーディングを埋め込みに変換し、エンコーダスタックを経由して","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"AYWKZNvGhg"},{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"最後の","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"nwWf0VMxrf"}],"key":"ZrEiWjYmGn"},{"type":"text","value":"隠れ状態を返します。","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Kim25Va6c4"}],"key":"PxZ8eRvI1n"}],"key":"kNjYTEMKOh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import torch\nfrom transformers import AutoModel\n\n# GPUある場合はGPUを使う\ndevice = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\nmodel = AutoModel.from_pretrained(model_ckpt).to(device)","key":"khwXWyj0fE"},{"type":"outputs","id":"sowPkmBPRhZXx4-gWzDyH","children":[],"key":"kmW5uIh3H9"}],"key":"cXknJY2Nwt"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"最初に、文字列をエンコーダしてトークンをPyTorchのテンソルに変換する必要があります。","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zhxHzxOJ0T"}],"key":"GK4xRuuvsd"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"結果として得られるテンソルは","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"P7pH1Gb3CQ"},{"type":"inlineCode","value":"[batch_size,n_tokens]","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"l7uC6QGrRQ"},{"type":"text","value":"という形状です。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YuUhDVlNaq"}],"key":"iupvyYl8Ju"}],"key":"jhNWCHQd1J"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"text = \"this is a test\"\ninputs = tokenizer(text, return_tensors=\"pt\")\nprint(f\"Input tensor shape: {inputs['input_ids'].size()}\")","key":"W1WG04uAWN"},{"type":"outputs","id":"qlc9T_2Noy4ZrZ6yluAc2","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Input tensor shape: torch.Size([1, 6])\n"},"children":[],"key":"KRyajGk21d"}],"key":"MaFDUzRvHv"}],"key":"HnwTFUVyg8"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"得られるテンソルをモデルの入力として渡します。","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"X4BjMeadRR"}],"key":"zMym6ggIdT"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"モデルと同じデバイス(GPU or CPU)に設置します。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"b9VXvlEoay"}],"key":"nm09ZwvTqb"}],"key":"jUclmzNLKn"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"計算のメモリを減らせるため、","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"uiTCtAVSjC"},{"type":"inlineCode","value":"torch.no_grad()","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"GVHsq4e8QI"},{"type":"text","value":"で、勾配の自動計算を無効します。","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"s5mtCsf9BY"}],"key":"Xne1k9ridT"}],"key":"QYrD7ZyzRk"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"出力には隠れ状態、損失、アテンションのオブジェクトが含まれます。","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"QIeF8XqFUm"}],"key":"KFwLykRX6u"}],"key":"ZA1XkI4nek"}],"key":"S2q9hkp65p"}],"key":"NREczyuRC5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"inputs = {k:v.to(device) for k,v in inputs.items()}\nwith torch.no_grad():\n    outputs = model(**inputs)\nprint(outputs)","key":"amshoJ7GyS"},{"type":"outputs","id":"KsNXPmmsM5QvW40ttv5ku","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"BaseModelOutput(last_hidden_state=tensor([[[-0.1565, -0.1862,  0.0528,  ..., -0.1188,  0.0662,  0.5470],\n         [-0.3575, -0.6484, -0.0618,  ..., -0.3040,  0.3508,  0.5221],\n         [-0.2772, -0.4459,  0.1818,  ..., -0.0948, -0.0076,  0.9958],\n         [-0.2841, -0.3917,  0.3753,  ..., -0.2151, -0.1173,  1.0526],\n         [ 0.2661, -0.5094, -0.3180,  ..., -0.4203,  0.0144, -0.2149],\n         [ 0.9441,  0.0112, -0.4714,  ...,  0.1439, -0.7288, -0.1619]]],\n       device='cuda:0'), hidden_states=None, attentions=None)\n"},"children":[],"key":"VkxxlJwMxj"}],"key":"BuULMcmlep"}],"key":"skhRsKtaV7"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"隠れた状態テンソルを見ると、その形状は [batch_size, n_tokens, hidden_dim] であることがわかります。つまり、6つの入力トークンのそれぞれに対して、768次元のベクトルが返されます。","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AWrbiwLDRT"}],"key":"DFo4kQ4Vy8"}],"key":"UjAvRFWSUA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"outputs.last_hidden_state.size()","key":"FFn8wJqfI8"},{"type":"outputs","id":"qitqXh6faUoVrX38nUJoD","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":23,"metadata":{},"data":{"text/plain":{"content":"torch.Size([1, 6, 768])","content_type":"text/plain"}}},"children":[],"key":"CJOvZRfFyd"}],"key":"b0DY7lyHVP"}],"key":"CbnYtHMIBq"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"分類タスクでは、","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NM5grgsbs7"},{"type":"inlineCode","value":"[CLS]","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kQXwBBw0dP"},{"type":"text","value":" トークンに関連する隠れた状態を入力特徴として使用するのが一般的な方法です。このトークンは各シーケンスの始まりに現れるため、次のように outputs.last_hidden_state に単純にインデックスを付けることで抽出できます。","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WzJTnMQcf9"}],"key":"LhO617IjOn"}],"key":"yUyPRv8aUf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"outputs.last_hidden_state[:,0].size()\n","key":"uYNlXRxNTM"},{"type":"outputs","id":"MArhTzoYfxJGfMQRYRMVh","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":24,"metadata":{},"data":{"text/plain":{"content":"torch.Size([1, 768])","content_type":"text/plain"}}},"children":[],"key":"EDKMLFfBG2"}],"key":"gvBT2f1NpR"}],"key":"buLBPm1PZQ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"最後の隠れ状態を取得する方法がわかりましたので、データ全体に対して処理を行うため、これまでのステップを関数でまとめます。","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eC37hwAwX6"}],"key":"AlspKyQRdy"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"そして、データ全体に適用し、すべてのテキストの隠れ状態を抽出します。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tP2MtgBdtt"}],"key":"XgCc5TgTYZ"}],"key":"OWrgkKwX4n"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def extract_hidden_states(batch):\n    # Place model inputs on the GPU\n    inputs = {k:v.to(device) for k,v in batch.items() \n              if k in tokenizer.model_input_names}\n    # Extract last hidden states\n    with torch.no_grad():\n        last_hidden_state = model(**inputs).last_hidden_state\n    # Return vector for [CLS] token\n    return {\"hidden_state\": last_hidden_state[:,0].cpu().numpy()}","key":"T6e9bN6m9f"},{"type":"outputs","id":"Ah5OrIecL80KChEX4FHUm","children":[],"key":"w3o4ECWdDq"}],"key":"BCP8BVOzTq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"dataset_encoded.set_format(type=\"torch\", columns=[\"input_ids\", \"attention_mask\",\"label\"])\n","key":"dGayhfW65O"},{"type":"outputs","id":"CxK879LRPBks4teb6oVgs","children":[],"key":"VEoaX30B4U"}],"key":"hR5YfHupO8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"dataset_hidden=dataset_encoded.map(extract_hidden_states, batched=True, batch_size=16)","key":"bGpM7Mgyb9"},{"type":"outputs","id":"6zrPJplFggAI8j_khyZBQ","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"de282f712cf542339a7cee8ace81cafa\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"Map:   0%|          | 0/324 [00:00\u003c?, ? examples/s]","content_type":"text/plain"}}},"children":[],"key":"rnyjaBZpko"}],"key":"MdJdkfUTo2"}],"key":"U3e21azQjJ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"AutoModelForSequenceClassificationのファインチューニング","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"j9HHFUMuL1"}],"identifier":"automodelforsequenceclassification","label":"AutoModelForSequenceClassificationのファインチューニング","html_id":"automodelforsequenceclassification","implicit":true,"enumerator":"2.3.2","key":"QmNgqRbKul"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"transformerライブラリは、ファインチューニングのタスクに応じてAPIを提供しています。","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ho2EKrcHkG"}],"key":"mIB0FdrwLD"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"分類タスクの場合、","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"wtzNZZKLs3"},{"type":"inlineCode","value":"AutoModel","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"dZflF5J4b4"},{"type":"text","value":"の代わりに","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"arM0ZHxUzA"},{"type":"inlineCode","value":"AutoModelForSequenceClassification","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"sFtOhtZ31D"},{"type":"text","value":"を使用します。","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"AKQYCNCW3z"}],"key":"nJpkKeDTay"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"inlineCode","value":"AutoModelForSequenceClassification","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"vM9OYFTryL"},{"type":"text","value":"が事前学習済みモデルの出力の上に分類器ヘッドを持っており、モデルの設定がより簡単になります。","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"UKuqqoemPB"}],"key":"qlmL8LJVvV"}],"key":"zyjmNpXXoZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from transformers import AutoModelForSequenceClassification\n\ndevice = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\nnum_labels = 3\n\nmodel = (AutoModelForSequenceClassification\n    .from_pretrained(model_ckpt, num_labels=num_labels)\n    .to(device))","key":"nDYBNuQGCJ"},{"type":"outputs","id":"3n31RgcpxvFyuXokfG3Gz","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"Some weights of DistilBertForSequenceClassification were not initialized from the model checkpoint at distilbert-base-uncased and are newly initialized: ['classifier.bias', 'classifier.weight', 'pre_classifier.bias', 'pre_classifier.weight']\nYou should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.\n"},"children":[],"key":"yd6NecPuwL"}],"key":"AxNNCxanSI"}],"key":"pmldMnpHFu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"model","key":"Dxk3teQuZd"},{"type":"outputs","id":"NYWzqvvrMwu0ioeHkJtco","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":29,"metadata":{},"data":{"text/plain":{"content":"DistilBertForSequenceClassification(\n  (distilbert): DistilBertModel(\n    (embeddings): Embeddings(\n      (word_embeddings): Embedding(30522, 768, padding_idx=0)\n      (position_embeddings): Embedding(512, 768)\n      (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)\n      (dropout): Dropout(p=0.1, inplace=False)\n    )\n    (transformer): Transformer(\n      (layer): ModuleList(\n        (0-5): 6 x TransformerBlock(\n          (attention): DistilBertSdpaAttention(\n            (dropout): Dropout(p=0.1, inplace=False)\n            (q_lin): Linear(in_features=768, out_features=768, bias=True)\n            (k_lin): Linear(in_features=768, out_features=768, bias=True)\n            (v_lin): Linear(in_features=768, out_features=768, bias=True)\n            (out_lin): Linear(in_features=768, out_features=768, bias=True)\n          )\n          (sa_layer_norm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)\n          (ffn): FFN(\n            (dropout): Dropout(p=0.1, inplace=False)\n            (lin1): Linear(in_features=768, out_features=3072, bias=True)\n            (lin2): Linear(in_features=3072, out_features=768, bias=True)\n            (activation): GELUActivation()\n          )\n          (output_layer_norm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)\n        )\n      )\n    )\n  )\n  (pre_classifier): Linear(in_features=768, out_features=768, bias=True)\n  (classifier): Linear(in_features=768, out_features=3, bias=True)\n  (dropout): Dropout(p=0.2, inplace=False)\n)","content_type":"text/plain"}}},"children":[],"key":"GETJrLB7r1"}],"key":"EurRfa3Plv"}],"key":"HRted5UReG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"inputs = tokenizer(\"I purchased these boots to use both for everyday wear and when riding my motorcycle.\", return_tensors=\"pt\") # pytorch tensorに変換するためにreturn_tensors=\"pt\"を指定\ninputs = {k: v.to(device) for k, v in inputs.items()}\nwith torch.no_grad():\n    outputs = model(**inputs)\nprint(outputs)","key":"DVTtv3RAGe"},{"type":"outputs","id":"EvjjbOgUjyX_aqw9VTDsH","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"SequenceClassifierOutput(loss=None, logits=tensor([[ 0.0746, -0.1015, -0.0341]], device='cuda:0'), hidden_states=None, attentions=None)\n"},"children":[],"key":"Mv2RULVlSn"}],"key":"MPQaPIvjvK"}],"key":"FHMQ2UHdgv"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"学習の準備","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BZWdd5kG8r"}],"identifier":"id","label":"学習の準備","html_id":"id-10","implicit":true,"enumerator":"2.3.3","key":"PzkiNTyH7Z"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"学習時に性能指標を与える必要があるため、それを関数化して定義しておきます。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KRAKk4vhaf"}],"key":"qYBUcSR3Ci"}],"key":"ZklyqDQHi6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.metrics import accuracy_score, f1_score\n\ndef compute_metrics(pred):\n    labels = pred.label_ids\n    preds = pred.predictions.argmax(-1)\n    f1 = f1_score(labels, preds, average=\"weighted\")\n    acc = accuracy_score(labels, preds)\n    return {\"accuracy\": acc, \"f1\": f1}","key":"GQERcFUmSV"},{"type":"outputs","id":"vEEjz77UzbePKsCaguQxI","children":[],"key":"Bepid8GXUE"}],"key":"biS4cUy9Uf"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"学習を効率化するために、transformerライブラリの","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TycGtdFXsd"},{"type":"inlineCode","value":"Trainer","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bHgxkhGZfx"},{"type":"text","value":" APIを使用します。","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SqgAexYQrz"}],"key":"j9tMpasLC9"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"Trainer","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"iF8oK77Ub8"},{"type":"text","value":"クラスを初期化する際には、","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wfSfAJnZD2"},{"type":"inlineCode","value":"TrainingArguments","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NmDjP26gxD"},{"type":"text","value":"という訓練に関する様々な設定値の集合を引数に与えることで、訓練の設定に関する細かい調整が可能です。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wMhEULg4fJ"}],"key":"UD2iCPuxY8"}],"key":"ZyWbJJeaes"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"\nfrom transformers import TrainingArguments\n\nbatch_size = 16\nlogging_steps = len(dataset_encoded[\"train\"]) // batch_size\nmodel_name = \"sample-text-classification-bert\"\n\ntraining_args = TrainingArguments(\n    output_dir=model_name,\n    num_train_epochs=2,\n    learning_rate=2e-5,\n    per_device_train_batch_size=batch_size,\n    per_device_eval_batch_size=batch_size,\n    weight_decay=0.01,\n    eval_strategy=\"epoch\",\n    disable_tqdm=False,\n    logging_steps=logging_steps,\n    push_to_hub=False,\n    log_level=\"error\",\n    report_to=\"wandb\",  # wandbに記録\n    run_name=\"bert-sentiment-analysis_20260107\"  # wandbのrun名\n)","key":"MdGyMpmHSO"},{"type":"outputs","id":"9WPqFdaHtnfv51HKNGQlu","children":[],"key":"j6FSotCYhO"}],"key":"TguqmHSJgQ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Trainerクラスで実行します。","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jL94NrLsSE"}],"key":"jZs3xcjyO2"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"CUDAエラーのデバッグについて:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"w1g7aM3cgY"}],"key":"JX457p2haX"}],"key":"rlrFqMPaP8"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"CUDA_LAUNCH_BLOCKING=1","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"rtBQqcarnG"},{"type":"text","value":": GPU操作を同期実行にし、エラーの正確な発生箇所を特定","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"zSsFYdG0RE"}],"key":"qdWO2vAKLR"}],"key":"D0HoMCMYFD"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"TORCH_USE_CUDA_DSA","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ZVjptLcGiU"},{"type":"text","value":": デバイス側のアサーションを有効化してより詳細なエラー情報を取得","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"j9878QV7nV"}],"key":"SB65e8EiPh"}],"key":"Ds5f0WtpFi"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"モデルとデータの整合性を事前に確認することで、ラベル数のミスマッチなどの問題を早期発見","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"VtX7SniB7m"}],"key":"e4xxRvrfJB"}],"key":"T1ZDrak2wi"}],"key":"lyeRw0e8IN"}],"key":"MOSqy3EfvA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from transformers import Trainer\n\ntrainer = Trainer(\n    model=model,\n    args=training_args,\n    compute_metrics=compute_metrics,\n    train_dataset=dataset_encoded[\"train\"],\n    eval_dataset=dataset_encoded[\"validation\"],\n    tokenizer=tokenizer\n)\ntrainer.train()","key":"TxItNsZSmz"},{"type":"outputs","id":"3v8TWUh7eYA8CkCcyWZYU","children":[],"key":"RSfNhfR2sy"}],"key":"pFX4L5cXFM"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"学習済みモデルの使用","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Kx5P4MtzhV"}],"identifier":"id","label":"学習済みモデルの使用","html_id":"id-11","implicit":true,"enumerator":"2.4","key":"vU01gvXlmS"},{"type":"heading","depth":4,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"モデル精度の検証","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dpmt2AQDOg"}],"identifier":"id","label":"モデル精度の検証","html_id":"id-12","implicit":true,"enumerator":"2.4.1","key":"unwuxwf2gt"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"学習済みのモデルを他のデータセットに適用します。","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"rnSqKRkeIH"}],"key":"YoXJsLSiHG"}],"key":"rOB5GdJ0zP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"preds_output = trainer.predict(dataset_encoded[\"test\"])","key":"PYhEWHhM58"},{"type":"outputs","id":"yHjpzHVDkJcqKThXwouvS","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"","content_type":"text/html"},"text/plain":{"content":"\u003cIPython.core.display.HTML object\u003e","content_type":"text/plain"}}},"children":[],"key":"BrvOHpyvrW"}],"key":"YYYvDVsx72"}],"key":"owGZ2B4frb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nfrom sklearn.metrics import ConfusionMatrixDisplay, confusion_matrix\n\ny_preds = np.argmax(preds_output.predictions, axis=1)\ny_valid = np.array(dataset_encoded[\"test\"][\"label\"])\nlabels = dataset_encoded[\"train\"].features[\"label\"].names\n\ndef plot_confusion_matrix(y_preds, y_true, labels):\n    cm = confusion_matrix(y_true, y_preds, normalize=\"true\")\n    fig, ax = plt.subplots(figsize=(6, 6))\n    disp = ConfusionMatrixDisplay(confusion_matrix=cm, display_labels=labels)\n    disp.plot(cmap=\"Blues\", values_format=\".2f\", ax=ax, colorbar=False)\n    plt.title(\"Normalized confusion matrix\")\n    plt.show()\n\nplot_confusion_matrix(y_preds, y_valid, labels)","key":"CF8dDcDA6K"},{"type":"outputs","id":"o_wGVzvB5CWk3CnyxIUY-","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"be2e3ca8465498495422be6a43b43869","path":"/build/be2e3ca8465498495422be6a43b43869.png"},"text/plain":{"content":"\u003cFigure size 600x600 with 1 Axes\u003e","content_type":"text/plain"}}},"children":[],"key":"Ef8tOaCe5j"}],"key":"FU3KN2CH1z"}],"key":"JiV1GTigoT"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"モデル保存","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cJXV8451Zf"}],"identifier":"id","label":"モデル保存","html_id":"id-13","implicit":true,"enumerator":"2.4.2","key":"vu6fZLHdZs"}],"key":"HfgDKs969L"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"id2label = {}\nfor i in range(dataset[\"train\"].features[\"label\"].num_classes):\n    id2label[i] = dataset[\"train\"].features[\"label\"].int2str(i)\n\nlabel2id = {}\nfor i in range(dataset[\"train\"].features[\"label\"].num_classes):\n    label2id[dataset[\"train\"].features[\"label\"].int2str(i)] = i\n\ntrainer.model.config.id2label = id2label\ntrainer.model.config.label2id = label2id","key":"wQ4aokHlXW"},{"type":"outputs","id":"EdbiZXsZobfB9F3X7ztjp","children":[],"key":"aYsdsNf3VK"}],"key":"DwQpQscocp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"trainer.save_model(f\"./Data/sample-text-classification-bert\")","key":"DE9T3ftpJ8"},{"type":"outputs","id":"qr4Iy43n8ni_EuoM8bfa5","children":[],"key":"MU8umKNZVY"}],"key":"zxus9MrMEG"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"学習済みモデルの読み込み","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dYtBZTbALM"}],"identifier":"id","label":"学習済みモデルの読み込み","html_id":"id-14","implicit":true,"enumerator":"2.4.3","key":"IoYyAju0Ko"}],"key":"FNKM6i66WC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"new_tokenizer = AutoTokenizer\\\n    .from_pretrained(f\"./Data/sample-text-classification-bert\")\n\nnew_model = (AutoModelForSequenceClassification\n    .from_pretrained(f\"./Data/sample-text-classification-bert\")\n    .to(device))","key":"yBRCvcgYDO"},{"type":"outputs","id":"1gEcCZd6FcpF6h7UaLz2d","children":[],"key":"jIsTSV1IVz"}],"key":"iIO5xbUEdx"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"サンプルテキストで推論の結果を確認します。","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"R94NQ2iQ0z"}],"key":"WrrS0hLSLF"}],"key":"LZA5rwePKS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def id2label(x):\n    label_dict={0:\"positive\",1:\"neutral\",2:\"negative\"}\n    return label_dict[x]","key":"lz05mmm2gv"},{"type":"outputs","id":"1vwm_ZOCs7_eGYiESosxo","children":[],"key":"Zvu1k6RIuS"}],"key":"Ls6YTB1vXO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"text1=\"this week is not going as i had hoped\"\ntext2=\"awe i love you too!!!! 1 am here i miss you\"","key":"UDWVRVvUNX"},{"type":"outputs","id":"EXLblk_AHOvO0lXwXTiRk","children":[],"key":"pcEHPZR7sg"}],"key":"yO2T3ZqOu0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"\ninputs = new_tokenizer(text1, return_tensors=\"pt\")\n\nnew_model.eval()\n\nwith torch.no_grad():\n    outputs = new_model(\n        inputs[\"input_ids\"].to(device), \n        inputs[\"attention_mask\"].to(device),\n    )\noutputs.logits\n\ny_preds = np.argmax(outputs.logits.to('cpu').detach().numpy().copy(), axis=1)\ny_preds = [id2label(x) for x in y_preds]\ny_preds","key":"sgV4llDwlB"},{"type":"outputs","id":"FGeQtaaxWRJxOuLgBVKa6","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":66,"metadata":{},"data":{"text/plain":{"content":"['negative']","content_type":"text/plain"}}},"children":[],"key":"jR6pPwkfwJ"}],"key":"GftR3q2Ti7"}],"key":"jk1GJOV5Z2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"inputs = new_tokenizer(text2, return_tensors=\"pt\")\n\nnew_model.eval()\n\nwith torch.no_grad():\n    outputs = new_model(\n        inputs[\"input_ids\"].to(device), \n        inputs[\"attention_mask\"].to(device),\n    )\noutputs.logits\n\ny_preds = np.argmax(outputs.logits.to('cpu').detach().numpy().copy(), axis=1)\ny_preds = [id2label(x) for x in y_preds]\ny_preds","key":"Y0dOf8wQJ7"},{"type":"outputs","id":"VcppY2p-2sRx_Onr7Plcc","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":67,"metadata":{},"data":{"text/plain":{"content":"['positive']","content_type":"text/plain"}}},"children":[],"key":"hpEgFIC5uc"}],"key":"QTPujPky8a"}],"key":"YsrRYFUPhQ"}],"key":"UiGeMY2qCy"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"BERT","url":"/bert","group":"Transformer"},"next":{"title":"BERTopic","url":"/bert-topic","group":"Transformer"}}},"domain":"http://localhost:3000"},"project":{"numbering":{"heading_1":{"template":"enabled","enabled":true},"heading_2":{"template":"enabled","enabled":true},"heading_3":{"template":"enabled","enabled":true},"heading_4":{"template":"enabled","enabled":true},"heading_5":{"template":"enabled","enabled":true},"heading_6":{"template":"enabled","enabled":true}},"title":"計算社会科学と自然言語処理","github":"https://github.com/lvzeyu/css_nlp","id":"356ed62a-cf04-49ae-b7bc-d9f79f2ef8bb","exports":[],"bibliography":[],"index":"intro","pages":[{"title":"イントロダクション","level":1},{"slug":"introduction","title":"ガイダンス","description":"このページで、行動科学演習(LB63310)と計算人文社会学研究演習Ⅱ (LM23309)の授業資料を公開しています。","date":"","thumbnail":"/build/NLP_history-80702ee1d37040856a480174f5bcbbfc.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"基礎知識","level":1},{"slug":"nlp-basis2","title":"自然言語処理の基礎","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ml-basis2","title":"機械学習の基本概念","description":"","date":"","thumbnail":"/build/supervised-learning-b5be7f5e73313e60f2c06d545c226553.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"math-basis2","title":"数学基礎","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"ニューラルネットワーク","level":1},{"slug":"nn2","title":"ニューラルネットワーク","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"backpropagation","title":"誤差逆伝播法","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"sgd","title":"学習に関するテクニック","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"PyTorch","level":1},{"slug":"pytorch2","title":"Pytorch","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"単語分散表現","level":1},{"slug":"word2vec-1","title":"単語分散表現","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"word2vec-2-embedding","title":"word2vec","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"word2vec-gensim","title":"GensimによるWord2Vecの学習と使用","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"word2vec-application","title":"Word2Vecが人文・社会科学研究における応用","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"RNN","level":1},{"slug":"rnn","title":"RNNの基礎","description":"","date":"","thumbnail":"/build/rnn-4dbf33ec81abf2baa6d5bbe97bb61683.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"lstm","title":"LSTM","description":"","date":"","thumbnail":"/build/lstm1-4ea8525c2f72b4f2ff8298a9f7b9c0be.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"pytorch-lstm","title":"LSTMの実装","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"lstm-classification","title":"LSTMによる文書分類","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"seq2seq","title":"Seq2seq","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"Transformer","level":1},{"slug":"attention","title":"Attention","description":"","date":"","thumbnail":"/build/attention-eed7f8fafc28c8cb6bd5276bbd04714b.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"self-attention","title":"Self-Attention","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"transformer","title":"Transformerアーキテクチャ","description":"","date":"","thumbnail":"/build/transformer-493148401fbb971a745b29ab5b44e10f.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"bert","title":"BERT","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"bert-sentiment","title":"BERTによるセンチメント分析","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"bert-topic","title":"BERTopic","description":"","date":"","thumbnail":"/build/7e2db436150c38a00650f96925aa5581.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"大規模言語モデル","level":1},{"slug":"gpt","title":"GPT","description":"","date":"","thumbnail":"/build/gpt_history-c08ab6ce749d3aed300b023e318cb96c.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"llm","title":"大規模言語モデルの基本","description":"","date":"","thumbnail":"/build/LLMs_parameter-ec157a4028abc601fb429210b7f4b07c.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"langchain-basic","title":"LLMSの応用(1)：Langchainの基礎","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/build/manifest-86A905A4.js";
import * as route0 from "/build/root-CXYA7X5D.js";
import * as route1 from "/build/routes/$-JRBPULBO.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/build/entry.client-PCJPW7TK.js");</script></body></html>